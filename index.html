<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Locus Gold Elite Ultimate Edition</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>

    <style>
        /* –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –±–∞–∑–∞ */
        :root {
            --bg: #000000;
            --surface: #111112;
            --accent: #ff9d00;
            --error: #ff3b30;
            --text-dim: #8e8e93;
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', -apple-system, sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: var(--bg); 
            color: #fff; 
            height: 100vh; 
            overflow: hidden; 
            position: fixed; 
            width: 100%; 
            display: flex; 
            flex-direction: column; 
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —ç–∫—Ä–∞–Ω–æ–≤ */
        .app-container {
            position: absolute; inset: 0; display: none; flex-direction: column;
            padding: calc(var(--safe-top) + 20px) 20px calc(var(--safe-bottom) + 90px);
            animation: fadeIn 0.3s ease;
        }
        .app-container.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* –®–∞–ø–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
        .header-stats { text-align: center; margin-bottom: 20px; flex-shrink: 0; }
        .gold-display { font-size: 52px; font-weight: 900; color: var(--accent); text-shadow: 0 0 25px rgba(255,157,0,0.2); }
        .rank-badge { font-size: 11px; text-transform: uppercase; background: #222; padding: 4px 12px; border-radius: 20px; color: var(--accent); font-weight: 800; display: inline-block; margin-bottom: 5px; }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 15px; }
        .stat-box { background: var(--surface); border-radius: 18px; padding: 14px; text-align: center; border: 1px solid #27272a; }
        .stat-box small { display: block; color: var(--text-dim); font-size: 10px; text-transform: uppercase; margin-bottom: 2px; }
        .stat-box b { font-size: 18px; font-weight: 700; }

        /* –ì–ª–∞–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –º–æ–Ω–µ—Ç—ã */
        .clicker-area { flex: 1; display: flex; align-items: center; justify-content: center; position: relative; }
        .coin-btn {
            width: 230px; height: 230px; border-radius: 50%;
            background: radial-gradient(circle at 35% 35%, #ffc400 0%, #ff8000 100%);
            border: 12px solid #1a1a1c; box-shadow: 0 0 50px rgba(255, 157, 0, 0.2);
            display: flex; align-items: center; justify-content: center;
            font-size: 90px; font-weight: 900; color: rgba(0,0,0,0.1);
            transition: transform 0.05s; cursor: pointer; user-select: none;
        }
        .coin-btn:active { transform: scale(0.92); }

        /* –û–≤–µ—Ä–ª–µ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏ –∫–ª–∏–∫–µ */
        .lock-ui { position: absolute; background: rgba(0,0,0,0.95); inset: 0; z-index: 100; display: none; flex-direction: column; align-items: center; justify-content: center; border-radius: 50%; border: 4px solid var(--error); }
        .lock-ui.show { display: flex; }
        .lock-timer { font-size: 50px; font-weight: 900; color: var(--error); }

        /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
        .actions-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: auto; }
        .action-btn { background: var(--surface); border: 1px solid #27272a; border-radius: 20px; padding: 16px 10px; text-align: center; cursor: pointer; }
        .action-btn:active { background: #1c1c1e; transform: scale(0.97); }
        .action-btn i { display: block; font-style: normal; font-size: 20px; margin-bottom: 2px; }
        .action-btn b { display: block; font-size: 14px; font-weight: 800; text-transform: uppercase; }
        .action-btn span { font-size: 9px; color: var(--accent); font-weight: 800; text-transform: uppercase; }

        /* –°–ø–∏—Å–∫–∏ –∏ —ç–ª–µ–º–µ–Ω—Ç—ã */
        .list-wrapper { flex: 1; overflow-y: auto; margin-top: 15px; padding-bottom: 20px; }
        .list-item { background: var(--surface); padding: 16px; border-radius: 18px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #27272a; }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav-bar {
            position: fixed; bottom: 0; width: 100%; height: calc(75px + var(--safe-bottom));
            background: #080808; border-top: 1px solid #1c1c1e; display: flex; padding-bottom: var(--safe-bottom);
        }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--text-dim); background: none; border: none; outline: none; }
        .nav-item.active { color: var(--accent); }
        .nav-item i { font-size: 24px; font-style: normal; margin-bottom: 4px; }
        .nav-item span { font-size: 10px; font-weight: 800; text-transform: uppercase; }

        /* –ú–æ–¥–∞–ª–∫–∞ –ê–Ω—Ç–∏—á–∏—Ç–∞ */
        #cheat-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 9999; display: none; align-items: center; justify-content: center; padding: 30px; }
        .modal-box { background: #1c1c1e; padding: 40px 30px; border-radius: 30px; text-align: center; border: 2px solid var(--error); width: 100%; max-width: 400px; }
        
        /* –ö–Ω–æ–ø–∫–∞ –•–û–†–û–®–û */
        .ok-btn { background: var(--accent); color: #000; border: none; border-radius: 18px; padding: 18px; width: 100%; font-size: 16px; font-weight: 900; text-transform: uppercase; cursor: pointer; margin-top: 25px; }
        .ok-btn:active { transform: scale(0.96); opacity: 0.9; }

        /* –í—Å–ø–ª—ã–≤–∞—é—â–∏–π —Ç–µ–∫—Å—Ç –∫–ª–∏–∫–∞ */
        .float-txt { position: absolute; color: var(--accent); font-weight: 900; pointer-events: none; animation: floatUp 0.8s forwards; font-size: 22px; z-index: 1000; }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-130px); } }
    </style>
</head>
<body>

    <div id="cheat-modal">
        <div class="modal-box">
            <div style="font-size: 60px; margin-bottom: 15px;">üëÆ</div>
            <h2 style="color:var(--error); margin-bottom:10px; font-size: 24px;">–ê–ù–¢–ò–ß–ò–¢</h2>
            <p style="font-size:15px; color:var(--text-dim); line-height: 1.5;">–ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä—ã –∑–∞–ø—Ä–µ—â–µ–Ω—ã!<br>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏–≥—Ä–∞–π—Ç–µ —á–µ—Å—Ç–Ω–æ, —á—Ç–æ–±—ã –Ω–µ –ø–æ–ª—É—á–∏—Ç—å –±–∞–Ω.</p>
            <button class="ok-btn" onclick="Core.closeCheat()">–•–û–†–û–®–û</button>
        </div>
    </div>

    <div class="app-container active" id="view-mining">
        <div class="header-stats">
            <div class="rank-badge" id="u-rank">BRONZE</div>
            <div class="gold-display"><span id="u-gold">0.000</span> G</div>
            <div class="stats-grid">
                <div class="stat-box"><small>–°–∏–ª–∞ –∫–ª–∏–∫–∞</small><b id="u-pwr">0.001</b></div>
                <div class="stat-box"><small>–î—Ä—É–∑—å—è</small><b id="u-refs">0</b></div>
            </div>
        </div>
        
        <div class="clicker-area">
            <div id="click-lock" class="lock-ui">
                <div class="lock-timer" id="lock-sec">5</div>
                <div style="font-size: 10px; font-weight: 800; color: var(--error); margin-top: 5px;">WAIT</div>
            </div>
            <div class="coin-btn" id="coin-btn">G</div>
        </div>

        <div class="actions-grid">
            <div class="action-btn" onclick="Core.ad('gold')"><i>üéÅ</i><b>–ë–æ–Ω—É—Å +5.0 G</b><span>ADSGRAM</span></div>
            <div class="action-btn" onclick="Core.ad('pwr')"><i>‚ö°</i><b>–°–∏–ª–∞ +0.005</b><span>ADSGRAM</span></div>
            <div class="action-btn" style="grid-column: span 2; border-color: var(--accent);" onclick="Core.upgrade()">
                <b>–£–ª—É—á—à–∏—Ç—å –∫–ª–∏–∫ –∑–∞ 1.000 G</b>
            </div>
        </div>
    </div>

    <div class="app-container" id="view-top">
        <h2 style="text-align:center; margin-bottom:10px; font-size: 26px;">–¢–û–ü-50 –ò–ì–†–û–ö–û–í</h2>
        <p style="text-align:center; font-size:11px; color:var(--text-dim); margin-bottom:10px;">–û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
        <div class="list-wrapper" id="top-list"></div>
    </div>

    <div class="app-container" id="view-friends">
        <h2 style="text-align:center; margin-bottom:20px; font-size: 26px;">–ú–û–ò –†–ï–§–ï–†–ê–õ–´</h2>
        <div class="stat-box" style="margin-bottom:20px; background: #1a1a1c;">
            <p style="font-size:14px; margin-bottom: 8px;">–í–∞—à –±–æ–Ω—É—Å –∑–∞ –¥—Ä—É–≥–∞:</p>
            <b style="color: var(--accent); font-size: 24px;">+100.0 G</b>
            <button class="ok-btn" style="margin-top:15px;" onclick="Core.invite()">–ü–†–ò–ì–õ–ê–°–ò–¢–¨ –î–†–£–ó–ï–ô</button>
        </div>
        <h3 style="font-size: 14px; margin-left: 5px; color: var(--text-dim);">–°–ü–ò–°–û–ö –î–†–£–ó–ï–ô (<span id="u-refs-count">0</span>)</h3>
        <div class="list-wrapper" id="friend-list"></div>
    </div>

    <div class="app-container" id="view-wallet">
        <h2 style="text-align:center; margin-bottom:20px; font-size: 26px;">–ö–û–®–ï–õ–ï–ö</h2>
        <div class="stat-box" style="margin-bottom:20px">
            <p style="font-size:13px; color:var(--text-dim); margin-bottom: 12px;">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥: 750.0 G</p>
            <button id="wd-btn" class="ok-btn" style="opacity:0.3; background: #333; color: #fff;" disabled>–í–´–í–ï–°–¢–ò</button>
        </div>
        <h3 style="font-size: 14px; margin-left: 5px; color: var(--text-dim);">–ò–°–¢–û–†–ò–Ø –¢–†–ê–ù–ó–ê–ö–¶–ò–ô</h3>
        <div class="list-wrapper" id="history-list"></div>
    </div>

    <nav class="nav-bar">
        <button class="nav-item active" onclick="UI.nav('mining', this)"><i>‚õèÔ∏è</i><span>–î–æ–±—ã—á–∞</span></button>
        <button class="nav-item" onclick="UI.nav('top', this)"><i>üèÜ</i><span>–¢–æ–ø-50</span></button>
        <button class="nav-item" onclick="UI.nav('friends', this)"><i>üë•</i><span>–î—Ä—É–∑—å—è</span></button>
        <button class="nav-item" onclick="UI.nav('wallet', this)"><i>üè¶</i><span>–í—ã–≤–æ–¥</span></button>
    </nav>

    <script>
    const Core = {
        db: null, tg: window.Telegram.WebApp, uid: null,
        gold: 0, pwr: 0.001, journal: 0, 
        lastTaps: [], isLocked: false, adId: "19895",

        async init() {
            this.tg.expand();
            this.uid = this.tg.initDataUnsafe?.user?.id?.toString() || "DEBUG_USER";
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
            if (!firebase.apps.length) {
                firebase.initializeApp({
                    apiKey: "AIzaSyCoa29KS-sin6hoRz0ZbE4f3ki0tZLwkKI",
                    projectId: "gold-clicker-5d882",
                    appId: "1:83489312782:web:ee5b7bdc390e53e7dd6c5f"
                });
            }
            this.db = firebase.firestore();

            // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä–æ–∫–∞
            const doc = await this.db.collection('players').doc(this.uid).get();
            if(doc.exists) {
                const d = doc.data();
                this.gold = d.gold || 0;
                this.pwr = d.pwr || 0.001;
            } else {
                await this.db.collection('players').doc(this.uid).set({
                    name: this.tg.initDataUnsafe?.user?.first_name || "Player",
                    gold: 0, pwr: 0.001, created: new Date()
                });
            }

            this.render();
            this.checkRef();
            
            // –°–ª—É—à–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞ (pointerdown –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏)
            document.getElementById('coin-btn').addEventListener('pointerdown', (e) => this.tap(e));
            
            // –ê–≤—Ç–æ-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
            setInterval(() => this.sync(), 8000);
        },

        async checkRef() {
            const sp = this.tg.initDataUnsafe?.start_param;
            if (sp && sp !== this.uid) {
                const me = await this.db.collection('players').doc(this.uid).get();
                if (!me.exists || !me.data().invitedBy) {
                    await this.db.collection('players').doc(this.uid).set({ invitedBy: sp }, {merge: true});
                    await this.db.collection('players').doc(sp).update({
                        gold: firebase.firestore.FieldValue.increment(100)
                    });
                    await this.db.collection('players').doc(sp).collection('referrals').add({
                        name: this.tg.initDataUnsafe?.user?.first_name || "Friend",
                        date: new Date()
                    });
                }
            }
        },

        tap(e) {
            if (this.isLocked) return;
            const now = Date.now();
            this.lastTaps.push(now);
            this.lastTaps = this.lastTaps.filter(t => now - t < 1000);

            // –ê–Ω—Ç–∏—á–∏—Ç: –ª–∏–º–∏—Ç 15 –∫–ª–∏–∫–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É
            if (this.lastTaps.length > 15) return this.triggerCheat();

            this.gold += this.pwr;
            this.journal += this.pwr;
            this.render();
            UI.spawnText(e.clientX, e.clientY, `+${this.pwr.toFixed(3)}`);
            if(this.tg.HapticFeedback) this.tg.HapticFeedback.impactOccurred('light');
        },

        triggerCheat() {
            this.isLocked = true;
            document.getElementById('cheat-modal').style.display = 'flex';
            document.getElementById('click-lock').classList.add('show');
            let sec = 5;
            const timer = setInterval(() => {
                sec--;
                document.getElementById('lock-sec').innerText = sec;
                if (sec <= 0) {
                    clearInterval(timer);
                    this.isLocked = false;
                    document.getElementById('click-lock').classList.remove('show');
                    document.getElementById('lock-sec').innerText = "5";
                    this.lastTaps = [];
                }
            }, 1000);
        },

        closeCheat() { document.getElementById('cheat-modal').style.display = 'none'; },

        async sync() {
            if (this.journal <= 0) return;
            const amount = this.journal;
            this.journal = 0;
            await this.db.collection('players').doc(this.uid).update({
                gold: firebase.firestore.FieldValue.increment(amount)
            });
        },

        ad(type) {
            const ad = window.Adsgram.init({ blockId: this.adId });
            ad.show().then(() => {
                if(type === 'gold') this.gold += 5; else this.pwr += 0.005;
                this.sync(); 
                this.render();
            }).catch(() => this.tg.showAlert("–†–µ–∫–ª–∞–º–∞ –Ω–µ –≥–æ—Ç–æ–≤–∞..."));
        },

        upgrade() {
            if(this.gold < 1) return this.tg.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ Gold!");
            this.gold -= 1; this.pwr += 0.005;
            this.sync();
            this.render();
        },

        render() {
            document.getElementById('u-gold').innerText = this.gold.toFixed(3);
            document.getElementById('u-pwr').innerText = this.pwr.toFixed(3);
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–Ω–æ–ø–∫–∏ –≤—ã–≤–æ–¥–∞
            const btn = document.getElementById('wd-btn');
            if(this.gold >= 750) { 
                btn.disabled = false; btn.style.opacity = "1"; 
                btn.style.background = "var(--accent)"; btn.style.color = "#000";
                btn.onclick = () => this.withdraw(); 
            } else {
                btn.disabled = true; btn.style.opacity = "0.3";
                btn.style.background = "#333";
            }
        },

        async withdraw() {
            const sid = prompt("–í–≤–µ–¥–∏—Ç–µ –≤–∞—à ID Standoff 2:");
            if(!sid || sid.length < 5) return;
            
            await this.db.collection('withdrawals').add({ 
                uid: this.uid, sid, amount: Math.floor(this.gold), status: '–û–∂–∏–¥–∞–Ω–∏–µ', date: new Date() 
            });
            
            const toClear = this.gold;
            this.gold = 0;
            await this.db.collection('players').doc(this.uid).update({ gold: 0 });
            this.render();
            this.tg.showAlert(`–ó–∞—è–≤–∫–∞ –Ω–∞ ${Math.floor(toClear)} G –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!`);
        },

        invite() {
            const link = `https://t.me/Locus_Gold_bot/app?startapp=${this.uid}`;
            this.tg.openTelegramLink
