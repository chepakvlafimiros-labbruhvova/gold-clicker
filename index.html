<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Locus Gold Clicker</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>
        body { 
            font-family: 'Arial', sans-serif; 
            text-align: center; 
            background: #121212; 
            color: white; 
            margin: 0; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            height: 100vh; 
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        .label { font-size: 14px; color: #aaa; letter-spacing: 2px; margin-bottom: 5px; }
        #gold-display { font-size: 64px; font-weight: bold; color: #ffca28; margin-bottom: 20px; }
        #click-btn { 
            width: 240px; height: 240px; border-radius: 50%; border: none; 
            background: radial-gradient(circle, #ffe082 0%, #ffca28 100%);
            box-shadow: 0 0 30px rgba(255, 202, 40, 0.3); 
            font-size: 110px; cursor: pointer; transition: transform 0.05s;
            display: flex; align-items: center; justify-content: center;
        }
        #click-btn:active { transform: scale(0.90); }
        #status { margin-top: 20px; font-size: 12px; color: #555; }
    </style>
</head>
<body>

    <div class="label">–ë–ê–õ–ê–ù–°</div>
    <div id="gold-display">...</div>
    <button id="click-btn">üìÄ</button>
    <div id="status">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –æ–±–ª–∞–∫–æ–º...</div>

    <script>
        // 1. –¢–≤–æ—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCoa29KS-sin6hoRz0ZbE4f3ki0tZLwkKI",
            authDomain: "gold-clicker-5d882.firebaseapp.com",
            projectId: "gold-clicker-5d882",
            storageBucket: "gold-clicker-5d882.firebasestorage.app",
            messagingSenderId: "83489312782",
            appId: "1:83489312782:web:ee5b7bdc390e53e7dd6c5f"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        const userId = tg.initDataUnsafe?.user?.id ? tg.initDataUnsafe.user.id.toString() : "test_user_5223115893";
        const playerRef = db.collection('players').doc(userId);

        let gold = 0;
        const display = document.getElementById('gold-display');
        const status = document.getElementById('status');

        // 3. –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ (—Ç–µ–ø–µ—Ä—å –Ω–∞–¥–µ–∂–Ω–∞—è)
        async function loadData() {
            try {
                const doc = await playerRef.get();
                if (doc.exists) {
                    gold = doc.data().gold || 0;
                    console.log("–ó–∞–≥—Ä—É–∂–µ–Ω–æ –∑–æ–ª–æ—Ç–∞:", gold);
                } else {
                    console.log("–ù–æ–≤—ã–π –∏–≥—Ä–æ–∫, —Å–æ–∑–¥–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å");
                    await playerRef.set({ 
                        gold: 0, 
                        username: tg.initDataUnsafe?.user?.username || "Unknown" 
                    });
                    gold = 0;
                }
                display.innerText = gold;
                status.innerText = "–î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã";
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", e);
                status.innerText = "–û—à–∏–±–∫–∞ —Å–µ—Ç–∏! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.";
            }
        }

        // 4. –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        async function saveData() {
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º set —Å merge: true –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
                await playerRef.set({ gold: gold }, { merge: true });
                status.innerText = "–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ";
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:", e);
                status.innerText = "–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è!";
            }
        }

        // 5. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞
        document.getElementById('click-btn').addEventListener('click', () => {
            gold++;
            display.innerText = gold;
            status.innerText = "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...";
            
            // –í–∏–±—Ä–æ–æ—Ç–∫–ª–∏–∫
            if (tg.HapticFeedback) {
                tg.HapticFeedback.impactOccurred('medium');
            }

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ Firebase
            saveData();
        });

        // –ó–∞–ø—É—Å–∫
        loadData();
    </script>
</body>
</html>
