<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Nebula Gold: Elite Pro System</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>

    <style>
        :root {
            --p-blue: #00d4ff;
            --p-gold: #ffcc00;
            --p-bg: #050505;
            --p-card: rgba(255, 255, 255, 0.05);
            --p-brd: rgba(255, 255, 255, 0.1);
            --safe-area: env(safe-area-inset-bottom);
        }

        * {
            margin: 0; padding: 0; box-sizing: border-box;
            font-family: 'Inter', -apple-system, sans-serif;
            -webkit-tap-highlight-color: transparent;
            user-select: none; touch-action: manipulation;
        }

        body {
            background: var(--p-bg);
            color: #ffffff;
            height: 100vh;
            overflow: hidden;
            position: fixed;
            width: 100%;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –ø—Ä–∏ –∫–ª–∏–∫–µ */
        #fx-canvas {
            position: absolute;
            inset: 0;
            z-index: 5;
            pointer-events: none;
        }

        /* –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
        .app-container {
            position: relative;
            z-index: 10;
            display: flex;
            flex-direction: column;
            height: 100%;
            padding: 20px 20px calc(90px + var(--safe-area));
        }

        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–∞–ª–∞–Ω—Å–∞ */
        .header-ui { text-align: center; margin-bottom: 15px; }
        .balance-main {
            font-size: 52px;
            font-weight: 900;
            text-shadow: 0 0 25px rgba(0, 212, 255, 0.4);
        }
        .gold-status {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            color: var(--p-gold);
            font-weight: 800;
            font-size: 24px;
        }

        /* –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∏–≥—Ä–æ–≤–æ–π —ç–ª–µ–º–µ–Ω—Ç */
        .game-core {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .nebula-crystal {
            width: 240px;
            height: 240px;
            background: radial-gradient(circle at 30% 30%, var(--p-blue), #0033ff);
            clip-path: polygon(50% 0%, 95% 25%, 95% 75%, 50% 100%, 5% 75%, 5% 25%);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.05s cubic-bezier(0.1, 0.9, 0.2, 1);
            filter: drop-shadow(0 0 30px rgba(0, 212, 255, 0.3));
        }

        .nebula-crystal:active { transform: scale(0.92); }
        .nebula-crystal img { width: 100px; }

        /* –°–∏—Å—Ç–µ–º–∞ –æ—Ñ—Ñ–µ—Ä–æ–≤ */
        #special-offer-ui {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            width: 85%;
            max-width: 320px;
            background: #111;
            border: 2px solid var(--p-gold);
            border-radius: 24px;
            padding: 25px;
            z-index: 5000;
            text-align: center;
            display: none;
            opacity: 0;
            transition: all 0.3s ease;
            box-shadow: 0 0 60px rgba(0,0,0,0.9);
        }

        #special-offer-ui.visible {
            display: block;
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 15px;
        }

        .stat-node {
            background: var(--p-card);
            border: 1px solid var(--p-brd);
            padding: 15px;
            border-radius: 18px;
            text-align: center;
        }

        .stat-node b {
            display: block;
            font-size: 20px;
            color: var(--p-blue);
        }

        .stat-node small {
            font-size: 11px;
            opacity: 0.6;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ –ö–Ω–æ–ø–∫–∏ */
        .action-btn {
            width: 100%;
            padding: 18px;
            border-radius: 20px;
            border: none;
            background: linear-gradient(135deg, #ff9d00, #ff5e00);
            color: #fff;
            font-weight: 900;
            font-size: 16px;
            text-transform: uppercase;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 157, 0, 0.3);
        }

        .nav-bar {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            height: calc(80px + var(--safe-area));
            background: #0a0a0a;
            border-top: 1px solid var(--p-brd);
            display: flex;
            padding-bottom: var(--safe-area);
            z-index: 1000;
        }

        .nav-link {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #555;
            text-decoration: none;
            transition: color 0.2s;
        }

        .nav-link.active { color: var(--p-blue); }
        .nav-link i { font-size: 24px; margin-bottom: 4px; font-style: normal; }
        .nav-link span { font-size: 11px; font-weight: 700; }

        /* –≠–∫—Ä–∞–Ω—ã */
        .view-panel {
            position: fixed;
            inset: 0;
            background: var(--p-bg);
            z-index: 500;
            display: none;
            padding: 40px 25px 120px;
            overflow-y: auto;
        }

        .view-panel.active { display: flex; flex-direction: column; }
        
        .upgrade-item {
            background: var(--p-card);
            padding: 20px;
            border-radius: 22px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--p-brd);
        }
    </style>
</head>
<body>
    <canvas id="fx-canvas"></canvas>

    <div id="special-offer-ui">
        <h2 style="color:var(--p-gold); margin-bottom:10px;">–≠–õ–ò–¢–ù–´–ô –ë–û–ù–£–°</h2>
        <p id="offer-description" style="margin-bottom:20px; font-size:15px; line-height:1.5;">–ó–∞—Ä—è–¥–∏ —Å–≤–æ–∏ –∑–∞–ø–∞—Å—ã –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!</p>
        <button class="action-btn" onclick="NebulaGame.handleOfferClaim()">–ü–û–õ–£–ß–ò–¢–¨</button>
        <div id="offer-countdown" style="margin-top:15px; color:#ff3b30; font-weight:bold; font-size:13px;"></div>
    </div>

    <div class="app-container">
        <div class="header-ui">
            <div class="balance-main" id="ui-balance">0</div>
            <div class="gold-status">üí∞ <span id="ui-gold">0</span></div>
        </div>
        
        <div class="game-core">
            <div class="nebula-crystal" id="crystal-trigger">
                <img src="https://cdn-icons-png.flaticon.com/512/3203/3203925.png" alt="Crystal">
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-node">
                <small>–ú–æ—â–Ω–æ—Å—Ç—å</small>
                <b id="ui-power">1.0</b>
            </div>
            <div class="stat-node">
                <small>–£—Ä–æ–≤–µ–Ω—å</small>
                <b id="ui-level">1</b>
            </div>
        </div>
    </div>

    <div class="view-panel" id="view-shop">
        <h2 style="margin-bottom: 25px;">–ú–∞–≥–∞–∑–∏–Ω Nebula</h2>
        <div style="margin-bottom: 20px;">
            <button class="action-btn" style="background: #00d4ff;" onclick="NebulaGame.triggerAd('boost')">üöÄ –§–û–†–°–ê–ñ x3 (30 —Å–µ–∫)</button>
        </div>
        <div id="shop-container"></div>
    </div>

    <div class="view-panel" id="view-exchange">
        <h2>–¶–µ–Ω—Ç—Ä –û–±–º–µ–Ω–∞</h2>
        <div class="stat-node" style="margin: 30px 0; background: rgba(255,204,0,0.05); border-color: var(--p-gold);">
            <p style="margin-bottom:10px;">–ö—É—Ä—Å –ø–µ—Ä–µ–ø–ª–∞–≤–∫–∏:</p>
            <h3>100,000 üíé ‚ûî 1 üí∞</h3>
            <p style="margin-top:15px; font-size:12px; opacity:0.7;">–í–ù–ò–ú–ê–ù–ò–ï: –°–ª–∏—Ç–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞–≤—Å–µ–≥–¥–∞, –Ω–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è!</p>
        </div>
        <button id="exchange-btn" class="action-btn" style="display:none;" onclick="NebulaGame.processPrestige()">–û–ë–ú–ï–ù–Ø–¢–¨</button>
        <div id="exchange-lock" style="text-align:center; color:#ff3b30; font-weight:700;">–î–û–°–¢–ò–ì–ù–ò–¢–ï 15 –£–†–û–í–ù–Ø</div>
    </div>

    <div class="view-panel" id="view-friends">
        <h2>–í–∞—à–∞ –ê—Ä—Ç–µ–ª—å</h2>
        <div class="stat-node" style="margin: 25px 0;">
            <p>–í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ <span style="color:var(--p-blue)">20%</span> –æ—Ç –≤—Å–µ–π –¥–æ–±—ã—á–∏ –≤–∞—à–∏—Ö –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö –¥—Ä—É–∑–µ–π!</p>
        </div>
        <button class="action-btn" onclick="NebulaGame.inviteColleague()">–ü–†–ò–ì–õ–ê–°–ò–¢–¨ –ù–ê–ü–ê–†–ù–ò–ö–ê</button>
    </div>

    <nav class="nav-bar">
        <a href="#" class="nav-link active" onclick="SystemUI.switchTab('main', this)"><i>‚õèÔ∏è</i><span>–î–æ–±—ã—á–∞</span></a>
        <a href="#" class="nav-link" onclick="SystemUI.switchTab('shop', this)"><i>üõí</i><span>–ú–∞–≥–∞–∑–∏–Ω</span></a>
        <a href="#" class="nav-link" onclick="SystemUI.switchTab('exchange', this)"><i>üí∞</i><span>–û–±–º–µ–Ω</span></a>
        <a href="#" class="nav-link" onclick="SystemUI.switchTab('friends', this)"><i>üë•</i><span>–î—Ä—É–∑—å—è</span></a>
    </nav>

    <script>
    /**
     * –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Nebula Gold Elite Pro
     * –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, –¢–∞–π–º–µ—Ä—ã, –ë–∞–∑–æ–≤–∞—è —Å–∏–ª–∞ –∫–ª–∏–∫–∞.
     */
    const NebulaGame = {
        firestore: null,
        tg: window.Telegram.WebApp,
        uid: null,
        currentTab: 'main',
        
        // –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö (–ë–∞–∑–æ–≤—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
        state: {
            balance: 0,
            gold: 0,
            power: 1.0, // –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –±–∞–∑–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ 1.0
            level: 1,
            exp: 0,
            upgrades: [0, 0, 0, 0],
            multiplier: 1
        },

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–∞–≥–∞–∑–∏–Ω–∞
        catalog: [
            { id: 0, name: "–ö–≤–∞—Ä—Ü–µ–≤—ã–π –º–æ–ª–æ—Ç", price: 200, bonus: 0.5 },
            { id: 1, name: "–ü–Ω–µ–≤–º–æ-–ø—Ä–µ—Å—Å", price: 1500, bonus: 2.5 },
            { id: 2, name: "–ü–ª–∞–∑–º–µ–Ω–Ω—ã–π —Ä–µ–∑–∞–∫", price: 12000, bonus: 12.0 },
            { id: 3, name: "–°–∏–Ω–≥—É–ª—è—Ä–Ω—ã–π –±—É—Ä", price: 75000, bonus: 60.0 }
        ],

        offerTimer: { active: false, seconds: 0, interval: null },

        async init() {
            this.tg.expand();
            this.uid = this.tg.initDataUnsafe?.user?.id?.toString() || "WEB_DEBUG_USER";

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase (–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏–∑ –ø—Ä–æ—à–ª—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤)
            firebase.initializeApp({
                apiKey: "AIzaSyCoa29KS-sin6hoRz0ZbE4f3ki0tZLwkKI",
                projectId: "gold-clicker-5d882",
                appId: "1:83489312782:web:ee5b7bdc390e53e7dd6c5f"
            });
            this.firestore = firebase.firestore();

            // –õ–æ–≥–∏–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
            const localData = localStorage.getItem(`nebula_pro_${this.uid}`);
            if (localData) this.state = JSON.parse(localData);

            try {
                const cloudDoc = await this.firestore.collection('players').doc(this.uid).get();
                if (cloudDoc.exists) {
                    const cloudData = cloudDoc.data();
                    // –ú–µ—Ä–¥–∂–∏–Ω–≥: –±–µ—Ä–µ–º –ª—É—á—à–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∑–æ–ª–æ—Ç–∞ –∏–ª–∏ –±–∞–ª–∞–Ω—Å–∞
                    if (cloudData.gold > this.state.gold || cloudData.balance > this.state.balance) {
                        this.state = {...this.state, ...cloudData};
                    }
                }
            } catch (err) { console.error("Cloud Sync Error", err); }

            // –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º
            VisualFX.setup();
            document.getElementById('crystal-trigger').onclick = (e) => this.handleTap(e);
            
            // –§–æ–Ω–æ–≤—ã–µ —Ü–∏–∫–ª—ã
            setInterval(() => this.syncToCloud(), 15000); // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫
            setInterval(() => this.runOfferEngine(), 40000); // –û—Ñ—Ñ–µ—Ä –∫–∞–∂–¥—ã–µ 40 —Å–µ–∫
            
            this.updateFrame();
        },

        handleTap(e) {
            const income = this.state.power * this.state.multiplier;
            this.state.balance += income;
            this.state.exp += 12; // –û–ø—ã—Ç –∑–∞ –∫–ª–∏–∫
            
            VisualFX.spawnFloatingText(e.clientX, e.clientY, `+${income.toFixed(1)}`);
            if (this.tg.HapticFeedback) this.tg.HapticFeedback.impactOccurred('light');
            
            this.processLeveling();
        },

        processLeveling() {
            const goal = this.state.level * 1500;
            if (this.state.exp >= goal) {
                this.state.exp = 0;
                this.state.level++;
                this.syncToCloud();
            }
        },

        runOfferEngine() {
            if (this.currentTab !== 'main') return;
            
            const bonusAmount = Math.floor(5000 + (this.state.balance * 0.12));
            document.getElementById('offer-description').innerText = `–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∞–Ω–æ–º–∞–ª–∏—è!\n–°–æ–±–µ—Ä–∏—Ç–µ ${bonusAmount.toLocaleString()} üíé —á–µ—Ä–µ–∑ —Ä–µ–∫–ª–∞–º–Ω—ã–π –∫–∞–Ω–∞–ª.`;
            
            const ui = document.getElementById('special-offer-ui');
            const timerLabel = document.getElementById('offer-countdown');
            
            ui.classList.add('visible');
            this.offerTimer.seconds = 10;
            
            if (this.offerTimer.interval) clearInterval(this.offerTimer.interval);
            this.offerTimer.interval = setInterval(() => {
                this.offerTimer.seconds--;
                timerLabel.innerText = `–ò–°–ß–ï–ó–ù–ï–¢ –ß–ï–†–ï–ó: ${this.offerTimer.seconds} –°–ï–ö`;
                
                if (this.offerTimer.seconds <= 0) {
                    clearInterval(this.offerTimer.interval);
                    ui.classList.remove('visible');
                }
            }, 1000);
        },

        handleOfferClaim() {
            const ad = Adsgram.init({ blockId: "19969" });
            ad.show().then(() => {
                const bonus = Math.floor(5000 + (this.state.balance * 0.12));
                this.state.balance += bonus;
                document.getElementById('special-offer-ui').classList.remove('visible');
                clearInterval(this.offerTimer.interval);
                this.syncToCloud();
            }).catch(() => { this.tg.showAlert("–†–µ–∫–ª–∞–º–∞ –Ω–µ –≥–æ—Ç–æ–≤–∞"); });
        },

        triggerAd(mode) {
            const ad = Adsgram.init({ blockId: "19969" });
            ad.show().then(() => {
                if (mode === 'boost') {
                    this.state.multiplier = 3;
                    setTimeout(() => { this.state.multiplier = 1; }, 30000);
                    this.tg.showAlert("–§–û–†–°–ê–ñ x3 –í–ö–õ–Æ–ß–ï–ù!");
                }
                this.syncToCloud();
            });
        },

        async syncToCloud() {
            localStorage.setItem(`nebula_pro_${this.uid}`, JSON.stringify(this.state));
            try {
                await this.firestore.collection('players').doc(this.uid).set(this.state, { merge: true });
            } catch (e) { console.warn("Background Save Failed"); }
        },

        processPrestige() {
            if (this.state.balance >= 100000 && this.state.level >= 15) {
                this.state.balance -= 100000;
                this.state.gold += 1;
                // –°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø—Ä–µ—Å—Ç–∏–∂–∞
                this.state.upgrades = [0, 0, 0, 0];
                this.state.power = 1.0; 
                this.syncToCloud();
                SystemUI.renderCatalog();
                this.tg.showPopup({ title: "–ü–µ—Ä–µ–ø–ª–∞–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞", message: "–í—ã –ø–æ–ª—É—á–∏–ª–∏ —Å–ª–∏—Ç–æ–∫! –ú–æ—â–Ω–æ—Å—Ç—å —Å–±—Ä–æ—à–µ–Ω–∞." });
            }
        },

        updateFrame() {
            document.getElementById('ui-balance').innerText = Math.floor(this.state.balance).toLocaleString();
            document.getElementById('ui-gold').innerText = this.state.gold;
            document.getElementById('ui-power').innerText = (this.state.power * this.state.multiplier).toFixed(1);
            document.getElementById('ui-level').innerText = this.state.level;

            // –õ–æ–≥–∏–∫–∞ –∫–Ω–æ–ø–∫–∏ –æ–±–º–µ–Ω–∞
            const canEx = this.state.level >= 15 && this.state.balance >= 100000;
            document.getElementById('exchange-btn').style.display = canEx ? 'block' : 'none';
            document.getElementById('exchange-lock').style.display = canEx ? 'none' : 'block';

            requestAnimationFrame(() => this.updateFrame());
        },

        purchaseUpgrade(idx) {
            const item = this.catalog[idx];
            const currentLevel = this.state.upgrades[idx];
            const price = Math.floor(item.price * Math.pow(1.85, currentLevel));

            if (this.state.balance >= price) {
                this.state.balance -= price;
                this.state.upgrades[idx]++;
                this.state.power += item.bonus;
                SystemUI.renderCatalog();
                this.syncToCloud();
            } else {
                this.tg.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ—Å—É—Ä—Å–æ–≤!");
            }
        },

        inviteColleague() {
            const link = `https://t.me/Locus_Gold_bot/app?startapp=${this.uid}`;
            this.tg.openTelegramLink(`https://t.me/share/url?url=${link}&text=–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ –º–æ–µ–π –∞—Ä—Ç–µ–ª–∏ –≤ Nebula Gold!`);
        }
    };

    const SystemUI = {
        switchTab(id, el) {
            NebulaGame.currentTab = id;
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.querySelectorAll('.view-panel').forEach(v => v.classList.remove('active'));
            
            el.classList.add('active');
            if (id !== 'main') {
                const p = document.getElementById(`view-${id}`);
                if (p) p.classList.add('active');
                if (id === 'shop') this.renderCatalog();
            }
        },

        renderCatalog() {
            const container = document.getElementById('shop-container');
            container.innerHTML = NebulaGame.catalog.map((itm, i) => {
                const lvl = NebulaGame.state.upgrades[i];
                const price = Math.floor(itm.price * Math.pow(1.85, lvl));
                return `
                    <div class="upgrade-item" onclick="NebulaGame.purchaseUpgrade(${i})">
                        <div>
                            <b>${itm.name} [–£—Ä. ${lvl}]</b><br>
                            <small>+${itm.bonus} –∫ –º–æ—â–Ω–æ—Å—Ç–∏</small>
                        </div>
                        <div style="font-weight:900; color: #ffcc00;">${price.toLocaleString()} üíé</div>
                    </div>
                `;
            }).join('');
        }
    };

    const VisualFX = {
        canvas: document.getElementById('fx-canvas'),
        ctx: null,
        particles: [],

        setup() {
            this.ctx = this.canvas.getContext('2d');
            this.resize();
            window.addEventListener('resize', () => this.resize());
            this.animate();
        },

        resize() {
            this.canvas.width = window.innerWidth;
            this.canvas.height = window.innerHeight;
        },

        spawnFloatingText(x, y, text) {
            this.particles.push({ x, y, text, life: 1, vel: Math.random() * 2 + 1 });
        },

        animate() {
            this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
            this.ctx.font = "bold 28px Inter";
            
            for (let i = this.particles.length - 1; i >= 0; i--) {
                let p = this.particles[i];
                p.y -= p.vel;
                p.life -= 0.02;
                
                this.ctx.fillStyle = `rgba(0, 212, 255, ${p.life})`;
                this.ctx.fillText(p.text, p.x - 20, p.y);
                
                if (p.life <= 0) this.particles.splice(i, 1);
            }
            requestAnimationFrame(() => this.animate());
        }
    };

    window.onload = () => NebulaGame.init();
    </script>
</body>
</html>
