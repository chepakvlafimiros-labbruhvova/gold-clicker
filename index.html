<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Locus Gold Elite Pro</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>

    <style>
        :root {
            --bg: #0b0b0c;
            --surface: #19191b;
            --accent: #ff9d00;
            --text-dim: #8e8e93;
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: #fff; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        .screen { position: absolute; inset: 0; display: none; flex-direction: column; padding: 20px 20px calc(90px + var(--safe-bottom)); overflow-y: auto; }
        .screen.active { display: flex; }

        /* –ë–∞–ª–∞–Ω—Å */
        .header { text-align: center; padding: 20px 0; }
        .gold-count { font-size: 48px; font-weight: 800; color: var(--accent); }
        
        /* –°–µ—Ç–∫–∞ —Å—Ç–∞—Ç–æ–≤ */
        .stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .stat-box { background: var(--surface); padding: 12px; border-radius: 15px; text-align: center; border: 1px solid #2c2c2e; }
        .stat-box small { font-size: 10px; color: var(--text-dim); text-transform: uppercase; display: block; }
        
        /* –ú–æ–Ω–µ—Ç–∞ */
        .coin-wrap { flex: 1; display: flex; align-items: center; justify-content: center; position: relative; }
        .coin {
            width: 200px; height: 200px; border-radius: 50%;
            background: linear-gradient(145deg, #ffb000, #e68a00);
            box-shadow: 0 10px 30px rgba(255, 157, 0, 0.2);
            display: flex; align-items: center; justify-content: center;
            transition: transform 0.1s; cursor: pointer; border: 8px solid #252527;
        }
        .coin:active { transform: scale(0.95); }
        .coin-icon { font-size: 80px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2)); }

        /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: auto; }
        .btn { background: var(--surface); border: 1px solid #2c2c2e; border-radius: 16px; padding: 14px; text-align: center; cursor: pointer; transition: 0.2s; }
        .btn:active { background: #252527; }
        
        /* –†–µ–∫–ª–∞–º–Ω–∞—è –∫–Ω–æ–ø–∫–∞ (–≤–∏–∑—É–∞–ª—å–Ω–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è) */
        .btn-ad { border: 1px dashed var(--accent); background: rgba(255, 157, 0, 0.05); }
        .btn-ad b { color: var(--accent); display: block; font-size: 14px; }
        
        /* –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ–∫–∞—á–∫–∏ (–±–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å) */
        .btn-main { grid-column: span 2; background: var(--accent); color: #000; border: none; font-weight: 700; }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav { position: fixed; bottom: 0; width: 100%; height: calc(70px + var(--safe-bottom)); background: #121213; border-top: 1px solid #2c2c2e; display: flex; padding-bottom: var(--safe-bottom); }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--text-dim); cursor: pointer; }
        .nav-item.active { color: var(--accent); }
        .nav-item span { font-size: 10px; font-weight: 600; margin-top: 4px; }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –∫–ª–∏–∫–∞ */
        .pop { position: absolute; color: var(--accent); font-weight: 800; pointer-events: none; animation: floatUp 0.6s ease-out forwards; }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-80px); } }
    </style>
</head>
<body>

    <div class="screen active" id="scr-main">
        <div class="header">
            <div class="gold-count" id="gold-val">0.000</div>
            <p style="color: var(--text-dim); font-size: 12px;">AVAILABLE GOLD</p>
        </div>

        <div class="stats">
            <div class="stat-box"><small>Power</small><b id="pwr-val">0.001</b></div>
            <div class="stat-box"><small>Rank</small><b id="rank-val">Beginner</b></div>
        </div>

        <div class="coin-wrap">
            <div class="coin" id="coin-btn"><span class="coin-icon">G</span></div>
        </div>

        <div class="btn-group">
            <div class="btn btn-main" onclick="Game.upgrade()">
                <span id="upg-txt">UPGRADE (1.000 G)</span>
            </div>
            
            <div class="btn btn-ad" onclick="Game.showAd('gold')">
                <b>FREE BONUS</b>
                <small>Get +5.000 G</small>
            </div>
            <div class="btn btn-ad" onclick="Game.showAd('pwr')">
                <b>BOOST</b>
                <small>+0.005 Power</small>
            </div>
        </div>
    </div>

    <div class="screen" id="scr-wallet">
        <h2 style="text-align:center; margin-bottom:20px;">WITHDRAW</h2>
        <div class="stat-box" style="margin-bottom:20px;">
            <p>Minimum: 750 G</p>
            <button class="btn btn-main" style="width:100%; margin-top:10px;" onclick="Game.withdraw()">WITHDRAW</button>
        </div>
        <div id="history-list"></div>
    </div>

    <nav class="nav">
        <div class="nav-item active" onclick="UI.nav('main', this)"><i>‚õèÔ∏è</i><span>Mining</span></div>
        <div class="nav-item" onclick="UI.nav('wallet', this)"><i>üè¶</i><span>Wallet</span></div>
    </nav>

    <script>
    const Game = {
        tg: window.Telegram.WebApp,
        db: null,
        uid: null,
        data: { gold: 0, pwr: 0.001, upg: 0 },
        adBlock: null,

        async init() {
            this.tg.expand();
            this.uid = this.tg.initDataUnsafe?.user?.id?.toString() || "DEV_USER";
            
            // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Adsgram (–≤–∞–∂–Ω–æ: –≤—ã–∑—ã–≤–∞–µ–º –æ–¥–∏–Ω —Ä–∞–∑)
            this.adBlock = window.Adsgram.init({ blockId: "19895" });

            // 2. Firebase (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–∏ –∫–æ–Ω—Ñ–∏–≥–∏)
            firebase.initializeApp({
                apiKey: "AIzaSyCoa29KS-sin6hoRz0ZbE4f3ki0tZLwkKI",
                projectId: "gold-clicker-5d882",
                appId: "1:83489312782:web:ee5b7bdc390e53e7dd6c5f"
            });
            this.db = firebase.firestore();

            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
            const doc = await this.db.collection('players').doc(this.uid).get();
            if(doc.exists) this.data = doc.data();
            
            this.render();
            document.getElementById('coin-btn').addEventListener('touchstart', (e) => this.tap(e));
        },

        tap(e) {
            e.preventDefault();
            this.data.gold += this.data.pwr;
            this.render();
            this.spawn(e.touches[0].clientX, e.touches[0].clientY);
            if(this.tg.HapticFeedback) this.tg.HapticFeedback.impactOccurred('light');
        },

        // –†–ï–ö–õ–ê–ú–ê: –°–¥–µ–ª–∞–Ω–æ –∫–∞–∫ Reward-–±–ª–æ–∫
        async showAd(type) {
            try {
                // –ü—Ä—è–º–æ–µ –∏ —è–≤–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤—ã–∑–æ–≤ –ø–æ –∫–ª–∏–∫—É)
                const result = await this.adBlock.show();
                
                // –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è
                if(type === 'gold') this.data.gold += 5;
                if(type === 'pwr') this.data.pwr += 0.005;
                
                this.render();
                this.save();
                this.tg.showAlert("Reward received!");
            } catch (err) {
                // –ï—Å–ª–∏ —Ä–µ–∫–ª–∞–º–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∏–ª–∏ –∑–∞–∫—Ä—ã—Ç–∞
                if (err.error === 'dismiss') {
                    this.tg.showAlert("Skip detected. No reward.");
                } else {
                    this.tg.showAlert("Ad unavailable. Try again later.");
                }
            }
        },

        upgrade() {
            const price = (this.data.upg + 1) * 1; 
            if(this.data.gold >= price) {
                this.data.gold -= price;
                this.data.pwr += 0.001;
                this.data.upg++;
                this.render();
                this.save();
            } else {
                this.tg.showConfirm("Not enough Gold. Do you want to earn some via bonus?", (res) => {
                    if(res) this.showAd('gold');
                });
            }
        },

        render() {
            document.getElementById('gold-val').innerText = this.data.gold.toFixed(3);
            document.getElementById('pwr-val').innerText = this.data.pwr.toFixed(4);
            document.getElementById('upg-txt').innerText = `UPGRADE (${((this.data.upg + 1) * 1).toFixed(1)} G)`;
        },

        async save() {
            await this.db.collection('players').doc(this.uid).set(this.data, {merge: true});
        },

        spawn(x, y) {
            const el = document.createElement('div');
            el.className = 'pop'; el.innerText = `+${this.data.pwr}`;
            el.style.left = x + 'px'; el.style.top = y + 'px';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 600);
        }
    };

    const UI = {
        nav(id, el) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('scr-' + id).classList.add('active');
            el.classList.add('active');
        }
    };

    window.onload = () => Game.init();
    </script>
</body>
</html>
