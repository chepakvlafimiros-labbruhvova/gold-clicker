<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Locus Gold</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://sad.adsgram.ai/js/adsgram-ad-sdk.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>
        body {
            margin: 0; padding: 0; background-color: #000; color: #fff;
            font-family: 'Roboto', sans-serif; display: flex; flex-direction: column; height: 100vh;
        }
        .page { display: none; flex-direction: column; align-items: center; width: 100%; flex-grow: 1; padding-bottom: 80px; }
        .page.active { display: flex; }

        /* –î–∏–∑–∞–π–Ω —Å—á–µ—Ç–∞ –∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ */
        .score-container {
            margin: 20px 0; width: 90%; background: #1a1a1a;
            border: 1px solid #333; border-radius: 20px; padding: 25px 0;
            text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        .score-label { font-size: 14px; color: #888; text-transform: uppercase; margin-bottom: 5px; }
        #gold-display { font-size: 64px; font-weight: 900; color: #ffca28; margin: 0; text-shadow: 0 0 20px rgba(255,202,40,0.3); }

        /* –ö–Ω–æ–ø–∫–∞-–º–æ–Ω–µ—Ç–∞ */
        .coin-section { flex-grow: 1; display: flex; align-items: center; justify-content: center; }
        #click-btn {
            width: 240px; height: 240px; background: #ffca28; border-radius: 50%;
            border: 8px solid #b8860b; font-size: 100px; font-weight: bold; color: #000;
            cursor: pointer; box-shadow: 0 0 50px rgba(255, 202, 40, 0.4); transition: transform 0.05s;
            display: flex; align-items: center; justify-content: center;
        }
        #click-btn:active { transform: scale(0.92); }

        /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
        .actions { width: 90%; display: flex; flex-direction: column; gap: 12px; margin: 20px 0; }
        .btn { 
            padding: 18px; border-radius: 15px; border: none; font-weight: bold; 
            font-size: 16px; cursor: pointer; color: #fff; display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn-ad { background: #2ecc71; } /* –ó–µ–ª–µ–Ω–∞—è –∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω–µ */
        .btn-upgrade { background: #3498db; } /* –°–∏–Ω—è—è */
        .btn-withdraw { background: #444; color: #888; cursor: not-allowed; }
        .btn-withdraw.active { background: #e67e22; color: #fff; cursor: pointer; }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .tab-bar { position: fixed; bottom: 0; width: 100%; display: flex; background: #111; border-top: 1px solid #222; }
        .tab { flex: 1; padding: 20px 0; text-align: center; font-size: 12px; color: #555; font-weight: bold; }
        .tab.active { color: #ffca28; border-top: 2px solid #ffca28; }
    </style>
</head>
<body>

    <div class="score-container">
        <div class="score-label">–í–ê–®–ï –ó–û–õ–û–¢–û</div>
        <div id="gold-display">0</div>
    </div>

    <div id="page-main" class="page active">
        <div class="coin-section">
            <button id="click-btn">G</button>
        </div>
        <div class="actions">
            <button class="btn btn-ad" onclick="showRewardedAd()">üì∫ +10.000 G (–ë–û–ù–£–°)</button>
            <button class="btn btn-upgrade" onclick="buyUpgrade()">üöÄ +0.001 –ö –ö–õ–ò–ö–£</button>
        </div>
    </div>

    <div id="page-withdraw" class="page">
        <div class="actions" style="margin-top: 50px;">
            <button id="withdraw-btn" class="btn btn-withdraw" onclick="requestWithdraw()">üí∏ –í–´–í–ï–°–¢–ò (–ú–ò–ù. 750)</button>
        </div>
        <p style="color: #666; font-size: 12px; text-align: center; width: 80%;">–í—ã–≤–æ–¥ –¥–æ—Å—Ç—É–ø–µ–Ω –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ 750 –∑–æ–ª–æ—Ç–∞.</p>
    </div>

    <div class="tab-bar">
        <div class="tab active" onclick="showPage('main', this)">–ì–õ–ê–í–ù–ê–Ø</div>
        <div class="tab" onclick="showPage('withdraw', this)">–í–´–í–û–î</div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥ Firebase –∏–∑ —Ç–≤–æ–∏—Ö —Å–∫—Ä–∏–Ω–æ–≤
        const firebaseConfig = {
            apiKey: "AIzaSyCoa29KS-sin6hoRz0ZbE4f3ki0tZLwkKI",
            authDomain: "gold-clicker-5d882.firebaseapp.com",
            projectId: "gold-clicker-5d882",
            storageBucket: "gold-clicker-5d882.firebasestorage.app",
            messagingSenderId: "83489312782",
            appId: "1:83489312782:web:ee5b7bdc390e53e7dd6c5f"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const tg = window.Telegram.WebApp;
        tg.expand();

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AdsGram —Å —Ç–≤–æ–∏–º ID
        const AdController = window.Adsgram.init({ blockId: "19883" });

        const userId = tg.initDataUnsafe?.user?.id ? tg.initDataUnsafe.user.id.toString() : "5223115893";
        const playerRef = db.collection('players').doc(userId);

        let gold = 0;
        let clickPower = 1;

        async function init() {
            const doc = await playerRef.get();
            if (doc.exists) {
                const data = doc.data();
                gold = Number(data.gold) || 0;
                clickPower = data.clickPower || 1;
            }
            updateUI();
        }

        function updateUI() {
            document.getElementById('gold-display').innerText = Math.floor(gold);
            const wBtn = document.getElementById('withdraw-btn');
            if (gold >= 750) {
                wBtn.classList.add('active');
            } else {
                wBtn.classList.remove('active');
            }
        }

        // –õ–æ–≥–∏–∫–∞ –∫–ª–∏–∫–∞
        document.getElementById('click-btn').addEventListener('click', () => {
            gold += clickPower;
            updateUI();
            playerRef.update({ gold: gold });
            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
        });

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —Ä–µ–∫–ª–∞–º—ã
        async function showRewardedAd() {
            try {
                const result = await AdController.show();
                // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ—Å–º–æ—Ç—Ä–µ–ª —Ä–µ–∫–ª–∞–º—É
                gold += 10;
                updateUI();
                playerRef.update({ gold: gold });
                tg.showAlert("–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –ø–æ–ª—É—á–∏–ª–∏ 10 –∑–æ–ª–æ—Ç—ã—Ö!");
            } catch (error) {
                // –ï—Å–ª–∏ —Ä–µ–∫–ª–∞–º–∞ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å –∏–ª–∏ –±—ã–ª–∞ –ø—Ä–æ–ø—É—â–µ–Ω–∞
                console.error(error);
                tg.showAlert("–†–µ–∫–ª–∞–º–∞ –ø–æ–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –∏–ª–∏ –±—ã–ª–∞ –ø—Ä–æ–ø—É—â–µ–Ω–∞.");
            }
        }

        function buyUpgrade() {
            if (gold >= 100) {
                gold -= 100;
                clickPower += 0.5;
                updateUI();
                playerRef.update({ gold: gold, clickPower: clickPower });
                tg.showAlert("–£–ª—É—á—à–µ–Ω–∏–µ –∫—É–ø–ª–µ–Ω–æ!");
            } else {
                tg.showAlert("–ù—É–∂–Ω–æ 100 –∑–æ–ª–æ—Ç–∞ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è.");
            }
        }

        function requestWithdraw() {
            if (gold < 750) return;
            const wallet = prompt("–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∫–æ—à–µ–ª–µ–∫:");
            if (wallet) {
                db.collection('withdrawals').add({
                    userId, wallet, amount: gold, status: 'pending', date: new Date().toISOString()
                });
                gold = 0;
                playerRef.update({ gold: 0 });
                updateUI();
                tg.showAlert("–ó–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥ —Å–æ–∑–¥–∞–Ω–∞!");
            }
        }

        function showPage(pageId, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + pageId).classList.add('active');
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
        }

        init();
    </script>
</body>
</html>
