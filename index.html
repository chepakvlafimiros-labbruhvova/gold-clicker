<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Locus Nebula Elite</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>

    <style>
        :root {
            --p-color: #00d4ff;
            --accent-gold: #ffcc00;
            --bg-dark: #050507;
            --card-bg: rgba(255, 255, 255, 0.05);
            --border: rgba(255, 255, 255, 0.1);
            --safe-area: env(safe-area-inset-bottom);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; user-select: none; touch-action: none; }
        body { background: var(--bg-dark); color: #fff; height: 100vh; overflow: hidden; position: fixed; width: 100%; }

        .app { display: flex; flex-direction: column; height: 100%; padding: 20px 20px calc(90px + var(--safe-area)); }

        /* –ë–∞–ª–∞–Ω—Å */
        .header { text-align: center; margin-bottom: 20px; }
        .balance-value { font-size: 44px; font-weight: 900; background: linear-gradient(#fff, #999); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* –®–∫–∞–ª–∞ —É—Ä–æ–≤–Ω—è */
        .level-box { background: var(--card-bg); border: 1px solid var(--border); padding: 12px; border-radius: 15px; margin-top: 15px; }
        .level-info { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 6px; font-weight: bold; color: var(--p-color); }
        .progress-bg { width: 100%; height: 10px; background: #111; border-radius: 5px; overflow: hidden; border: 1px solid var(--border); }
        .progress-fill { height: 100%; width: 0%; background: var(--p-color); box-shadow: 0 0 10px var(--p-color); transition: width 0.1s ease-out; }

        /* –¶–µ–Ω—Ç—Ä */
        .main-game { flex: 1; display: flex; align-items: center; justify-content: center; position: relative; }
        .crystal { width: 220px; height: 220px; background: linear-gradient(135deg, var(--p-color), #0055ff); clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%); display: flex; align-items: center; justify-content: center; transition: transform 0.05s; z-index: 10; shadow: 0 0 30px rgba(0, 212, 255, 0.3); }
        .crystal:active { transform: scale(0.92); }
        .crystal span { font-size: 80px; }

        /* –ö–Ω–æ–ø–∫–∏ */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .card { background: var(--card-bg); border: 1px solid var(--border); padding: 12px; border-radius: 15px; text-align: center; }
        .card b { display: block; font-size: 16px; }
        .card span { font-size: 10px; color: #777; text-transform: uppercase; }

        .btn-ad { grid-column: span 2; background: linear-gradient(90deg, #ff9d00, #ff5e00); border: none; padding: 15px; border-radius: 15px; color: #fff; font-weight: 900; font-size: 13px; margin-top: 10px; }
        .btn-ad:disabled { opacity: 0.5; filter: grayscale(1); }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav { position: fixed; bottom: 0; left: 0; right: 0; height: calc(70px + var(--safe-area)); background: #0a0a0c; display: flex; border-top: 1px solid var(--border); padding-bottom: var(--safe-area); }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #555; }
        .nav-item.active { color: var(--p-color); }
        .nav-item i { font-size: 22px; font-style: normal; margin-bottom: 2px; }
        .nav-item span { font-size: 10px; font-weight: bold; text-transform: uppercase; }

        /* –≠–∫—Ä–∞–Ω—ã */
        .screen { position: fixed; inset: 0; background: var(--bg-dark); z-index: 100; display: none; padding: 25px; padding-bottom: 100px; overflow-y: auto; }
        .screen.active { display: block; }
        .upg-row { background: var(--card-bg); padding: 15px; border-radius: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border); }

        .vfx { position: absolute; pointer-events: none; color: var(--p-color); font-weight: 900; animation: vfx 0.6s forwards; z-index: 1000; font-size: 24px; }
        @keyframes vfx { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-100px); } }
    </style>
</head>
<body>

    <div class="app">
        <div class="header">
            <div class="balance-value" id="ui-bal">0</div>
            <div class="level-box">
                <div class="level-info">
                    <span id="ui-lvl-name">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                    <span id="ui-lvl-num">–£–†. 1</span>
                </div>
                <div class="progress-bg"><div class="progress-fill" id="ui-bar"></div></div>
            </div>
        </div>

        <div class="main-game">
            <div class="crystal" id="tap-zone"><span>üíé</span></div>
        </div>

        <div class="grid">
            <div class="card"><span>–ö–ª–∏–∫</span><b id="ui-pwr">1.0</b></div>
            <div class="card"><span>–ê–≤—Ç–æ</span><b id="ui-dps">0.0</b></div>
            <button class="btn-ad" id="ui-ad" onclick="Game.watchAd()">üî• –ë–£–°–¢ x3 –ó–ê –†–ï–ö–õ–ê–ú–£ (30 –°–ï–ö)</button>
        </div>
    </div>

    <div class="screen" id="scr-upg">
        <h2 style="margin-bottom:20px">–£–ª—É—á—à–µ–Ω–∏—è</h2>
        <div id="upg-list"></div>
    </div>

    <div class="screen" id="scr-market">
        <h2 style="margin-bottom:20px">–ú–∞—Ä–∫–µ—Ç</h2>
        <div id="market-content">
            <div class="upg-row" style="flex-direction: column; text-align: center; gap: 10px;">
                <p>–û–±–º–µ–Ω –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤ –Ω–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã</p>
                <div id="exchange-lock" style="color: #ff3b30; font-size: 14px; font-weight: bold;">–¢–†–ï–ë–£–ï–¢–°–Ø 15 –£–†–û–í–ï–ù–¨</div>
                <button id="exchange-btn" style="display:none; width:100%; padding:15px; border-radius:10px; border:none; background:var(--p-color); font-weight:900;" onclick="Game.doExchange()">–û–ë–ú–ï–ù–Ø–¢–¨</button>
            </div>
        </div>
    </div>

    <nav class="nav">
        <div class="nav-item active" onclick="UI.tab('main', this)"><i>üõ∏</i><span>–î–æ–±—ã—á–∞</span></div>
        <div class="nav-item" onclick="UI.tab('upg', this)"><i>üõ†Ô∏è</i><span>–ê–ø–≥—Ä–µ–π–¥—ã</span></div>
        <div class="nav-item" onclick="UI.tab('market', this)"><i>üåå</i><span>–ú–∞—Ä–∫–µ—Ç</span></div>
    </nav>

    <script>
        const Game = {
            data: { bal: 0, pwr: 1, dps: 0, xp: 0, lvl: 1, boost: 1, upgC: 0, upgA: 0 },
            titles: ["–ù–æ–≤–∏—á–æ–∫", "–°—Ç–∞—Ä–∞—Ç–µ–ª—å", "–®–∞—Ö—Ç–µ—Ä", "–ú–∞—Å—Ç–µ—Ä", "–ü—Ä–æ—Ñ–∏", "–≠–ª–∏—Ç–∞", "–õ–µ–≥–µ–Ω–¥–∞", "–¢–∏—Ç–∞–Ω", "–ë–æ–≥ –ù–µ–±—É–ª—ã", "–°–æ–∑–¥–∞—Ç–µ–ª—å"],
            
            init() {
                this.load();
                
                // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–ª–∏–∫–∞ –¥–ª—è –º–æ–±–∏–ª–æ–∫ (—É–±–∏—Ä–∞–µ—Ç –∑–∞–¥–µ—Ä–∂–∫—É 300–º—Å)
                const zone = document.getElementById('tap-zone');
                zone.addEventListener('touchstart', (e) => {
                    e.preventDefault(); // –ó–∞–ø—Ä–µ—Ç –∑—É–º–∞ –∏ —Å–∫—Ä–æ–ª–ª–∞
                    for(let i=0; i<e.changedTouches.length; i++) {
                        this.tap(e.changedTouches[i].clientX, e.changedTouches[i].clientY);
                    }
                }, { passive: false });

                this.startAuto();
                this.render();
                setInterval(() => this.save(), 5000);
            },

            tap(x, y) {
                const gain = this.data.pwr * this.data.boost;
                this.data.bal += gain;
                this.data.xp += 10;
                
                this.checkLvl();
                this.render();
                this.spawnVfx(x, y, `+${gain.toFixed(1)}`);
                
                if(window.Telegram && Telegram.WebApp.HapticFeedback) {
                    Telegram.WebApp.HapticFeedback.impactOccurred('light');
                }
            },

            checkLvl() {
                const req = this.data.lvl * 800;
                if(this.data.xp >= req) {
                    this.data.xp = 0;
                    this.data.lvl++;
                    if(window.Telegram) Telegram.WebApp.showAlert(`–£—Ä–æ–≤–µ–Ω—å –ø–æ–≤—ã—à–µ–Ω! –í–∞—à —Ä–∞–Ω–≥: ${this.titles[this.data.lvl-1] || "–õ–µ–≥–µ–Ω–¥–∞"}`);
                }
            },

            watchAd() {
                // –ò–º–∏—Ç–∞—Ü–∏—è Adsgram –¥–ª—è —Ç–µ—Å—Ç–∞, –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –≤—ã–∑–æ–≤
                const btn = document.getElementById('ui-ad');
                btn.disabled = true;
                this.data.boost = 3;
                
                let timer = 30;
                const clock = setInterval(() => {
                    timer--;
                    btn.innerText = `–Ø–†–û–°–¢–¨ x3: ${timer}s`;
                    if(timer <= 0) {
                        clearInterval(clock);
                        this.data.boost = 1;
                        btn.disabled = false;
                        btn.innerText = `üî• –ë–£–°–¢ x3 –ó–ê –†–ï–ö–õ–ê–ú–£ (30 –°–ï–ö)`;
                        this.render();
                    }
                }, 1000);
            },

            buy(type) {
                const cost = type === 'pwr' ? 
                    Math.floor(100 * Math.pow(1.5, this.data.upgC)) : 
                    Math.floor(500 * Math.pow(1.6, this.data.upgA));

                if(this.data.bal >= cost) {
                    this.data.bal -= cost;
                    if(type === 'pwr') { this.data.upgC++; this.data.pwr += 0.5; }
                    else { this.data.upgA++; this.data.dps += 1.2; }
                    this.render();
                    UI.drawUpg();
                    this.save();
                } else {
                    if(window.Telegram) Telegram.WebApp.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤!");
                }
            },

            startAuto() {
                setInterval(() => {
                    if(this.data.dps > 0) {
                        this.data.bal += this.data.dps / 10;
                        this.render();
                    }
                }, 100);
            },

            render() {
                document.getElementById('ui-bal').innerText = Math.floor(this.data.bal).toLocaleString();
                document.getElementById('ui-pwr').innerText = (this.data.pwr * this.data.boost).toFixed(1);
                document.getElementById('ui-dps').innerText = this.data.dps.toFixed(1);
                
                const idx = Math.min(this.data.lvl - 1, this.titles.length - 1);
                document.getElementById('ui-lvl-name').innerText = this.titles[idx];
                document.getElementById('ui-lvl-num').innerText = `–£–†. ${this.data.lvl}`;
                
                const req = this.data.lvl * 800;
                document.getElementById('ui-bar').style.width = (this.data.xp / req * 100) + "%";

                // –õ–æ–≥–∏–∫–∞ –º–∞—Ä–∫–µ—Ç–∞
                if(this.data.lvl >= 15) {
                    document.getElementById('exchange-lock').style.display = 'none';
                    document.getElementById('exchange-btn').style.display = 'block';
                }
            },

            spawnVfx(x, y, t) {
                const v = document.createElement('div');
                v.className = 'vfx';
                v.style.left = x + 'px'; v.style.top = y + 'px';
                v.innerText = t;
                document.body.appendChild(v);
                setTimeout(() => v.remove(), 600);
            },

            save() {
                localStorage.setItem('locus_nebula_pro_save', JSON.stringify(this.data));
            },

            load() {
                const saved = localStorage.getItem('locus_nebula_pro_save');
                if(saved) {
                    const obj = JSON.parse(saved);
                    // –ú–µ—Ä–¥–∂–∏–º –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö
                    this.data = {...this.data, ...obj};
                }
            },

            doExchange() {
                const id = prompt("–í–≤–µ–¥–∏—Ç–µ –≤–∞—à ID –¥–ª—è –æ–±–º–µ–Ω–∞:");
                if(id && this.data.bal >= 1000) {
                    alert("–ó–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞! –û–∂–∏–¥–∞–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏.");
                    this.data.bal -= 1000;
                    this.render();
                    this.save();
                } else {
                    alert("–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 1000 –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤!");
                }
            }
        };

        const UI = {
            tab(id, el) {
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                el.classList.add('active');
                if(id !== 'main') {
                    document.getElementById('scr-' + id).classList.add('active');
                    if(id === 'upg') this.drawUpg();
                }
            },

            drawUpg() {
                const list = document.getElementById('upg-list');
                const cP = Math.floor(100 * Math.pow(1.5, Game.data.upgC));
                const cA = Math.floor(500 * Math.pow(1.6, Game.data.upgA));
                list.innerHTML = `
                    <div class="upg-row" onclick="Game.buy('pwr')">
                        <div><b>–ë—É—Ä (–£—Ä. ${Game.data.upgC})</b><br><small>+0.5 –∫ —Å–∏–ª–µ</small></div>
                        <div style="color:var(--p-color);font-weight:900">${cP} üíé</div>
                    </div>
                    <div class="upg-row" onclick="Game.buy('auto')">
                        <div><b>–î—Ä–æ–Ω (–£—Ä. ${Game.data.upgA})</b><br><small>+1.2 –≤ —Å–µ–∫</small></div>
                        <div style="color:var(--p-color);font-weight:900">${cA} üíé</div>
                    </div>
                `;
            }
        };

        window.onload = () => Game.init();
    </script>
</body>
</html>
