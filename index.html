<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Neon Life: Infinity Simulator</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;900&display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root {
            --p: #00f2ff; --s: #7000ff; --bg: #030305;
            --card: rgba(25, 25, 35, 0.9); --border: #2a2a35;
            --text: #e0e0e0; --danger: #ff2d55;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Montserrat', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }

        /* HUD - –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –ø–∞–Ω–µ–ª—å */
        .hud-top {
            padding: 20px; background: linear-gradient(to bottom, #000, transparent);
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; position: relative; z-index: 10;
        }
        .main-stat { font-size: 28px; font-weight: 900; color: var(--p); text-shadow: 0 0 15px rgba(0,242,255,0.4); }
        .sub-stats { display: flex; gap: 10px; font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: #888; }

        /* Bars */
        .status-bars { padding: 0 20px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .bar-wrap { background: #111; height: 4px; border-radius: 2px; overflow: hidden; position: relative; }
        .bar-fill { height: 100%; transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1); }

        /* VIEWPORT */
        .game-window { height: calc(100vh - 220px); overflow-y: auto; padding: 20px; scroll-behavior: smooth; }
        .game-window::-webkit-scrollbar { width: 0; }

        /* CARDS & STORY */
        .story-card {
            background: var(--card); border: 1px solid var(--border); border-radius: 20px;
            padding: 20px; margin-bottom: 20px; backdrop-filter: blur(10px);
            animation: slideUp 0.5s ease-out;
        }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

        .npc-box { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .npc-avatar { width: 50px; height: 50px; border-radius: 50%; border: 2px solid var(--s); background: #222; }

        /* ACTIONS */
        .action-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .choice-btn {
            background: #1a1a25; border: 1px solid var(--border); padding: 15px; border-radius: 12px;
            color: #fff; font-size: 12px; font-weight: 600; text-align: left; transition: 0.3s;
        }
        .choice-btn:active { background: var(--s); transform: scale(0.97); }

        /* NAVIGATION */
        .nav-bar {
            position: fixed; bottom: 0; width: 100%; display: flex; 
            background: rgba(0,0,0,0.9); border-top: 1px solid var(--border);
            padding-bottom: env(safe-area-inset-bottom);
        }
        .nav-item { flex: 1; padding: 15px; text-align: center; color: #666; transition: 0.3s; }
        .nav-item.active { color: var(--p); }
        .nav-item i { font-size: 20px; }

        /* UI ELEMENTS */
        .badge { background: var(--s); color: #fff; padding: 2px 8px; border-radius: 4px; font-size: 9px; margin-left: 5px; }
    </style>
</head>
<body>

    <div class="hud-top">
        <div>
            <div class="main-stat" id="ui-cash">$0</div>
            <div class="sub-stats">
                <span id="ui-job">–ë–µ–∑—Ä–∞–±–æ—Ç–Ω—ã–π</span>
                <span id="ui-age">18 –ª–µ—Ç</span>
            </div>
        </div>
        <div style="text-align: right;">
            <div style="font-size: 10px; color: var(--p);">DAY <span id="ui-day">1</span></div>
            <div id="ui-location" style="font-size: 12px; font-weight: 900;">–¢–†–£–©–û–ë–´</div>
        </div>
    </div>

    <div class="status-bars">
        <div class="bar-wrap"><div id="bar-hp" class="bar-fill" style="background: var(--danger); width: 100%;"></div></div>
        <div class="bar-wrap"><div id="bar-en" class="bar-fill" style="background: var(--p); width: 100%;"></div></div>
        <div class="bar-wrap"><div id="bar-hg" class="bar-fill" style="background: #ff9500; width: 100%;"></div></div>
        <div class="bar-wrap"><div id="bar-sm" class="bar-fill" style="background: #4cd964; width: 100%;"></div></div>
    </div>

    <div class="game-window" id="viewport">
        </div>

    <nav class="nav-bar">
        <div class="nav-item active" onclick="Game.nav('main')"><i class="fas fa-compass"></i></div>
        <div class="nav-item" onclick="Game.nav('social')"><i class="fas fa-users"></i></div>
        <div class="nav-item" onclick="Game.nav('work')"><i class="fas fa-briefcase"></i></div>
        <div class="nav-item" onclick="Game.nav('inv')"><i class="fas fa-backpack"></i></div>
        <div class="nav-item" onclick="Game.showAd()"><i class="fas fa-tv" style="color: var(--p);"></i></div>
    </nav>

<script>
/**
 * INFINITY ENGINE v1.0
 * –ß—Ç–æ–±—ã –¥–æ–π—Ç–∏ –¥–æ 5000 —Å—Ç—Ä–æ–∫, –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–æ–¥—É–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É.
 * –ö–∞–∂–¥–æ–µ —Å–æ–±—ã—Ç–∏–µ (Event) ‚Äî —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π –æ–±—ä–µ–∫—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.
 */

const Database = {
    // –ë–∞–∑–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
    npcs: {
        "stranger": { name: "–¢–∞–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –î–∂–æ", role: "–¢–æ—Ä–≥–æ–≤–µ—Ü", rel: 0, img: "üë§" },
        "boss": { name: "–ì-–Ω –í–µ–∫—Å–ª–µ—Ä", role: "–ë–æ—Å—Å –∫–æ—Ä–ø–æ—Ä–∞—Ü–∏–∏", rel: 0, img: "üëî" },
        "girl": { name: "–ú–∏—è", role: "–°—Ç—É–¥–µ–Ω—Ç–∫–∞", rel: 0, img: "üë©‚Äçü¶∞" }
    },
    // –ë–∞–∑–∞ —Å—é–∂–µ—Ç–Ω—ã—Ö –∫–≤–µ—Å—Ç–æ–≤ (–∑–¥–µ—Å—å –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –¥–æ —Ç—ã—Å—è—á —Å—Ç—Ä–æ–∫)
    events: [
        {
            id: "start_001",
            title: "–ù–æ–≤–æ–µ —É—Ç—Ä–æ",
            desc: "–¢—ã –ø—Ä–æ—Å—ã–ø–∞–µ—à—å—Å—è –≤ —Ö–æ–ª–æ–¥–Ω–æ–º –ø–æ–¥–≤–∞–ª–µ. –í –∫–∞—Ä–º–∞–Ω–µ –ø—É—Å—Ç–æ, –≤ –∂–∏–≤–æ—Ç–µ —É—Ä—á–∏—Ç. –ù–∞ —Å—Ç–æ–ª–µ –ª–µ–∂–∏—Ç –∑–∞–ø–∏—Å–∫–∞ –æ—Ç –î–∂–æ.",
            npc: "stranger",
            choices: [
                { text: "–ü–æ–π—Ç–∏ –∏—Å–∫–∞—Ç—å –î–∂–æ", effect: { en: -10 }, next: "meet_joe" },
                { text: "–û–±—ã—Å–∫–∞—Ç—å –ø–æ–¥–≤–∞–ª", effect: { cash: 5, en: -5 }, next: "search_basement" }
            ]
        },
        {
            id: "meet_joe",
            title: "–í—Å—Ç—Ä–µ—á–∞",
            desc: "–î–∂–æ —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ —Ç–µ–±—è —Å —É—Ö–º—ã–ª–∫–æ–π: '–°–Ω–æ–≤–∞ –Ω–∞ –º–µ–ª–∏? –£ –º–µ–Ω—è –µ—Å—Ç—å –¥–µ–ª—å—Ü–µ...'",
            npc: "stranger",
            choices: [
                { text: "–°–æ–≥–ª–∞—Å–∏—Ç—å—Å—è (–†–∏—Å–∫)", effect: { cash: 100, karma: -10 }, next: "job_done" },
                { text: "–û—Ç–∫–∞–∑–∞—Ç—å—Å—è", effect: { rel: -5 }, next: "start_001" }
            ]
        }
    ]
};

const Game = {
    state: {
        cash: 50, hp: 100, en: 100, hg: 100, sm: 100,
        age: 18, day: 1, location: "–¢—Ä—É—â–æ–±—ã", job: "–ë–µ–∑—Ä–∞–±–æ—Ç–Ω—ã–π",
        inventory: [], rels: {}, currentEvent: "start_001"
    },

    init() {
        this.load();
        this.renderEvent(this.state.currentEvent);
        this.updateHUD();
        this.startLifeCycle();
        
        // Telegram Auth
        if(window.Telegram.WebApp) {
            window.Telegram.WebApp.expand();
            window.Telegram.WebApp.ready();
        }
    },

    // –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –∂–∏–∑–Ω–∏ (–≥–æ–ª–æ–¥, —Å—Ç–∞—Ä–µ–Ω–∏–µ)
    startLifeCycle() {
        setInterval(() => {
            this.state.hg -= 0.5;
            this.state.sm -= 0.2;
            if(this.state.hg <= 0) this.state.hp -= 1;
            this.updateHUD();
        }, 5000);
    },

    // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å—é–∂–µ—Ç–Ω–æ–≥–æ –∫–≤–µ—Å—Ç–∞
    renderEvent(eventId) {
        const ev = Database.events.find(e => e.id === eventId) || Database.events[0];
        this.state.currentEvent = eventId;
        const npc = Database.npcs[ev.npc];

        const html = `
            <div class="story-card">
                ${npc ? `
                    <div class="npc-box">
                        <div class="npc-avatar" style="display:flex;align-items:center;justify-content:center;font-size:30px;">${npc.img}</div>
                        <div>
                            <div style="font-weight:900; font-size:14px;">${npc.name} <span class="badge">${npc.role}</span></div>
                            <div style="font-size:10px; color:var(--p)">–û—Ç–Ω–æ—à–µ–Ω–∏—è: ${this.state.rels[ev.npc] || 0}%</div>
                        </div>
                    </div>
                ` : ''}
                <h3>${ev.title}</h3>
                <p style="margin-top:10px; line-height:1.6; font-size:13px; color:#bbb;">${ev.desc}</p>
                
                <div class="action-btns">
                    ${ev.choices.map((c, i) => `
                        <button class="choice-btn" onclick="Game.makeChoice(${i})">
                            ${c.text}
                        </button>
                    `).join('')}
                </div>
            </div>
        `;
        
        const v = document.getElementById('viewport');
        v.innerHTML = html + v.innerHTML; // –î–æ–±–∞–≤–ª—è–µ–º —Å–≤–µ—Ä—Ö—É
        this.save();
    },

    makeChoice(index) {
        const ev = Database.events.find(e => e.id === this.state.currentEvent);
        const choice = ev.choices[index];

        // –ü—Ä–∏–º–µ–Ω—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç—ã
        if(choice.effect) {
            for(let key in choice.effect) {
                this.state[key] += choice.effect[key];
            }
        }

        this.updateHUD();
        this.renderEvent(choice.next);
        Telegram.WebApp.HapticFeedback.impactOccurred('light');
    },

    updateHUD() {
        document.getElementById('ui-cash').innerText = `$${Math.floor(this.state.cash)}`;
        document.getElementById('ui-age').innerText = `${this.state.age} –ª–µ—Ç`;
        document.getElementById('ui-day').innerText = this.state.day;
        document.getElementById('ui-job').innerText = this.state.job;
        
        // Bars
        document.getElementById('bar-hp').style.width = this.state.hp + '%';
        document.getElementById('bar-en').style.width = this.state.en + '%';
        document.getElementById('bar-hg').style.width = this.state.hg + '%';
        document.getElementById('bar-sm').style.width = this.state.sm + '%';

        if(this.state.hp <= 0) this.gameOver();
    },

    nav(target) {
        // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å, —Ä–∞–±–æ—Ç—É –∏ —Å–æ—Ü–∏–∞–ª–∫—É
        // –î–ª—è 5000 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ —Ç—É—Ç –±—É–¥—É—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
        console.log("Nav to:", target);
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        event.currentTarget.classList.add('active');
    },

    showAd() {
        const ad = Adsgram.init({ blockId: "19895" });
        ad.show().then(() => {
            this.state.cash += 500;
            this.state.hg = 100;
            this.updateHUD();
        });
    },

    save() { localStorage.setItem('neon_life_save', JSON.stringify(this.state)); },
    load() {
        const s = localStorage.getItem('neon_life_save');
        if(s) this.state = Object.assign(this.state, JSON.parse(s));
    },
    gameOver() {
        alert("–¢–≤–æ—è –∏—Å—Ç–æ—Ä–∏—è –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å...");
        localStorage.clear();
        location.reload();
    }
};

window.onload = () => Game.init();
</script>
</body>
</html>
