<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Locus Gold Elite v2.0</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');

        :root {
            --bg: #050505;
            --surface: #121214;
            --accent: #ff9d00;
            --accent-glow: rgba(255, 157, 0, 0.4);
            --error: #ff4b4b;
            --text-main: #ffffff;
            --text-dim: #a1a1aa;
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: var(--bg); 
            color: var(--text-main); 
            height: 100vh; 
            overflow: hidden; 
            position: fixed; 
            width: 100%; 
            display: flex; 
            flex-direction: column; 
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .app-container {
            position: absolute; inset: 0; display: none; flex-direction: column;
            padding: calc(var(--safe-top) + 20px) 20px calc(var(--safe-bottom) + 90px);
            animation: fadeIn 0.4s ease-out;
        }
        .app-container.active { display: flex; }

        /* –•–µ–¥–µ—Ä –±–∞–ª–∞–Ω—Å–∞ */
        .balance-card {
            text-align: center;
            padding: 20px;
            background: linear-gradient(180deg, var(--surface) 0%, transparent 100%);
            border-radius: 24px;
            margin-bottom: 20px;
        }
        .gold-value { font-size: 52px; font-weight: 900; color: var(--accent); letter-spacing: -2px; }
        .gold-label { font-size: 14px; color: var(--text-dim); text-transform: uppercase; font-weight: 700; }

        /* –°–µ—Ç–∫–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ */
        .stats-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 15px; }
        .stat-item { background: var(--surface); padding: 12px; border-radius: 16px; border: 1px solid #27272a; text-align: center; }
        .stat-item span { display: block; font-size: 10px; color: var(--text-dim); text-transform: uppercase; margin-bottom: 4px; }
        .stat-item b { font-size: 16px; color: #fff; }

        /* –ö–ª–∏–∫–µ—Ä */
        .main-click-area {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .coin-wrapper { position: relative; z-index: 10; }
        .coin-main {
            width: 220px; height: 220px; border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #ffc800 0%, #ff8000 100%);
            border: 8px solid #1a1a1e;
            box-shadow: 0 0 60px var(--accent-glow), inset 0 0 20px rgba(0,0,0,0.5);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: transform 0.05s cubic-bezier(0.1, 0.5, 0.5, 1);
            user-select: none;
        }
        .coin-main:active { transform: scale(0.94); }
        .coin-main span { font-size: 90px; font-weight: 900; color: rgba(255,255,255,0.2); pointer-events: none; }

        /* –¢–∞–π–º–µ—Ä –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ */
        .lock-overlay {
            position: absolute;
            background: rgba(0,0,0,0.85);
            inset: -10px;
            border-radius: 50%;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 20;
            backdrop-filter: blur(4px);
            border: 2px solid var(--error);
        }
        .lock-overlay.active { display: flex; }
        .lock-timer { font-size: 40px; font-weight: 900; color: var(--error); }
        .lock-text { font-size: 10px; color: var(--text-dim); text-transform: uppercase; margin-top: 5px; }

        /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
        .bottom-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: auto; }
        .btn-act { 
            background: var(--surface); border: 1px solid #27272a; border-radius: 18px; 
            padding: 16px; text-align: center; position: relative; overflow: hidden;
        }
        .btn-act b { display: block; font-size: 13px; margin-bottom: 2px; }
        .btn-act span { font-size: 9px; color: var(--accent); font-weight: 800; }
        .btn-full { grid-column: span 2; border-color: var(--accent); background: rgba(255,157,0,0.05); }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .tab-bar {
            position: fixed; bottom: 0; width: 100%; height: calc(70px + var(--safe-bottom));
            background: #080808; border-top: 1px solid #1c1c1e; display: flex; 
            padding-bottom: var(--safe-bottom); z-index: 1000;
        }
        .tab-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--text-dim); }
        .tab-item.active { color: var(--accent); }
        .tab-item i { font-size: 22px; margin-bottom: 4px; font-style: normal; }
        .tab-item span { font-size: 10px; font-weight: 700; }

        /* –°–ø–∏—Å–∫–∏ (–¢–æ–ø, –ò—Å—Ç–æ—Ä–∏—è) */
        .scroll-list { flex: 1; overflow-y: auto; padding-bottom: 20px; }
        .list-card {
            background: var(--surface); padding: 16px; border-radius: 16px; margin-bottom: 10px;
            display: flex; justify-content: space-between; align-items: center;
            border: 1px solid #27272a;
        }
        .list-card.top-me { border-color: var(--accent); background: rgba(255,157,0,0.05); }
        
        /* –ú–æ–¥–∞–ª–∫–∏ */
        #modal-overlay { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 5000; 
            display: none; align-items: center; justify-content: center; padding: 30px; 
        }
        .modal-content { background: #1c1c1e; border-radius: 28px; padding: 30px; width: 100%; text-align: center; border: 1px solid #2c2c2e; }

        .float-val { position: absolute; color: var(--accent); font-weight: 900; animation: floatUp 0.8s forwards; pointer-events: none; }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-120px); } }
    </style>
</head>
<body>

    <div id="modal-overlay">
        <div class="modal-content">
            <div style="font-size: 50px; margin-bottom: 15px;">üö´</div>
            <h2 style="color: var(--error); margin-bottom: 10px;">–ë–æ—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω!</h2>
            <p style="color: var(--text-dim); font-size: 14px; line-height: 1.5; margin-bottom: 20px;">
                –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–æ–≤ –∑–∞–ø—Ä–µ—â–µ–Ω–æ –ø—Ä–∞–≤–∏–ª–∞–º–∏ Locus Gold.<br><br>
                –ß—Ç–æ–±—ã —Ñ–∞—Ä–º–∏—Ç—å –±—ã—Å—Ç—Ä–µ–µ —á–µ—Å—Ç–Ω–æ: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ <b>–ú–∞–≥–∞–∑–∏–Ω</b> –∏–ª–∏ <b>–†–µ–∫–ª–∞–º–Ω—ã–µ –±–æ–Ω—É—Å—ã</b>.
            </p>
            <button class="btn-act btn-full" style="background: var(--accent); color: #000;" onclick="AntiCheat.close()">–ü–û–ù–Ø–¢–ù–û</button>
        </div>
    </div>

    <div class="app-container active" id="screen-mining">
        <div class="balance-card">
            <div class="gold-label">–í–∞—à –±–∞–ª–∞–Ω—Å</div>
            <div class="gold-value" id="val-gold">0.000</div>
            <div class="stats-row">
                <div class="stat-item"><span>–°–∏–ª–∞ –∫–ª–∏–∫–∞</span><b id="val-pwr">0.001</b></div>
                <div class="stat-item"><span>–†–∞–Ω–≥</span><b id="val-rank">BRONZE</b></div>
            </div>
        </div>

        <div class="main-click-area">
            <div class="coin-wrapper">
                <div class="lock-overlay" id="click-lock">
                    <div class="lock-timer" id="lock-count">5</div>
                    <div class="lock-text">–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞</div>
                </div>
                <div class="coin-main" id="target-coin"><span>G</span></div>
            </div>
        </div>

        <div class="bottom-actions">
            <div class="btn-act" onclick="Game.watchAd('gold')"><i>üéÅ</i><b>–ë–æ–Ω—É—Å +5.0 G</b><span>–†–ï–ö–õ–ê–ú–ê</span></div>
            <div class="btn-act" onclick="Game.watchAd('pwr')"><i>‚ö°</i><b>–°–∏–ª–∞ +0.005</b><span>–†–ï–ö–õ–ê–ú–ê</span></div>
            <div class="btn-act btn-full" onclick="Game.upgrade()">üöÄ <b>–£–ª—É—á—à–∏—Ç—å –∑–∞ 1.000 G</b><span>–ú–ê–ì–ê–ó–ò–ù</span></div>
        </div>
    </div>

    <div class="app-container" id="screen-top">
        <h2 style="text-align: center; margin-bottom: 5px;">–¢–æ–ø-50 –ò–≥—Ä–æ–∫–æ–≤</h2>
        <p style="text-align: center; font-size: 11px; color: var(--text-dim); margin-bottom: 20px;">–°–µ—Ä–≤–µ—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç</p>
        <div class="scroll-list" id="list-top"></div>
    </div>

    <div class="app-container" id="screen-wallet">
        <h2 style="text-align: center; margin-bottom: 20px;">–í—ã–≤–æ–¥ Gold</h2>
        <div class="stat-item" style="margin-bottom: 20px; padding: 20px;">
            <p style="color: var(--text-dim); font-size: 13px; margin-bottom: 10px;">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞: <b>750.000 G</b></p>
            <button id="btn-withdraw" class="btn-act btn-full" style="opacity: 0.5;" disabled>–û–§–û–†–ú–ò–¢–¨ –í–´–í–û–î</button>
        </div>
        <h3 style="font-size: 12px; color: var(--accent); text-transform: uppercase; margin-bottom: 10px;">–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</h3>
        <div class="scroll-list" id="list-history"></div>
    </div>

    <nav class="tab-bar">
        <div class="tab-item active" onclick="UI.switchTab('mining', this)"><i>‚õèÔ∏è</i><span>–î–æ–±—ã—á–∞</span></div>
        <div class="tab-item" onclick="UI.switchTab('top', this)"><i>üèÜ</i><span>–¢–æ–ø-50</span></div>
        <div class="tab-item" onclick="UI.switchTab('wallet', this)"><i>üè¶</i><span>–ö–æ—à–µ–ª–µ–∫</span></div>
    </nav>

    <script>
    /** * –ú–û–î–£–õ–¨ –ê–ù–¢–ò–ß–ò–¢–ê (AntiCheat Core)
     */
    const AntiCheat = {
        history: [],
        isLocked: false,
        lockTime: 5,
        
        check(interval) {
            if (this.isLocked) return false;

            this.history.push(interval);
            if (this.history.length > 15) this.history.shift();

            if (this.history.length === 15) {
                // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ CPS (–±–æ–ª–µ–µ 18 –∫–ª–∏–∫–æ–≤/—Å–µ–∫)
                const avg = this.history.reduce((a, b) => a + b) / 15;
                if (avg < 55) return this.trigger();

                // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ "—Ä–æ–±–æ—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é" —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å (Entropy Check)
                const variance = Math.max(...this.history) - Math.min(...this.history);
                if (variance < 4) return this.trigger(); 
            }
            return true;
        },

        trigger() {
            this.isLocked = true;
            document.getElementById('modal-overlay').style.display = 'flex';
            document.getElementById('click-lock').classList.add('active');
            
            let timeLeft = this.lockTime;
            const timerDisplay = document.getElementById('lock-count');
            
            const countdown = setInterval(() => {
                timeLeft--;
                timerDisplay.innerText = timeLeft;
                if (timeLeft <= 0) {
                    clearInterval(countdown);
                    this.unlock();
                }
            }, 1000);
            
            return false;
        },

        unlock() {
            this.isLocked = false;
            this.history = [];
            document.getElementById('click-lock').classList.remove('active');
            document.getElementById('lock-count').innerText = "5";
        },

        close() {
            document.getElementById('modal-overlay').style.display = 'none';
        }
    };

    /**
     * –Ø–î–†–û –ò–ì–†–´ (Game Core)
     */
    const Game = {
        db: null,
        user: { id: null, gold: 0, pwr: 0.001, name: "–ò–≥—Ä–æ–∫" },
        lastTap: 0,
        unsynced: 0,

        async init() {
            Telegram.WebApp.expand();
            this.user.id = Telegram.WebApp.initDataUnsafe?.user?.id?.toString() || "LOCAL_DEBUG";
            this.user.name = Telegram.WebApp.initDataUnsafe?.user?.first_name || "–ò–≥—Ä–æ–∫";

            firebase.initializeApp({
                apiKey: "AIzaSyCoa29KS-sin6hoRz0ZbE4f3ki0tZLwkKI",
                projectId: "gold-clicker-5d882",
                appId: "1:83489312782:web:ee5b7bdc390e53e7dd6c5f"
            });
            this.db = firebase.firestore();

            const doc = await this.db.collection('players').doc(this.user.id).get();
            if (doc.exists) {
                const data = doc.data();
                this.user.gold = data.gold || 0;
                this.user.pwr = data.pwr || 0.001;
            } else {
                await this.db.collection('players').doc(this.user.id).set({
                    name: this.user.name, gold: 0, pwr: 0.001, created: new Date()
                });
            }

            this.render();
            document.getElementById('target-coin').addEventListener('pointerdown', (e) => this.handleTap(e));
            setInterval(() => this.sync(), 8000);
        },

        handleTap(e) {
            const now = Date.now();
            if (this.lastTap > 0) {
                const interval = now - this.lastTap;
                if (!AntiCheat.check(interval)) return;
            }
            this.lastTap = now;

            this.user.gold += this.user.pwr;
            this.unsynced += this.user.pwr;
            
            this.render();
            UI.animateTap(e);
            if (Telegram.WebApp.HapticFeedback) Telegram.WebApp.HapticFeedback.impactOccurred('light');
        },

        render() {
            document.getElementById('val-gold').innerText = this.user.gold.toFixed(3);
            document.getElementById('val-pwr').innerText = this.user.pwr.toFixed(3);
            
            // –†–∞—Å—á–µ—Ç —Ä–∞–Ω–≥–∞
            let r = "BRONZE";
            if(this.user.gold > 100) r = "SILVER";
            if(this.user.gold > 500) r = "GOLD";
            if(this.user.gold > 1000) r = "ELITE";
            document.getElementById('val-rank').innerText = r;

            // –ö–Ω–æ–ø–∫–∞ –≤—ã–≤–æ–¥–∞
            const wBtn = document.getElementById('btn-withdraw');
            if (this.user.gold >= 750) {
                wBtn.disabled = false;
                wBtn.style.opacity = "1";
                wBtn.onclick = () => this.withdraw();
            }
        },

        async sync() {
            if (this.unsynced <= 0) return;
            const delta = this.unsynced;
            this.unsynced = 0;
            await this.db.collection('players').doc(this.user.id).update({
                gold: firebase.firestore.FieldValue.increment(delta),
                pwr: this.user.pwr,
                lastSeen: new Date()
            });
        },

        async upgrade() {
            if (this.user.gold < 1) return Telegram.WebApp.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤! –ú–∏–Ω–∏–º—É–º 1.000 G.");
            this.user.gold -= 1;
            this.user.pwr += 0.005;
            this.render();
            await this.db.collection('players').doc(this.user.id).update({
                gold: firebase.firestore.FieldValue.increment(-1),
                pwr: firebase.firestore.FieldValue.increment(0.005)
            });
        },

        watchAd(type) {
            const ad = Adsgram.init({ blockId: "19895" });
            ad.show().then(() => {
                if (type === 'gold') this.user.gold += 5;
                else this.user.pwr += 0.005;
                this.sync();
                this.render();
            }).catch(() => Telegram.WebApp.showAlert("–†–µ–∫–ª–∞–º–∞ –µ—â–µ –Ω–µ –≥–æ—Ç–æ–≤–∞..."));
        },

        async withdraw() {
            const sid = prompt("–í–≤–µ–¥–∏—Ç–µ ID Standoff 2:");
            if (!sid || sid.length < 7) return Telegram.WebApp.showAlert("–ù–µ–≤–µ—Ä–Ω—ã–π ID!");
            
            const amount = Math.floor(this.user.gold);
            await this.db.collection('withdrawals').add({
                uid: this.user.id,
                sid: sid,
                amount: amount,
                status: "–û–∂–∏–¥–∞–Ω–∏–µ",
                date: new Date()
            });

            this.user.gold = 0;
            await this.db.collection('players').doc(this.user.id).update({ gold: 0 });
            this.render();
            Telegram.WebApp.showAlert(`–ó–∞—è–≤–∫–∞ –Ω–∞ ${amount} G —Å–æ–∑–¥–∞–Ω–∞!`);
        }
    };

    /**
     * –ò–ù–¢–ï–†–§–ï–ô–° (UI Controller)
     */
    const UI = {
        switchTab(screen, el) {
            document.querySelectorAll('.app-container').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
            
            document.getElementById('
