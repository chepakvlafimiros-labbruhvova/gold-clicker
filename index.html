<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Locus Gold Elite</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>

    <style>
        :root {
            --bg: #0a0a0b;
            --surface: #151517;
            --accent: #ff9d00;
            --accent-glow: rgba(255, 157, 0, 0.4);
            --text-main: #ffffff;
            --text-dim: #8e8e93;
            --success: #32d74b;
            --error: #ff453a;
            --nav-height: 80px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        
        body { 
            background-color: var(--bg); 
            color: var(--text-main); 
            height: 100vh; 
            overflow: hidden; 
            display: flex; 
            flex-direction: column;
            user-select: none;
            -webkit-user-select: none;
        }

        /* --- –Æ–†–ò–î–ò–ß–ï–°–ö–ò–ô –ú–û–î–£–õ–¨ --- */
        #entry-guard { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 10000; 
            display: none; align-items: center; justify-content: center; backdrop-filter: blur(10px);
        }
        .guard-box { 
            background: #1c1c1e; width: 85%; padding: 30px 20px; border-radius: 28px; 
            text-align: center; border: 1px solid #2c2c2e; box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }
        .tos-trigger-btn {
            background: linear-gradient(135deg, #e6b13a, #b3882d); color: #000; 
            padding: 18px; border-radius: 16px; font-weight: 700; margin-bottom: 15px; width: 100%; border: none;
        }
        .agree-btn {
            background: #fff; color: #000; padding: 14px; border-radius: 14px; font-weight: 800; width: 100%; border: none;
        }

        #full-tos-view {
            position: fixed; inset: 0; background: #000; z-index: 10001; 
            display: none; flex-direction: column; padding: 40px 25px; overflow-y: auto;
        }
        .tos-text-block { flex: 1; font-size: 13px; line-height: 1.6; color: #b1b1b7; margin-bottom: 30px; }
        .tos-text-block h2 { color: var(--accent); margin: 20px 0 10px; font-size: 16px; text-transform: uppercase; }

        /* --- –í–ï–†–•–ù–Ø–Ø –ü–ê–ù–ï–õ–¨ --- */
        .header { padding: 40px 20px 10px; text-align: center; flex-shrink: 0; }
        .balance-display { font-size: 52px; font-weight: 900; letter-spacing: -1.5px; display: inline-block; position: relative; }
        .balance-display span { color: var(--accent); font-size: 22px; margin-left: 6px; }
        
        .stat-grid { display: flex; gap: 12px; padding: 0 20px; margin-bottom: 20px; flex-shrink: 0; }
        .stat-item { 
            flex: 1; background: var(--surface); padding: 14px; border-radius: 18px; 
            text-align: center; border: 1px solid #222;
        }
        .stat-item label { display: block; font-size: 10px; color: var(--text-dim); text-transform: uppercase; font-weight: 800; margin-bottom: 4px; }
        .stat-item b { font-size: 16px; letter-spacing: 0.5px; }

        /* --- –ö–û–ù–¢–ï–ù–¢–ù–ê–Ø –ó–û–ù–ê --- */
        .main-container { flex: 1; position: relative; overflow: hidden; }
        .tab-content { position: absolute; inset: 0; display: none; flex-direction: column; padding: 0 20px; overflow-y: auto; padding-bottom: 40px; }
        .tab-content.active { display: flex; }

        /* –ö–õ–ò–ö–ï–† */
        .clicker-wrapper { flex: 1; display: flex; align-items: center; justify-content: center; padding: 20px 0; }
        .gold-coin { 
            width: 240px; height: 240px; border-radius: 50%; 
            background: radial-gradient(circle, #ffb700 0%, #ff8000 100%); 
            border: 10px solid #1a1a1c; box-shadow: 0 0 60px var(--accent-glow);
            display: flex; align-items: center; justify-content: center;
            font-size: 90px; color: rgba(0,0,0,0.25); font-weight: 900;
            transition: transform 0.05s ease-out; cursor: pointer;
        }
        .gold-coin:active { transform: scale(0.92); }

        .action-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; flex-shrink: 0; }
        .card-btn { 
            background: var(--surface); border: 1px solid #252527; padding: 18px 12px; border-radius: 22px;
            text-align: center; display: flex; flex-direction: column; align-items: center; gap: 4px;
        }
        .card-btn:active { background: #1e1e20; }
        .card-btn img { width: 24px; margin-bottom: 4px; }
        .card-btn b { font-size: 14px; }
        .card-btn span { font-size: 10px; color: var(--accent); font-weight: 800; }

        /* –°–ü–ò–°–ö–ò */
        .list-header { font-size: 12px; color: var(--text-dim); font-weight: 800; text-transform: uppercase; margin: 20px 0 12px; }
        .operation-card { 
            background: var(--surface); padding: 18px; border-radius: 20px; margin-bottom: 12px;
            display: flex; justify-content: space-between; align-items: center; border-left: 5px solid #333;
        }
        .operation-card.success { border-left-color: var(--success); }
        .status-pill { padding: 6px 14px; border-radius: 12px; font-size: 10px; font-weight: 900; text-transform: uppercase; }
        .status-pill.wait { background: rgba(255,157,0,0.1); color: var(--accent); }
        .status-pill.done { background: rgba(50,215,75,0.1); color: var(--success); }

        /* –í–´–í–û–î */
        .withdraw-banner { background: var(--surface); padding: 30px 20px; border-radius: 24px; text-align: center; margin-bottom: 10px; border: 1px solid #252527; }
        .main-action-btn { 
            width: 100%; padding: 20px; border-radius: 18px; border: none; font-weight: 900; 
            font-size: 16px; text-transform: uppercase; letter-spacing: 1px; transition: 0.3s;
        }
        .main-action-btn.ready { background: var(--accent); color: #000; box-shadow: 0 10px 25px var(--accent-glow); }
        .main-action-btn.locked { background: #222; color: #444; }

        /* --- –ù–ò–ñ–ù–Ø–Ø –ù–ê–í–ò–ì–ê–¶–ò–Ø --- */
        .bottom-nav { 
            height: var(--nav-height); background: #000; border-top: 1px solid #1c1c1e; 
            display: flex; padding-bottom: 20px; flex-shrink: 0;
        }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--text-dim); }
        .nav-item.active { color: var(--accent); }
        .nav-item i { font-size: 24px; margin-bottom: 4px; }
        .nav-item span { font-size: 10px; font-weight: 800; text-transform: uppercase; }

        .tap-vfx { position: absolute; color: var(--accent); font-weight: 900; pointer-events: none; animation: tapFly 0.7s ease-out forwards; z-index: 1000; }
        @keyframes tapFly { 0% { opacity: 1; transform: translateY(0) scale(1); } 100% { opacity: 0; transform: translateY(-120px) scale(1.5); } }
    </style>
</head>
<body>

    <div id="entry-guard">
        <div class="guard-box">
            <button class="tos-trigger-btn" onclick="UI.showFullTos()">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ</button>
            <button class="agree-btn" onclick="Core.acceptTerms()">–°–û–ì–õ–ê–°–ï–ù</button>
        </div>
    </div>

    <div id="full-tos-view">
        <div class="tos-text-block">
            <h1 style="color: #fff; text-align: center; margin-bottom: 20px;">Locus Gold: User Agreement</h1>
            <p style="text-align: center; color: var(--accent); margin-bottom: 25px;">–í–µ—Ä—Å–∏—è: 2.1 (Elite). –ü—Ä–∞–≤–∏–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.</p>
            
            <h2>1. –û–ì–†–ê–ù–ò–ß–ï–ù–ò–ï –û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–ò</h2>
            <p>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —è–≤–ª—è–µ—Ç—Å—è –∏–≥—Ä–æ–≤—ã–º —Å–∏–º—É–ª—è—Ç–æ—Ä–æ–º. –í—Å—è –≤–Ω—É—Ç—Ä–∏–∏–≥—Ä–æ–≤–∞—è –≤–∞–ª—é—Ç–∞ (Gold) —è–≤–ª—è–µ—Ç—Å—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –∏ –Ω–µ –∏–º–µ–µ—Ç –¥–µ–Ω–µ–∂–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏. –ú—ã –Ω–µ —Å–≤—è–∑–∞–Ω—ã —Å –∫–æ–º–ø–∞–Ω–∏–µ–π Axlebolt Ltd. –∏–ª–∏ –∏–≥—Ä–æ–π Standoff 2.</p>
            
            <h2>2. –ü–†–ê–í–ò–õ–ê –í–´–í–û–î–ê (750 G)</h2>
            <p>–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ ‚Äî 750 G. –í—ã–≤–æ–¥ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 72 —á–∞—Å–æ–≤. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –≤–ø—Ä–∞–≤–µ –∞–Ω–Ω—É–ª–∏—Ä–æ–≤–∞—Ç—å –±–∞–ª–∞–Ω—Å –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–ª–∏–∫–µ—Ä–æ–≤, —ç–º—É–ª—è—Ç–æ—Ä–æ–≤ –∏–ª–∏ –º—É–ª—å—Ç–∏–∞–∫–∫–∞—É–Ω—Ç–æ–≤.</p>
            
            <h2>3. –†–ï–§–ï–†–ê–õ–¨–ù–ê–Ø –ü–†–û–ì–†–ê–ú–ú–ê</h2>
            <p>–ó–∞ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω–æ–≥–æ –¥—Ä—É–≥–∞ –Ω–∞—á–∏—Å–ª—è–µ—Ç—Å—è 100 G. –ê–∫—Ç–∏–≤–Ω—ã–º —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–≤—à–∏–π –º–∏–Ω–∏–º—É–º 1 —Ä–æ–ª–∏–∫ –∏ —Å–æ–≤–µ—Ä—à–∏–≤—à–∏–π 100 –∫–ª–∏–∫–æ–≤.</p>
            
            <h2>4. –†–ï–ö–õ–ê–ú–ê –ò –î–ê–ù–ù–´–ï</h2>
            <p>–°–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—É Adsgram –¥–ª—è –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏–∏. –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—è –≤–∏–¥–µ–æ, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∞–Ω–æ–Ω–∏–º–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥–∞.</p>
        </div>
        <button class="agree-btn" style="background: var(--accent);" onclick="UI.hideFullTos()">–í–ï–†–ù–£–¢–¨–°–Ø</button>
    </div>

    <header class="header">
        <div class="balance-display"><span id="ui-gold">0.000</span><span>G</span></div>
    </header>

    <div class="stat-grid">
        <div class="stat-item"><label>–°–∏–ª–∞ –∫–ª–∏–∫–∞</label><b id="ui-pwr">0.001</b></div>
        <div class="stat-item"><label>–í—Å–µ–≥–æ –¥—Ä—É–∑–µ–π (+100G)</label><b id="ui-refs">0</b></div>
    </div>

    <main class="main-container">
        <div id="view-mining" class="tab-content active">
            <div class="clicker-wrapper">
                <div id="coin-actor" class="gold-coin">G</div>
            </div>
            <div class="action-buttons">
                <div class="card-btn" onclick="Core.watchAd('gold')">üéÅ <b>–ë–û–ù–£–° +5.0 G</b> <span>–†–ï–ö–õ–ê–ú–ê</span></div>
                <div class="card-btn" onclick="Core.watchAd('pwr')">‚ö° <b>–°–ò–õ–ê +0.005</b> <span>–†–ï–ö–õ–ê–ú–ê</span></div>
                <div class="card-btn" onclick="Core.upgrade()" style="grid-column: span 2; border-color: var(--accent);">
                    üöÄ <b>–£–õ–£–ß–®–ò–¢–¨ –ö–õ–ò–ö –ó–ê 1.000 G</b> <span>Upgrade: +0.005</span>
                </div>
            </div>
        </div>

        <div id="view-friends" class="tab-content">
            <div class="withdraw-banner">
                <h3 style="margin-bottom: 10px;">–í–∞—à–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ã</h3>
                <p style="color: var(--text-dim); font-size: 13px; margin-bottom: 20px;">–ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π—Ç–µ 100 G —Å—Ä–∞–∑—É!</p>
                <button class="main-action-btn ready" onclick="Core.copyRef()">–ü–†–ò–ì–õ–ê–°–ò–¢–¨ –î–†–£–ì–ê (100 G)</button>
            </div>
            <p class="list-header">–°–ø–∏—Å–æ–∫ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö</p>
            <div id="ref-list-root"></div>
        </div>

        <div id="view-wallet" class="tab-content">
            <div class="withdraw-banner">
                <p style="color: var(--text-dim); font-size: 12px; margin-bottom: 15px;">–ù–∞–∫–æ–ø–∏—Ç–µ 750 G –¥–ª—è –≤—ã–≤–æ–¥–∞</p>
                <button id="withdraw-btn" class="main-action-btn locked" disabled>–û–§–û–†–ú–ò–¢–¨ –í–´–í–û–î</button>
            </div>
            <p class="list-header">–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</p>
            <div id="wallet-list-root"></div>
        </div>
    </main>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="UI.nav('mining', this)"><i>‚õèÔ∏è</i><span>–ú–∞–π–Ω–∏–Ω–≥</span></div>
        <div class="nav-item" onclick="UI.nav('friends', this)"><i>üë•</i><span>–î—Ä—É–∑—å—è</span></div>
        <div class="nav-item" onclick="UI.nav('wallet', this)"><i>üè¶</i><span>–í—ã–≤–æ–¥</span></div>
    </nav>

    <script>
    const Core = {
        db: null, tg: window.Telegram.WebApp, uid: null,
        gold: 0, pwr: 0.001, journal: 0,

        async init() {
            this.tg.expand();
            this.uid = this.tg.initDataUnsafe?.user?.id?.toString() || "DEV_MODE";
            
            firebase.initializeApp({
                apiKey: "AIzaSyCoa29KS-sin6hoRz0ZbE4f3ki0tZLwkKI",
                authDomain: "gold-clicker-5d882.firebaseapp.com",
                projectId: "gold-clicker-5d882",
                appId: "1:83489312782:web:ee5b7bdc390e53e7dd6c5f"
            });
            this.db = firebase.firestore();

            const doc = await this.db.collection('players').doc(this.uid).get();
            if(!doc.exists || !doc.data().acceptedTos) {
                document.getElementById('entry-guard').style.display = 'flex';
            } else {
                this.gold = doc.data().gold || 0;
                this.pwr = doc.data().pwr || 0.001;
            }

            this.render();
            setInterval(() => this.sync(), 3000);
            document.getElementById('coin-actor').onclick = (e) => this.tap(e);
        },

        async acceptTerms() {
            document.getElementById('entry-guard').style.display = 'none';
            await this.db.collection('players').doc(this.uid).set({
                gold: 0, pwr: 0.001, acceptedTos: true,
                name: this.tg.initDataUnsafe?.user?.first_name || "–ò–≥—Ä–æ–∫"
            }, {merge: true});
            this.handleRefLink();
        },

        async handleRefLink() {
            const refId = this.tg.initDataUnsafe?.start_param;
            if(refId && refId !== this.uid) {
                await this.db.collection('players').doc(refId).update({ gold: firebase.firestore.FieldValue.increment(100) });
                await this.db.collection('players').doc(refId).collection('referrals').add({ name: "–ù–æ–≤—ã–π –¥—Ä—É–≥", date: new Date().toLocaleDateString() });
            }
        },

        tap(e) {
            this.gold += this.pwr; this.journal += this.pwr;
            this.render(); UI.spawnTapEffect(e.clientX, e.clientY, this.pwr);
            if(this.tg.HapticFeedback) this.tg.HapticFeedback.impactOccurred('light');
        },

        async sync() {
            if(this.journal <= 0) return;
            const temp = this.journal;
            await this.db.collection('players').doc(this.uid).update({ gold: firebase.firestore.FieldValue.increment(temp), pwr: this.pwr });
            this.journal -= temp;
        },

        async upgrade() {
            if(this.gold < 1) return this.tg.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ Gold!");
            this.gold -= 1; this.pwr += 0.005;
            await this.db.collection('players').doc(this.uid).update({ gold: firebase.firestore.FieldValue.increment(-1), pwr: firebase.firestore.FieldValue.increment(0.005) });
            this.render();
        },

        watchAd(mode) {
            this.tg.showConfirm("–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–æ–ª–∏–∫?", (ok) => {
                if(ok) {
                    const ad = window.Adsgram.init({ blockId: "8213" });
                    ad.show().then(() => {
                        if(mode === 'gold') this.gold += 5; else this.pwr += 0.005;
                        this.sync(); this.render();
                    }).catch(() => this.tg.showAlert("–†–µ–∫–ª–∞–º–∞ –∑–∞–Ω—è—Ç–∞"));
                }
            });
        },

        render() {
            document.getElementById('ui-gold').innerText = this.gold.toFixed(3);
            document.getElementById('ui-pwr').innerText = this.pwr.toFixed(3);
            
            const b = document.getElementById('withdraw-btn');
            if(this.gold >= 750) {
                b.className = "main-action-btn ready"; b.disabled = false;
                b.onclick = () => this.withdrawRequest();
            } else {
                b.className = "main-action-btn locked"; b.disabled = true;
            }
        },

        async withdrawRequest() {
            const id = prompt("–í–≤–µ–¥–∏—Ç–µ –≤–∞—à ID Standoff 2 (8-9 —Ü–∏—Ñ—Ä):");
            if(!id || id.length < 8) return this.tg.showAlert("–û—à–∏–±–∫–∞ –≤ ID");
            
            const data = { sid: id, amount: Math.floor(this.gold), status: '–û–∂–∏–¥–∞–Ω–∏–µ', date: new Date().toLocaleDateString() };
            await this.db.collection('withdrawals').add({...data, uid: this.uid});
            await this.db.collection('players').doc(this.uid).collection('history').add(data);
            
            this.gold = 0; await this.db.collection('players').doc(this.uid).update({ gold: 0 });
            this.render(); this.loadHistory();
            this.tg.showAlert("–ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!");
        },

        async loadHistory() {
            const root = document.getElementById('wallet-list-root');
            const snap = await this.db.collection('players').doc(this.uid).collection('history').get();
            root.innerHTML = snap.empty ? '<center style="color:#444;margin-top:20px">–ü—É—Å—Ç–æ</center>' : '';
            snap.forEach(d => {
                const item = d.data(); const isWait = item.status === '–û–∂–∏–¥–∞–Ω–∏–µ';
                root.innerHTML += `
                <div class="operation-card ${!isWait ? 'success' : ''}">
                    <div><b>${item.amount} G</b><br><small style="color:var(--text-dim)">ID: ${item.sid}</small></div>
                    <span class="status-pill ${isWait ? 'wait' : 'done'}">${item.status}</span>
                </div>`;
            });
        },

        async loadRefs() {
            const root = document.getElementById('ref-list-root');
            const snap = await this.db.collection('players').doc(this.uid).collection('referrals').get();
            root.innerHTML = snap.empty ? '<center style="color:#444;margin-top:20px">–ù–µ—Ç –¥—Ä—É–∑–µ–π</center>' : '';
            document.getElementById('ui-refs').innerText = snap.size;
            snap.forEach(d => {
                root.innerHTML += `<div class="operation-card success"><b>${d.data().name}</b><span class="status-pill done">+100 G</span></div>`;
            });
        },

        copyRef() {
            const link = `https://t.me/Locus_Gold_bot/Locus_Gold?startapp=${this.uid}`;
            navigator.clipboard.writeText(link); this.tg.showAlert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!");
        }
    };

    const UI = {
        nav(id, el) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('view-'+id).classList.add('active'); el.classList.add('active');
            if(id === 'friends') Core.loadRefs();
            if(id === 'wallet') Core.loadHistory();
        },
        showFullTos() { document.getElementById('full-tos-view').style.display = 'flex'; },
        hideFullTos() { document.getElementById('full-tos-view').style.display = 'none'; },
        spawnTapEffect(x, y, val) {
            const d = document.createElement('div'); d.className = 'tap-vfx';
            d.innerText = `+${val.toFixed(3)}`; d.style.left = x+'px'; d.style.top = y+'px';
            document.body.appendChild(d); setTimeout(() => d.remove(), 700);
        }
    };

    window.onload = () => Core.init();
    </script>
</body>
</html>
