<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Nebula Gold Tycoon</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        :root {
            --p-color: #00d4ff;
            --gold: #ffcc00;
            --bg: #0a0b10;
            --card: rgba(255, 255, 255, 0.03);
            --brd: rgba(255, 255, 255, 0.08);
            --safe: env(safe-area-inset-bottom);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Roboto, sans-serif; -webkit-tap-highlight-color: transparent; user-select: none; touch-action: none; }
        body { background: var(--bg); color: #fff; height: 100vh; overflow: hidden; position: fixed; width: 100%; }

        /* –°–ª–æ–π –¥–ª—è —á–∞—Å—Ç–∏—Ü */
        #fx-layer { position: absolute; inset: 0; z-index: 5; pointer-events: none; }

        .app { position: relative; z-index: 10; display: flex; flex-direction: column; height: 100%; padding: 20px 20px calc(85px + var(--safe)); }

        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±–∞–ª–∞–Ω—Å–∞ */
        .top-bar { text-align: center; margin-bottom: 15px; }
        .bal-main { font-size: 48px; font-weight: 900; letter-spacing: -1px; display: block; filter: drop-shadow(0 0 15px rgba(0,212,255,0.3)); }
        .gold-status { color: var(--gold); font-weight: 700; font-size: 18px; margin-top: 4px; display: flex; align-items: center; justify-content: center; gap: 6px; }

        /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ —É—Ä–æ–≤–Ω—è */
        .lvl-box { background: var(--card); border: 1px solid var(--brd); padding: 14px; border-radius: 20px; margin-top: 10px; backdrop-filter: blur(10px); }
        .lvl-info { display: flex; justify-content: space-between; font-size: 11px; font-weight: 800; color: var(--p-color); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }
        .bar-bg { width: 100%; height: 8px; background: rgba(0,0,0,0.4); border-radius: 10px; overflow: hidden; position: relative; }
        .bar-fill { position: absolute; top: 0; left: 0; height: 100%; width: 100%; background: linear-gradient(90deg, #0055ff, var(--p-color)); transform-origin: left; transform: scaleX(0); will-change: transform; }

        /* –¶–µ–Ω—Ç—Ä - –ö—Ä–∏—Å—Ç–∞–ª–ª */
        .main-zone { flex: 1; display: flex; align-items: center; justify-content: center; position: relative; }
        .crystal { 
            width: 220px; height: 220px; 
            background: radial-gradient(circle at 30% 30%, var(--p-color), #0044aa);
            clip-path: polygon(50% 0%, 95% 25%, 95% 75%, 50% 100%, 5% 75%, 5% 25%);
            display: flex; align-items: center; justify-content: center;
            transition: transform 0.05s cubic-bezier(0, 0, 0.2, 1);
            box-shadow: 0 0 40px rgba(0, 85, 255, 0.4);
        }
        .crystal span { font-size: 80px; filter: drop-shadow(0 10px 10px rgba(0,0,0,0.3)); }

        /* –ö–Ω–æ–ø–∫–∏ –∏ —Å—Ç–∞—Ç—ã */
        .stats { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 20px; }
        .stat-item { background: var(--card); border: 1px solid var(--brd); padding: 12px; border-radius: 16px; text-align: center; }
        .stat-item small { font-size: 10px; color: rgba(255,255,255,0.4); text-transform: uppercase; display: block; }
        .stat-item b { font-size: 18px; }

        .btn-boost { grid-column: span 2; padding: 18px; border-radius: 20px; border: none; background: linear-gradient(135deg, #ff9d00, #ff5e00); color: #fff; font-weight: 900; text-transform: uppercase; font-size: 13px; margin-top: 5px; box-shadow: 0 5px 15px rgba(255, 94, 0, 0.3); }

        /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
        .nav { position: fixed; bottom: 0; left: 0; right: 0; height: calc(75px + var(--safe)); background: rgba(10,11,16,0.95); display: flex; border-top: 1px solid var(--brd); padding-bottom: var(--safe); z-index: 1000; }
        .nav-btn { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #444; }
        .nav-btn.active { color: var(--p-color); }
        .nav-btn i { font-size: 22px; font-style: normal; margin-bottom: 2px; }

        /* –≠–∫—Ä–∞–Ω—ã */
        .screen { position: fixed; inset: 0; background: var(--bg); z-index: 500; display: none; padding: 30px 20px 110px; overflow-y: auto; }
        .screen.active { display: block; }
        .shop-card { background: var(--card); padding: 18px; border-radius: 20px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--brd); }
    </style>
</head>
<body>

    <canvas id="fx-layer"></canvas>

    <div class="app">
        <div class="top-bar">
            <span class="bal-main" id="ui-bal">0</span>
            <div class="gold-status">üí∞ <span id="ui-gold">0</span> <small style="font-size: 10px; opacity: 0.5">SLOTS</small></div>
            <div class="lvl-box">
                <div class="lvl-info"><span id="ui-lvl-name">–ù–æ–≤–∏—á–æ–∫</span><span id="ui-lvl-num">–£–†. 1</span></div>
                <div class="bar-bg"><div class="bar-fill" id="ui-bar"></div></div>
            </div>
        </div>

        <div class="main-zone">
            <div class="crystal" id="crystal-node"><span>üíé</span></div>
        </div>

        <div class="stats">
            <div class="stat-item"><small>–ö–µ—Ä–Ω</small><b id="ui-pwr">1.0</b></div>
            <div class="stat-item"><small>–ê–≤—Ç–æ</small><b id="ui-dps">0.0</b></div>
            <button class="btn-boost" id="ui-boost" onclick="Game.runAd()">‚ö° –£–°–ö–û–†–ï–ù–ò–ï x3 (AD)</button>
        </div>
    </div>

    <div class="screen" id="scr-shop">
        <h2 style="margin-bottom: 20px">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</h2>
        <div id="shop-list"></div>
    </div>

    <div class="screen" id="scr-market">
        <h2 style="margin-bottom: 20px">–û–±–º–µ–Ω –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤</h2>
        <div class="shop-card" style="flex-direction: column; gap: 15px; text-align: center">
            <p style="opacity: 0.6">–ö—É—Ä—Å: 100,000 –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤ = 1 —Å–ª–∏—Ç–æ–∫</p>
            <div id="m-lock" style="color: #ff3b30; font-weight: 800">–î–û–°–¢–£–ü–ù–û –° 15 –£–†–û–í–ù–Ø</div>
            <button id="m-btn" class="btn-boost" style="display: none; width: 100%" onclick="Game.exchange()">–í–´–ü–õ–ê–í–ò–¢–¨ –ó–û–õ–û–¢–û</button>
        </div>
    </div>

    <nav class="nav">
        <div class="nav-btn active" onclick="UI.go('main', this)"><i>‚õèÔ∏è</i></div>
        <div class="nav-btn" onclick="UI.go('shop', this)"><i>üõí</i></div>
        <div class="nav-btn" onclick="UI.go('market', this)"><i>üí∞</i></div>
    </nav>

    <script>
        // --- –ü–†–ò–Ø–¢–ù–ê–Ø –§–û–ù–û–í–ê–Ø –ú–£–ó–´–ö–ê (Synthesized) ---
        const AudioFX = {
            ctx: null,
            init() {
                if (this.ctx) return;
                this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                this.playAmbient();
            },
            playAmbient() {
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(110, this.ctx.currentTime); // –ì–ª—É–±–æ–∫–∏–π –±–∞—Å
                gain.gain.setValueAtTime(0.02, this.ctx.currentTime);
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                // –ú–æ–¥—É–ª—è—Ü–∏—è –∑–≤—É–∫–∞ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ "–∫–æ—Å–º–æ—Å–∞"
                setInterval(() => {
                    osc.frequency.exponentialRampToValueAtTime(Math.random() * 20 + 100, this.ctx.currentTime + 2);
                }, 2000);
            }
        };

        // --- –î–í–ò–ñ–û–ö –û–¢–†–ò–°–û–í–ö–ò –ß–ê–°–¢–ò–¶ ---
        const FX = {
            canvas: document.getElementById('fx-layer'),
            ctx: null,
            particles: [],
            init() {
                this.ctx = this.canvas.getContext('2d');
                this.resize();
                window.onresize = () => this.resize();
                this.loop();
            },
            resize() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
            },
            spawn(x, y, text) {
                this.particles.push({ x, y, text, life: 1, vy: -2 });
            },
            loop() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                this.ctx.font = "bold 24px sans-serif";
                for (let i = this.particles.length - 1; i >= 0; i--) {
                    let p = this.particles[i];
                    p.y += p.vy;
                    p.life -= 0.02;
                    this.ctx.fillStyle = `rgba(0, 212, 255, ${p.life})`;
                    this.ctx.fillText(p.text, p.x, p.y);
                    if (p.life <= 0) this.particles.splice(i, 1);
                }
                requestAnimationFrame(() => this.loop());
            }
        };

        // --- –õ–û–ì–ò–ö–ê –ò–ì–†–´ ---
        const Game = {
            data: { bal: 0, gold: 0, pwr: 1, dps: 0, xp: 0, lvl: 1, mult: 1, u: [0, 0, 0, 0] },
            shop: [
                { n: "–†—É—á–Ω–∞—è –∫–∏—Ä–∫–∞", p: 100, b: 0.5, t: 'pwr' },
                { n: "–î—Ä–æ–±–∏–ª–∫–∞", p: 500, b: 1.5, t: 'dps' },
                { n: "–õ–∞–∑–µ—Ä–Ω—ã–π –±—É—Ä", p: 2500, b: 5, t: 'pwr' },
                { n: "–®–∞—Ö—Ç–Ω—ã–π –ò–ò", p: 10000, b: 20, t: 'dps' }
            ],

            init() {
                this.load();
                FX.init();
                
                const crystal = document.getElementById('crystal-node');
                crystal.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    AudioFX.init(); // –ú—É–∑—ã–∫–∞ –≤–∫–ª—é—á–∏—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Ç–∞–ø–µ
                    for (let t of e.changedTouches) this.tap(t.clientX, t.clientY);
                });

                // –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (10 —Ä–∞–∑ –≤ —Å–µ–∫)
                setInterval(() => this.tick(), 100);
                // –ü–ª–∞–≤–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —à–∫–∞–ª—ã (60 —Ä–∞–∑ –≤ —Å–µ–∫)
                this.updateLvlBar();
            },

            tap(x, y) {
                const gain = this.data.pwr * this.data.mult;
                this.data.bal += gain;
                this.data.xp += 10;
                FX.spawn(x, y, `+${gain.toFixed(1)}`);
                
                const cry = document.getElementById('crystal-node');
                cry.style.transform = 'scale(0.92)';
                setTimeout(() => cry.style.transform = 'scale(1)', 50);

                if (window.Telegram?.WebApp?.HapticFeedback) {
                    Telegram.WebApp.HapticFeedback.impactOccurred('light');
                }
            },

            tick() {
                if (this.data.dps > 0) this.data.bal += this.data.dps / 10;
                this.checkLvl();
                this.renderUI();
            },

            checkLvl() {
                const req = this.data.lvl * 1000;
                if (this.data.xp >= req) {
                    this.data.xp = 0;
                    this.data.lvl++;
                    this.save();
                }
            },

            // –ü–ª–∞–≤–Ω–∞—è —à–∫–∞–ª–∞ –±–µ–∑ –±–∞–≥–æ–≤
            updateLvlBar() {
                const req = this.data.lvl * 1000;
                const target = this.data.xp / req;
                const bar = document.getElementById('ui-bar');
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º transform –¥–ª—è –º–∞–∫—Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
                bar.style.transform = `scaleX(${target})`;
                requestAnimationFrame(() => this.updateLvlBar());
            },

            renderUI() {
                document.getElementById('ui-bal').innerText = Math.floor(this.data.bal).toLocaleString();
                document.getElementById('ui-gold').innerText = this.data.gold;
                document.getElementById('ui-pwr').innerText = (this.data.pwr * this.data.mult).toFixed(1);
                document.getElementById('ui-dps').innerText = this.data.dps.toFixed(1);
                document.getElementById('ui-lvl-num').innerText = `–£–†. ${this.data.lvl}`;

                if (this.data.lvl >= 15) {
                    document.getElementById('m-lock').style.display = 'none';
                    document.getElementById('m-btn').style.display = 'block';
                }
            },

            exchange() {
                if (this.data.bal >= 100000) {
                    this.data.bal -= 100000;
                    this.data.gold += 1;
                    this.save();
                }
            },

            save() { localStorage.setItem('nebula_gold_v2', JSON.stringify(this.data)); },
            load() { 
                const s = localStorage.getItem('nebula_gold_v2'); 
                if (s) this.data = {...this.data, ...JSON.parse(s)}; 
            },
            
            runAd() {
                // –ò–º–∏—Ç–∞—Ü–∏—è –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞, –∑–¥–µ—Å—å –±—É–¥–µ—Ç —Ç–≤–æ–π Adsgram
                this.data.mult = 3;
                setTimeout(() => { this.data.mult = 1; }, 30000);
            }
        };

        const UI = {
            go(id, el) {
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                el.classList.add('active');
                if (id !== 'main') {
                    document.getElementById('scr-' + id).classList.add('active');
                    if (id === 'shop') this.drawShop();
                }
            },
            drawShop() {
                document.getElementById('shop-list').innerHTML = Game.shop.map((itm, i) => {
                    const cost = Math.floor(itm.p * Math.pow(1.6, Game.data.u[i]));
                    return `<div class="shop-card" onclick="Game.buy(${i})">
                        <div><b>${itm.n}</b><br><small>+${itm.b} –∫ –¥–æ–±—ã—á–µ</small></div>
                        <div style="font-weight: 900">${cost.toLocaleString()} üíé</div>
                    </div>`;
                }).join('');
            }
        };

        Game.buy = function(i) {
            const itm = this.shop[i];
            const cost = Math.floor(itm.p * Math.pow(1.6, this.data.u[i]));
            if (this.data.bal >= cost) {
                this.data.bal -= cost;
                this.data.u[i]++;
                if (itm.t === 'pwr') this.data.pwr += itm.b; else this.data.dps += itm.b;
                UI.drawShop();
                this.save();
            }
        };

        window.onload = () => Game.init();
    </script>
</body>
</html>
