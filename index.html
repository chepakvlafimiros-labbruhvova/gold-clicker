<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Locus Gold</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>
        * {
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
            box-sizing: border-box;
        }

        body {
            margin: 0; padding: 0; background-color: #000; color: #fff;
            font-family: 'Roboto', sans-serif; display: flex; flex-direction: column; height: 100vh;
            overflow: hidden;
        }

        .page { display: none; flex-direction: column; align-items: center; width: 100%; flex-grow: 1; padding-bottom: 80px; overflow-y: auto; }
        .page.active { display: flex; }

        /* –ü–ª–∞—à–∫–∞ —Å—á–µ—Ç–∞ */
        .score-container {
            margin: 20px 0; width: 90%; background: #1a1a1a;
            border: 1px solid #333; border-radius: 20px; padding: 25px 0;
            text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            flex-shrink: 0;
        }
        .score-label { font-size: 12px; color: #888; letter-spacing: 1px; margin-bottom: 5px; }
        #gold-display { font-size: 58px; font-weight: 900; color: #ffca28; margin: 0; line-height: 1; }

        /* –ú–æ–Ω–µ—Ç–∞ */
        .coin-section { flex-grow: 1; display: flex; align-items: center; justify-content: center; width: 100%; }
        #click-btn {
            width: 240px; height: 240px; background: #ffca28; border-radius: 50%;
            border: 8px solid #b8860b; font-size: 90px; font-weight: bold; color: #000;
            cursor: pointer; outline: none; border: 8px solid #b8860b;
            box-shadow: 0 0 40px rgba(255, 202, 40, 0.2); transition: transform 0.05s;
            display: flex; align-items: center; justify-content: center;
        }
        #click-btn:active { transform: scale(0.95); }

        /* –ö–Ω–æ–ø–∫–∏ */
        .actions { width: 90%; display: flex; flex-direction: column; gap: 12px; margin: 20px 0; }
        .btn { 
            padding: 18px; border-radius: 15px; border: none; font-weight: bold; 
            font-size: 16px; cursor: pointer; color: #fff; text-align: center;
        }
        .btn-green { background: #27ae60; }
        .btn-blue { background: #2980b9; }
        .btn-withdraw { background: #333; color: #777; pointer-events: none; }
        .btn-withdraw.active { background: #e67e22; color: #fff; pointer-events: auto; }

        /* –°–ø–∏—Å–∫–∏ –∏ –∏—Å—Ç–æ—Ä–∏—è */
        .list-box { width: 90%; background: #111; border-radius: 15px; padding: 10px; border: 1px solid #222; }
        .list-item { font-size: 13px; padding: 10px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; }
        .list-item:last-child { border-bottom: none; }

        /* –¢–∞–±-–±–∞—Ä */
        .tab-bar { position: fixed; bottom: 0; width: 100%; display: flex; background: #111; border-top: 1px solid #222; height: 70px; }
        .tab { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 11px; color: #555; font-weight: bold; }
        .tab.active { color: #ffca28; border-top: 2px solid #ffca28; }
    </style>
</head>
<body>

    <div class="score-container">
        <div class="score-label">–í–ê–® –ë–ê–õ–ê–ù–°</div>
        <div id="gold-display">0</div>
    </div>

    <div id="page-main" class="page active">
        <div class="coin-section">
            <button id="click-btn">G</button>
        </div>
    </div>

    <div id="page-bonus" class="page">
        <div class="actions">
            <button class="btn btn-blue" onclick="inviteFriend()">üîó –ü–†–ò–ì–õ–ê–°–ò–¢–¨ –î–†–£–ì–ê</button>
            <button class="btn btn-green" onclick="tg.showAlert('–†–µ–∫–ª–∞–º–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω–∞')">üì∫ –°–ú–û–¢–†–ï–¢–¨ –†–ï–ö–õ–ê–ú–£</button>
        </div>
        <h3 style="width:90%; font-size:16px;">–†–µ—Ñ–µ—Ä–∞–ª—ã</h3>
        <div id="ref-list" class="list-box">
            <div style="color:#555; text-align:center; padding:10px;">–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç</div>
        </div>
    </div>

    <div id="page-withdraw" class="page">
        <div class="actions">
            <button id="withdraw-btn" class="btn btn-withdraw" onclick="processWithdraw()">üí∏ –í–´–í–ï–°–¢–ò (–ú–ò–ù. 750)</button>
        </div>
        <h3 style="width:90%; font-size:16px;">–ò—Å—Ç–æ—Ä–∏—è –≤—ã–ø–ª–∞—Ç</h3>
        <div id="withdraw-history" class="list-box"></div>
    </div>

    <div class="tab-bar">
        <div class="tab active" onclick="switchPage('main', this)">–ì–õ–ê–í–ù–ê–Ø</div>
        <div class="tab" onclick="switchPage('bonus', this)">–ë–û–ù–£–°–´</div>
        <div class="tab" onclick="switchPage('withdraw', this)">–í–´–í–û–î</div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCoa29KS-sin6hoRz0ZbE4f3ki0tZLwkKI",
            authDomain: "gold-clicker-5d882.firebaseapp.com",
            projectId: "gold-clicker-5d882",
            storageBucket: "gold-clicker-5d882.firebasestorage.app",
            messagingSenderId: "83489312782",
            appId: "1:83489312782:web:ee5b7bdc390e53e7dd6c5f"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const tg = window.Telegram.WebApp;
        tg.expand();

        const userId = tg.initDataUnsafe?.user?.id ? tg.initDataUnsafe.user.id.toString() : "5223115893";
        const playerRef = db.collection('players').doc(userId);

        let gold = 0;

        async function init() {
            try {
                const doc = await playerRef.get();
                if (doc.exists) {
                    const data = doc.data();
                    gold = Number(data.gold) || 0;
                } else {
                    await playerRef.set({ gold: 0, username: tg.initDataUnsafe?.user?.username || "Player" });
                }
                updateUI();
                loadHistory();
            } catch (e) { console.error(e); }
        }

        function updateUI() {
            document.getElementById('gold-display').innerText = Math.floor(gold);
            const wBtn = document.getElementById('withdraw-btn');
            if (gold >= 750) {
                wBtn.classList.add('active');
                wBtn.innerText = "üí∏ –í–´–í–ï–°–¢–ò GOLD";
            } else {
                wBtn.classList.remove('active');
                wBtn.innerText = "üí∏ –í–´–í–ï–°–¢–ò (–ú–ò–ù. 750)";
            }
        }

        // –ö–ª–∏–∫
        document.getElementById('click-btn').addEventListener('click', (e) => {
            e.preventDefault();
            gold++;
            updateUI();
            playerRef.update({ gold: gold });
            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
        });

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü
        function switchPage(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + id).classList.add('active');
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            el.classList.add('active');
        }

        // –†–µ—Ñ–µ—Ä–∞–ª—ã
        function inviteFriend() {
            const link = `https://t.me/Locus_Gold_bot/Locus_Gold?startapp=${userId}`;
            const el = document.createElement('textarea');
            el.value = link;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            tg.showAlert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!");
        }

        // –í—ã–≤–æ–¥
        async function processWithdraw() {
            if (gold < 750) return;
            const wallet = prompt("–í–≤–µ–¥–∏—Ç–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã:");
            if (wallet) {
                const req = { amount: gold, wallet, status: 'pending', date: new Date().toLocaleString() };
                await db.collection('withdrawals').add({ ...req, userId });
                await playerRef.collection('history').add(req);
                gold = 0;
                await playerRef.update({ gold: 0 });
                updateUI();
                loadHistory();
                tg.showAlert("–ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞!");
            }
        }

        async function loadHistory() {
            const cont = document.getElementById('withdraw-history');
            const snap = await playerRef.collection('history').orderBy('date', 'desc').limit(10).get();
            cont.innerHTML = snap.empty ? '<div style="color:#555; text-align:center; padding:10px;">–ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</div>' : "";
            snap.forEach(doc => {
                const d = doc.data();
                cont.innerHTML += `<div class="list-item"><span>${d.date}</span><span>${d.amount}G</span><span style="color:#f1c40f">${d.status}</span></div>`;
            });
        }

        init();
    </script>
</body>
</html>
