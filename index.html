<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Locus Gold Premium</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>

    <style>
        /* --- –ü–ï–†–ï–ú–ï–ù–ù–´–ï –î–ò–ó–ê–ô–ù–ê --- */
        :root {
            --bg-deep: #050505;
            --surface-card: #121214;
            --surface-bright: #1c1c1e;
            --accent: #ff9d00;
            --accent-soft: rgba(255, 157, 0, 0.15);
            --accent-glow: rgba(255, 157, 0, 0.4);
            --text-main: #ffffff;
            --text-dim: #88888b;
            --success: #32d74b;
            --error: #ff453a;
            
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
            --nav-height: 85px;
        }

        /* --- –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò --- */
        * {
            margin: 0; padding: 0; box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
            outline: none;
        }

        body {
            background-color: var(--bg-deep);
            color: var(--text-main);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: fixed;
            user-select: none;
            -webkit-user-select: none;
        }

        /* --- –ì–õ–ê–í–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê (–§–ò–ö–°–ê–¶–ò–Ø –ö–ù–û–ü–û–ö) --- */
        .app-shell {
            display: flex;
            flex-direction: column;
            height: 100%;
            padding-top: calc(var(--safe-top) + 15px);
            z-index: 10;
        }

        .header-section {
            padding: 0 24px;
            text-align: center;
            flex-shrink: 0;
        }

        .balance-container {
            margin-bottom: 20px;
            animation: fadeInDown 0.6s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        .balance-value {
            font-size: 54px;
            font-weight: 900;
            letter-spacing: -2px;
            background: linear-gradient(to bottom, #fff 40%, #888 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .balance-unit {
            font-size: 20px;
            color: var(--accent);
            font-weight: 800;
            margin-left: 5px;
            -webkit-text-fill-color: initial;
        }

        /* –í–ï–†–•–ù–ò–ï –°–¢–ê–¢–ò–°–¢–ò–ß–ï–°–ö–ò–ï –ö–ù–û–ü–ö–ò */
        .top-stats-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 25px;
        }

        .stat-plate {
            background: var(--surface-card);
            border: 1px solid #252527;
            padding: 14px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .stat-plate label {
            display: block;
            font-size: 10px;
            color: var(--text-dim);
            text-transform: uppercase;
            font-weight: 800;
            margin-bottom: 4px;
            letter-spacing: 0.5px;
        }

        .stat-plate span {
            font-size: 17px;
            font-weight: 700;
            color: #fff;
        }

        /* –¶–ï–ù–¢–†–ê–õ–¨–ù–ê–Ø –°–ö–†–û–õ–õ-–ó–û–ù–ê */
        .main-content {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .view-page {
            position: absolute;
            inset: 0;
            display: none;
            flex-direction: column;
            padding: 0 24px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .view-page.active {
            display: flex;
        }

        /* --- –ì–†–ê–§–ò–ö–ê –ö–õ–ò–ö–ï–†–ê --- */
        .mining-core {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 0;
        }

        .coin-portal {
            width: 260px;
            height: 260px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .coin-glow {
            position: absolute;
            width: 130%;
            height: 130%;
            background: radial-gradient(circle, var(--accent-glow) 0%, transparent 70%);
            z-index: 1;
            animation: pulseGlow 3s infinite ease-in-out;
        }

        .coin-body {
            width: 240px;
            height: 240px;
            background: radial-gradient(circle at 30% 30%, #ffc400 0%, #ff8000 100%);
            border-radius: 50%;
            border: 10px solid #1a1a1c;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 110px;
            color: rgba(0,0,0,0.25);
            font-weight: 900;
            z-index: 2;
            cursor: pointer;
            box-shadow: 0 15px 40px rgba(0,0,0,0.6);
            transition: transform 0.05s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .coin-body:active {
            transform: scale(0.92);
        }

        /* –ù–ò–ñ–ù–ò–ï –ö–ù–û–ü–ö–ò –ú–ê–ô–ù–ò–ù–ì–ê */
        .mining-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
            flex-shrink: 0;
        }

        .action-tile {
            background: var(--surface-card);
            border: 1px solid #252527;
            padding: 18px 15px;
            border-radius: 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            transition: 0.2s;
        }

        .action-tile:active {
            background: var(--surface-bright);
            transform: translateY(2px);
        }

        .action-tile i { font-style: normal; font-size: 24px; margin-bottom: 4px; }
        .action-tile b { font-size: 14px; font-weight: 700; }
        .action-tile span { font-size: 10px; color: var(--accent); font-weight: 800; text-transform: uppercase; }

        .big-upgrade-tile {
            grid-column: span 2;
            border-color: var(--accent);
            background: linear-gradient(135deg, rgba(255,157,0,0.05) 0%, transparent 100%);
        }

        /* --- –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨–°–ö–û–ï –°–û–ì–õ–ê–®–ï–ù–ò–ï (–î–ò–ó–ê–ô–ù) --- */
        .overlay-guard {
            position: fixed; inset: 0; background: rgba(0,0,0,0.96); z-index: 9999;
            display: none; align-items: center; justify-content: center; padding: 25px;
            backdrop-filter: blur(10px);
        }

        .modal-tos {
            background: var(--surface-card); width: 100%; max-width: 340px;
            border-radius: 32px; padding: 35px 25px; text-align: center;
            border: 1px solid #2c2c2e; box-shadow: 0 25px 60px rgba(0,0,0,0.8);
        }

        .tos-icon {
            font-size: 50px; margin-bottom: 20px;
            display: inline-block; animation: bounce 2s infinite;
        }

        .btn-full-tos {
            background: linear-gradient(135deg, #ff9d00, #e68a00); color: #000;
            padding: 20px; border-radius: 18px; font-weight: 800; font-size: 16px;
            width: 100%; border: none; margin-bottom: 15px;
            box-shadow: 0 8px 20px rgba(255, 157, 0, 0.3);
        }

        .btn-agree {
            background: #fff; color: #000; padding: 16px; border-radius: 16px;
            width: 100%; border: none; font-weight: 700; font-size: 14px;
        }

        #full-tos-screen {
            position: fixed; inset: 0; background: #000; z-index: 10000;
            display: none; flex-direction: column; padding: calc(var(--safe-top) + 30px) 25px 40px;
            overflow-y: auto;
        }

        .tos-content-text h2 { color: var(--accent); font-size: 18px; margin: 25px 0 10px; text-transform: uppercase; }
        .tos-content-text p { color: #b1b1b7; font-size: 14px; line-height: 1.7; margin-bottom: 15px; }

        /* --- –°–ü–ò–°–ö–ò –ò –≠–õ–ï–ú–ï–ù–¢–´ --- */
        .list-section-title {
            font-size: 12px; color: var(--text-dim); font-weight: 800;
            text-transform: uppercase; margin: 30px 0 15px; letter-spacing: 1.2px;
        }

        .data-card {
            background: var(--surface-card); padding: 20px; border-radius: 22px;
            margin-bottom: 12px; display: flex; justify-content: space-between;
            align-items: center; border: 1px solid #222;
        }

        .status-pill {
            padding: 6px 14px; border-radius: 12px; font-size: 10px; font-weight: 900;
            text-transform: uppercase;
        }
        .status-pill.wait { background: rgba(255,157,0,0.1); color: var(--accent); }
        .status-pill.done { background: rgba(50,215,75,0.1); color: var(--success); }

        /* --- –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ (–ù–ê–í–ò–ì–ê–¶–ò–Ø) --- */
        .nav-dock {
            height: calc(var(--nav-height) + var(--safe-bottom));
            background: rgba(10, 10, 11, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid #1c1c1e;
            display: flex;
            padding: 10px 15px calc(var(--safe-bottom) + 10px);
            flex-shrink: 0;
            z-index: 100;
        }

        .nav-btn {
            flex: 1; display: flex; flex-direction: column; align-items: center;
            justify-content: center; color: var(--text-dim); background: none;
            border: none; transition: 0.3s;
        }

        .nav-btn.active { color: var(--accent); }
        .nav-btn i { font-size: 24px; font-style: normal; margin-bottom: 4px; }
        .nav-btn span { font-size: 10px; font-weight: 800; text-transform: uppercase; }

        /* --- –ê–ù–ò–ú–ê–¶–ò–ò --- */
        @keyframes pulseGlow { 0%, 100% { opacity: 0.4; transform: scale(1); } 50% { opacity: 0.7; transform: scale(1.1); } }
        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        .particle {
            position: absolute; color: var(--accent); font-weight: 900; font-size: 28px;
            pointer-events: none; animation: particleFly 0.8s ease-out forwards;
            text-shadow: 0 0 10px var(--accent-glow); z-index: 1000;
        }
        @keyframes particleFly {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-140px) scale(1.5); }
        }
    </style>
</head>
<body>

    <div id="tos-guard" class="overlay-guard">
        <div class="modal-tos">
            <span class="tos-icon">üìú</span>
            <h3 style="margin-bottom: 20px;">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h3>
            <button class="btn-full-tos" onclick="Logic.toggleFullTos(true)">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ</button>
            <button class="btn-agree" onclick="Logic.acceptTos()">–Ø –°–û–ì–õ–ê–°–ï–ù</button>
        </div>
    </div>

    <div id="full-tos-screen">
        <div class="tos-content-text">
            <h1 style="text-align: center; color: #fff;">Locus Gold Ultra</h1>
            <p style="text-align: center; color: var(--accent); font-weight: 800;">–õ–∏—Ü–µ–Ω–∑–∏–æ–Ω–Ω–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ (v3.2)</p>
            
            <h2>1. –°—Ç–∞—Ç—É—Å –í–∞–ª—é—Ç—ã</h2>
            <p>Gold (G) ‚Äî —ç—Ç–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –∏–≥—Ä–æ–≤–æ–π –±–∞–ª–ª. –û–Ω –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ø–ª–∞—Ç–µ–∂–Ω—ã–º —Å—Ä–µ–¥—Å—Ç–≤–æ–º, –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–æ–π –∏–ª–∏ —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–µ–Ω—å–≥–∞–º–∏. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —è–≤–ª—è–µ—Ç—Å—è —Ä–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–º —Å–∏–º—É–ª—è—Ç–æ—Ä–æ–º.</p>
            
            <h2>2. –ü—Ä–æ—Ü–µ—Å—Å –≤—ã–≤–æ–¥–∞</h2>
            <p>–í—ã–≤–æ–¥ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –±–∞–ª–ª–æ–≤ –Ω–∞ –∏–≥—Ä–æ–≤–æ–π ID Standoff 2 –¥–æ—Å—Ç—É–ø–µ–Ω –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ 750 G. –°—Ä–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ—Ç 24 –¥–æ 72 —á–∞—Å–æ–≤.</p>
            
            <h2>3. –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å</h2>
            <p>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º –ø—Ä–æ–¥—É–∫—Ç–æ–º Axlebolt Ltd. –í—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –Ω–∞–∑–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –æ–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª—è—Ö.</p>
            
            <h2>4. –°–∏—Å—Ç–µ–º–∞ –ê–Ω—Ç–∏-–§—Ä–æ–¥</h2>
            <p>–ó–∞–ø—Ä–µ—â–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–ª–∏–∫–µ—Ä–æ–≤, —ç–º—É–ª—è—Ç–æ—Ä–æ–≤ –∏–ª–∏ –±–æ—Ç–æ–≤. –ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –Ω–∞–∫—Ä—É—Ç–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–Ω–Ω—É–ª–∏—Ä—É–µ—Ç –±–∞–ª–∞–Ω—Å –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.</p>
        </div>
        <button class="btn-full-tos" style="margin-top: 30px;" onclick="Logic.toggleFullTos(false)">–ó–ê–ö–†–´–¢–¨</button>
    </div>

    <div class="app-shell">
        
        <header class="header-section">
            <div class="balance-container">
                <div class="balance-value" id="disp-gold">0.000</div>
                <div class="balance-unit">GOLD</div>
            </div>
            
            <div class="top-stats-row">
                <div class="stat-plate">
                    <label>–°–∏–ª–∞ –∫–ª–∏–∫–∞</label>
                    <span id="disp-pwr">0.001</span>
                </div>
                <div class="stat-plate">
                    <label>–î—Ä—É–∑—å—è</label>
                    <span id="disp-refs">0</span>
                </div>
            </div>
        </header>

        <main class="main-content">
            
            <div id="v-mine" class="view-page active">
                <div class="mining-core">
                    <div class="coin-portal">
                        <div class="coin-glow"></div>
                        <div class="coin-body" id="tap-target">G</div>
                    </div>
                </div>

                <div class="mining-actions">
                    <div class="action-tile" onclick="Logic.showAds('gold')">
                        <i>üéÅ</i><b>–ë–û–ù–£–° +5.0 G</b><span>ADSGRAM</span>
                    </div>
                    <div class="action-tile" onclick="Logic.showAds('pwr')">
                        <i>‚ö°</i><b>–°–ò–õ–ê +0.005</b><span>–†–ï–ö–õ–ê–ú–ê</span>
                    </div>
                    <div class="action-tile big-upgrade-tile" onclick="Logic.upgrade()">
                        <i>üöÄ</i><b>–£–õ–£–ß–®–ò–¢–¨ –ö–õ–ò–ö –ó–ê 1,000 G</b><span>–ü–û–í–´–°–ò–¢–¨ –î–û–•–û–î (+0.005)</span>
                    </div>
                </div>
            </div>

            <div id="v-wallet" class="view-page">
                <div class="stat-plate" style="padding: 30px; margin-bottom: 10px;">
                    <p style="color: var(--text-dim); font-size: 13px; margin-bottom: 15px;">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –¥–ª—è –≤—ã–≤–æ–¥–∞: 750 G</p>
                    <button id="btn-wd" class="btn-full-tos" style="opacity: 0.4; margin: 0;" disabled>–û–§–û–†–ú–ò–¢–¨ –í–´–í–û–î</button>
                </div>
                <p class="list-section-title">–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</p>
                <div id="history-container"></div>
            </div>

            <div id="v-friends" class="view-page">
                <div class="stat-plate" style="padding: 30px; margin-bottom: 10px;">
                    <h3 style="margin-bottom: 10px;">–ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–≥–∞</h3>
                    <p style="color: var(--text-dim); font-size: 13px; margin-bottom: 20px;">–ü–æ–ª—É—á–∏ 100 G —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥—Ä—É–≥–∞!</p>
                    <button class="btn-full-tos" style="margin: 0;" onclick="Logic.invite()">–°–ö–û–ü–ò–†–û–í–ê–¢–¨ –°–°–´–õ–ö–£</button>
                </div>
                <p class="list-section-title">–í–∞—à–∏ —Ä–µ—Ñ–µ—Ä–∞–ª—ã</p>
                <div id="ref-container"></div>
            </div>

        </main>

        <nav class="nav-dock">
            <button class="nav-btn active" onclick="UI.switch('mine', this)"><i>‚õèÔ∏è</i><span>–ú–∞–π–Ω–∏–Ω–≥</span></button>
            <button class="nav-btn" onclick="UI.switch('friends', this)"><i>üë•</i><span>–î—Ä—É–∑—å—è</span></button>
            <button class="nav-btn" onclick="UI.switch('wallet', this)"><i>üè¶</i><span>–í—ã–≤–æ–¥</span></button>
        </nav>

    </div>

    <script>
    /**
     * CORE ENGINE
     * –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Telegram –∏ Firebase
     */
    const Logic = {
        db: null, tg: window.Telegram.WebApp, uid: null,
        gold: 0, pwr: 0.001, journal: 0,
        adId: "19895",

        async start() {
            this.tg.expand();
            this.tg.enableClosingConfirmation();
            this.uid = this.tg.initDataUnsafe?.user?.id?.toString() || "DEBUG_USER";
            
            // Firebase Config
            firebase.initializeApp({
                apiKey: "AIzaSyCoa29KS-sin6hoRz0ZbE4f3ki0tZLwkKI",
                projectId: "gold-clicker-5d882",
                appId: "1:83489312782:web:ee5b7bdc390e53e7dd6c5f"
            });
            this.db = firebase.firestore();

            // Session Check
            const player = await this.db.collection('players').doc(this.uid).get();
            if(!player.exists || !player.data().acceptedTos) {
                document.getElementById('tos-guard').style.display = 'flex';
            } else {
                this.gold = player.data().gold || 0;
                this.pwr = player.data().pwr || 0.001;
                this.render();
            }

            // Sync Loop
            setInterval(() => this.push(), 5000);
            
            // Event Listeners
            document.getElementById('tap-target').addEventListener('touchstart', (e) => this.handleTap(e));
        },

        async acceptTos() {
            document.getElementById('tos-guard').style.display = 'none';
            await this.db.collection('players').doc(this.uid).set({
                gold: 0, pwr: 0.001, acceptedTos: true,
                name: this.tg.initDataUnsafe?.user?.first_name || "Gamer"
            }, {merge: true});
            this.handleReferral();
            this.render();
        },

        async handleReferral() {
            const rid = this.tg.initDataUnsafe?.start_param;
            if(rid && rid !== this.uid) {
                await this.db.collection('players').doc(rid).update({ 
                    gold: firebase.firestore.FieldValue.increment(100) 
                });
                await this.db.collection('players').doc(rid).collection('referrals').add({
                    name: this.tg.initDataUnsafe?.user?.first_name || "Friend",
                    date: new Date().toLocaleDateString()
                });
            }
        },

        handleTap(e) {
            e.preventDefault();
            this.gold += this.pwr;
            this.journal += this.pwr;
            this.render();
            
            const touch = e.touches[0];
            UI.animateTap(touch.clientX, touch.clientY, this.pwr);
            
            if(this.tg.HapticFeedback) {
                this.tg.HapticFeedback.impactOccurred('medium');
            }
        },

        async push() {
            if(this.journal <= 0) return;
            const amount = this.journal;
            await this.db.collection('players').doc(this.uid).update({
                gold: firebase.firestore.FieldValue.increment(amount),
                pwr: this.pwr
            });
            this.journal -= amount;
        },

        showAds(type) {
            const ad = window.Adsgram.init({ blockId: this.adId });
            ad.show().then(() => {
                if(type === 'gold') this.gold += 5; else this.pwr += 0.005;
                this.push(); this.render();
            }).catch(() => this.tg.showAlert("–†–µ–∫–ª–∞–º–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ."));
        },

        async upgrade() {
            if(this.gold < 1) return this.tg.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ Gold –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è!");
            this.gold -= 1; this.pwr += 0.005;
            await this.db.collection('players').doc(this.uid).update({
                gold: firebase.firestore.FieldValue.increment(-1),
                pwr: firebase.firestore.FieldValue.increment(0.005)
            });
            this.render();
            this.tg.showAlert("–ú–æ—â–Ω–æ—Å—Ç—å –∫–ª–∏–∫–∞ —É—Å–ø–µ—à–Ω–æ –ø–æ–≤—ã—à–µ–Ω–∞!");
        },

        render() {
            document.getElementById('disp-gold').innerText = this.gold.toFixed(3);
            document.getElementById('disp-pwr').innerText = this.pwr.toFixed(3);
            
            const b = document.getElementById('btn-wd');
            if(this.gold >= 750) {
                b.style.opacity = "1"; b.disabled = false;
                b.onclick = () => this.startWithdraw();
            } else {
                b.style.opacity = "0.4"; b.disabled = true;
            }
        },

        async startWithdraw() {
            const sid = prompt("–í–≤–µ–¥–∏—Ç–µ ID Standoff 2 (—Ü–∏—Ñ—Ä—ã):");
            if(!sid || sid.length < 8) return this.tg.showAlert("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID –∏–≥—Ä–æ–∫–∞.");
            
            const req = { sid, amount: Math.floor(this.gold), status: '–û–∂–∏–¥–∞–Ω–∏–µ', date: new Date().toLocaleDateString() };
            await this.db.collection('withdrawals').add({ ...req, uid: this.uid });
            await this.db.collection('players').doc(this.uid).collection('history').add(req);
            
            this.gold = 0; await this.db.collection('players').doc(this.uid).update({ gold: 0 });
            this.render(); this.loadHistory();
            this.tg.showAlert("–ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞! –û–∂–∏–¥–∞–π—Ç–µ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –≥–æ–ª–¥—ã –≤ —Ç–µ—á–µ–Ω–∏–µ 72 —á–∞—Å–æ–≤.");
        },

        toggleFullTos(show) { document.getElementById('full-tos-screen').style.display = show ? 'flex' : 'none'; },

        invite() {
            const link = `https://t.me/Locus_Gold_bot/Locus_Gold?startapp=${this.uid}`;
            navigator.clipboard.writeText(link);
            this.tg.showAlert("–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!");
        },

        async loadHistory() {
            const cont = document.getElementById('history-container');
            const snap = await this.db.collection('players').doc(this.uid).collection('history').get();
            cont.innerHTML = snap.empty ? '<center style="color:#444; margin-top:30px">–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</center>' : '';
            snap.forEach(doc => {
                const d = doc.data(); const isWait = d.status === '–û–∂–∏–¥–∞–Ω–∏–µ';
                cont.innerHTML += `
                    <div class="data-card">
                        <div><b>${d.amount} G</b><br><small style="color:var(--text-dim)">ID: ${d.sid}</small></div>
                        <span class="status-pill ${isWait ? 'wait' : 'done'}">${d.status}</span>
                    </div>`;
            });
        },

        async loadRefs() {
            const cont = document.getElementById('ref-container');
            const snap = await this.db.collection('players').doc(this.uid).collection('referrals').get();
            cont.innerHTML = snap.empty ? '<center style="color:#444; margin-top:30px">–í—ã –µ—â–µ –Ω–µ –ø—Ä–∏–≥–ª–∞—à–∞–ª–∏ –¥—Ä—É–∑–µ–π</center>' : '';
            document.getElementById('disp-refs').innerText = snap.size;
            snap.forEach(doc => {
                cont.innerHTML += `
                    <div class="data-card">
                        <b>${doc.data().name}</b>
                        <span class="status-pill done">+100 G</span>
                    </div>`;
            });
        }
    };

    /**
     * UI ENGINE
     * –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –∏ –∞–Ω–∏–º–∞—Ü–∏—è–º–∏
     */
    const UI = {
        switch(viewId, btn) {
            document.querySelectorAll('.view-page').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('v-' + viewId).classList.add('active');
            btn.classList.add('active');
            
            if(viewId === 'wallet') Logic.loadHistory();
            if(viewId === 'friends') Logic.loadRefs();
        },

        animateTap(x, y, val) {
            const p = document.createElement('div');
            p.className = 'particle';
            p.innerText = `+${val.toFixed(3)}`;
            p.style.left = x + 'px';
            p.style.top = (y - 50) + 'px';
            document.body.appendChild(p);
            setTimeout(() => p.remove(), 800);
        }
    };

    window.onload = () => Logic.start();
    </script>
</body>
</html>
