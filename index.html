<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gold Clicker</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            text-align: center; 
            background: #0f0f0f; 
            color: white; 
            margin: 0; 
            overflow: hidden; 
            user-select: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }
        #gold-display { font-size: 56px; font-weight: bold; color: #ffca28; text-shadow: 0 0 20px rgba(255,202,40,0.5); }
        .label { font-size: 18px; color: #888; margin-bottom: 10px; }
        #click-btn { 
            width: 220px; height: 220px; border-radius: 50%; border: none; 
            background: radial-gradient(circle, #ffeb3b 0%, #fbc02d 100%);
            box-shadow: 0 0 40px rgba(251, 192, 45, 0.4); 
            font-size: 100px; cursor: pointer; transition: transform 0.05s;
            display: flex; align-items: center; justify-content: center;
            margin-top: 20px;
        }
        #click-btn:active { transform: scale(0.92); }
    </style>
</head>
<body>

    <div class="label">–í–ê–®–ï –ó–û–õ–û–¢–û</div>
    <div id="gold-display">0</div>
    <button id="click-btn">üìÄ</button>

    <script>
        // --- –í–ê–®–ê –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø FIREBASE ---
        const firebaseConfig = {
            apiKey: "AIzaSyCoa29KS-sin6hoRz0ZbE4f3ki0tZLwkKI",
            authDomain: "gold-clicker-5d882.firebaseapp.com",
            projectId: "gold-clicker-5d882",
            storageBucket: "gold-clicker-5d882.firebasestorage.app",
            messagingSenderId: "83489312782",
            appId: "1:83489312782:web:ee5b7bdc390e53e7dd6c5f"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // --- –õ–û–ì–ò–ö–ê TELEGRAM ---
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        // –ü–æ–ª—É—á–∞–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const userId = tg.initDataUnsafe?.user?.id ? tg.initDataUnsafe.user.id.toString() : "test_user_123";
        const playerRef = db.collection('players').doc(userId);

        let gold = 0;
        const display = document.getElementById('gold-display');

        // --- –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• –ü–†–ò –°–¢–ê–†–¢–ï ---
        async function loadData() {
            try {
                const doc = await playerRef.get();
                if (doc.exists) {
                    gold = doc.data().gold || 0;
                } else {
                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
                    await playerRef.set({ 
                        gold: 0, 
                        username: tg.initDataUnsafe?.user?.username || "Unknown" 
                    });
                }
                display.innerText = gold;
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:", e);
            }
        }

        // --- –û–ë–†–ê–ë–û–¢–ö–ê –ö–õ–ò–ö–ê ---
        document.getElementById('click-btn').addEventListener('click', () => {
            gold++;
            display.innerText = gold;
            
            // –í–∏–±—Ä–æ–æ—Ç–∫–ª–∏–∫ Telegram
            tg.HapticFeedback.impactOccurred('medium');

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Firebase (—Ä–∞–∑ –≤ 1 –∫–ª–∏–∫ –¥–ª—è —Ç–µ—Å—Ç–∞, –ø–æ–∑–∂–µ –º–æ–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å)
            playerRef.update({ gold: gold }).catch(err => {
                console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:", err);
            });
        });

        loadData();
    </script>
</body>
</html>
