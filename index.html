<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Locus Space Evolution</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>

    <style>
        :root {
            --bg: #0a0a0b;
            --surface: #161618;
            --accent: #00d2ff; /* –°–º–µ–Ω–∏–ª–∏ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –æ—Ä–∞–Ω–∂–µ–≤—ã–π –Ω–∞ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–Ω—ã–π –≥–æ–ª—É–±–æ–π */
            --error: #ff3b30;
            --text-dim: #8e8e93;
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: #fff; height: 100vh; overflow: hidden; position: fixed; width: 100%; display: flex; flex-direction: column; }

        .screen { position: absolute; inset: 0; display: none; flex-direction: column; padding: 20px 20px calc(80px + var(--safe-bottom)); overflow-y: auto; }
        .screen.active { display: flex; }

        /* HEADER */
        .gold-header { text-align: center; margin-top: 10px; }
        .gold-count { font-size: 48px; font-weight: 900; color: #fff; text-shadow: 0 0 20px rgba(0,210,255,0.3); }
        .gold-label { font-size: 12px; color: var(--accent); letter-spacing: 2px; text-transform: uppercase; font-weight: 800; }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 25px 0; }
        .stat-card { background: var(--surface); border-radius: 16px; padding: 12px; text-align: center; border: 1px solid #2c2c2e; }
        .stat-card span { display: block; color: var(--text-dim); font-size: 9px; font-weight: 800; text-transform: uppercase; }
        .stat-card b { font-size: 16px; color: #fff; }

        /* COIN / OBJECT */
        .click-area { flex: 1; display: flex; align-items: center; justify-content: center; }
        .coin {
            width: 200px; height: 200px; border-radius: 40px; /* –ö–≤–∞–¥—Ä–∞—Ç —Å–æ —Å–∫—Ä—É–≥–ª–µ–Ω–∏—è–º–∏ –≤—ã–≥–ª—è–¥–∏—Ç –±–æ–ª–µ–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ */
            background: linear-gradient(135deg, #00d2ff, #3a7bd5);
            box-shadow: 0 0 50px rgba(0, 210, 255, 0.2);
            display: flex; align-items: center; justify-content: center;
            transition: transform 0.05s; cursor: pointer;
        }
        .coin:active { transform: scale(0.95); }
        .coin i { font-size: 80px; font-style: normal; }

        /* BUTTONS */
        .action-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .btn-act { background: var(--surface); border: 1px solid #333; border-radius: 16px; padding: 15px 5px; text-align: center; }
        .btn-act b { display: block; font-size: 13px; color: #fff; }
        .btn-act small { color: var(--accent); font-size: 9px; font-weight: 700; }
        
        .btn-upg { grid-column: span 2; background: linear-gradient(90deg, #1a1a1c, #252528); border: 1px solid var(--accent); }

        /* NAVIGATION */
        .nav { position: fixed; bottom: 0; width: 100%; height: calc(70px + var(--safe-bottom)); background: #000; border-top: 1px solid #222; display: flex; padding-bottom: var(--safe-bottom); }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--text-dim); text-decoration: none; opacity: 0.6; }
        .nav-item.active { color: var(--accent); opacity: 1; }
        .nav-item i { font-size: 20px; margin-bottom: 4px; font-style: normal; }
        .nav-item span { font-size: 9px; font-weight: 700; }

        .list-item { background: var(--surface); padding: 15px; border-radius: 14px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

    <div class="screen active" id="scr-main">
        <div class="gold-header">
            <div class="gold-count" id="gold-val">0</div>
            <div class="gold-label">XP POINTS</div>
        </div>
        <div class="stats-grid">
            <div class="stat-card"><span>POWER</span><b id="pwr-val">1</b></div>
            <div class="stat-card"><span>LEVEL</span><b id="lvl-val">1</b></div>
        </div>
        <div class="click-area"><div class="coin" id="coin-btn"><i>üíé</i></div></div>
        <div class="action-btns">
            <div class="btn-act" onclick="Game.showAd('gold')"><b>FREE BOOST</b><small>WATCH AD</small></div>
            <div class="btn-act" onclick="Game.showAd('pwr')"><b>EVOLVE</b><small>WATCH AD</small></div>
            <div class="btn-act btn-upg" id="upg-btn" onclick="Game.upgrade()">
                <b id="upg-txt">UPGRADE (10 XP)</b>
                <small>INCREASE CLICK POWER</small>
            </div>
        </div>
    </div>

    <div class="screen" id="scr-wallet">
        <h2 style="text-align:center; margin-bottom:20px;">INVENTORY</h2>
        <div class="stat-card" style="margin-bottom:25px; padding: 25px;">
            <p style="font-size: 12px; color: var(--text-dim);">Collect 10,000 XP to unlock special rewards and mystery boxes.</p>
            <div style="height: 10px; background: #000; border-radius: 5px; margin: 15px 0; overflow: hidden;">
                <div id="progress-bar" style="width: 0%; height: 100%; background: var(--accent);"></div>
            </div>
            <button class="btn-act" id="wd-btn" style="width:100%; background:#333; color:#aaa; border:none;" onclick="Game.withdraw()">UNLOCK REWARD</button>
        </div>
        <div id="history-list"></div>
    </div>

    <div class="screen" id="scr-top"><h2 style="text-align:center; margin-bottom:20px;">GLOBAL RANKING</h2><div id="top-list"></div></div>
    
    <div class="screen" id="scr-ref">
        <h2 style="text-align:center; margin-bottom:20px;">COMMUNITY</h2>
        <p style="text-align: center; color: var(--text-dim); margin-bottom: 20px; font-size: 13px;">Invite friends to grow your network and earn 10% of their activity.</p>
        <button class="btn-act btn-upg" style="width:100%;" onclick="Game.invite()"><b>INVITE FRIEND</b></button>
    </div>

    <nav class="nav">
        <div class="nav-item active" onclick="UI.nav('main', this)"><i>‚ö°</i><span>Main</span></div>
        <div class="nav-item" onclick="UI.nav('top', this)"><i>üèÜ</i><span>Top</span></div>
        <div class="nav-item" onclick="UI.nav('ref', this)"><i>ü§ù</i><span>Social</span></div>
        <div class="nav-item" onclick="UI.nav('wallet', this)"><i>üì¶</i><span>Rewards</span></div>
    </nav>

    <script>
    // –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –≤–∞—à–∏ —Ä–∞–±–æ—á–∏–µ –∫–ª—é—á–∏ Firebase
    const Game = {
        db: null, tg: window.Telegram.WebApp, uid: null,
        data: { gold: 0, pwr: 1, upg: 0, name: 'Explorer' },
        
        async init() {
            this.tg.expand();
            this.uid = this.tg.initDataUnsafe?.user?.id?.toString() || "DEV_USER";
            
            firebase.initializeApp({
                apiKey: "AIzaSyCoa29KS-sin6hoRz0ZbE4f3ki0tZLwkKI",
                projectId: "gold-clicker-5d882",
                appId: "1:83489312782:web:ee5b7bdc390e53e7dd6c5f"
            });
            this.db = firebase.firestore();

            const doc = await this.db.collection('players').doc(this.uid).get();
            if(doc.exists) this.data = doc.data();
            else this.saveCloud();

            this.render();
            document.getElementById('coin-btn').onclick = (e) => this.tap(e);
            setInterval(() => this.saveCloud(), 15000);
        },

        tap(e) {
            this.data.gold += this.data.pwr;
            this.render();
            if(this.tg.HapticFeedback) this.tg.HapticFeedback.impactOccurred('light');
        },

        getPrice() { return Math.floor(10 * Math.pow(1.5, this.data.upg)); },

        upgrade() {
            const p = this.getPrice();
            if(this.data.gold < p) return;
            this.data.gold -= p;
            this.data.pwr += 1;
            this.data.upg++;
            this.render();
            this.saveCloud();
        },

        async saveCloud() {
            await this.db.collection('players').doc(this.uid).set(this.data, {merge: true});
        },

        render() {
            document.getElementById('gold-val').innerText = Math.floor(this.data.gold).toLocaleString();
            document.getElementById('pwr-val').innerText = this.data.pwr;
            document.getElementById('upg-txt').innerText = `UPGRADE (${this.getPrice()} XP)`;
            
            const prog = Math.min((this.data.gold / 10000) * 100, 100);
            document.getElementById('progress-bar').style.width = prog + '%';
        },

        async withdraw() {
            // –£–±—Ä–∞–ª–∏ Standoff 2 ID. –¢–µ–ø–µ—Ä—å —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ "Claim".
            if(this.data.gold < 10000) return this.tg.showAlert("Collect 10,000 XP first!");
            this.tg.showAlert("Success! Our team will verify your progress within 48 hours.");
        },

        async loadTop() {
            const list = document.getElementById('top-list');
            list.innerHTML = "Loading...";
            const snap = await this.db.collection('players').orderBy('gold', 'desc').limit(20).get();
            list.innerHTML = "";
            snap.forEach(doc => {
                const d = doc.data();
                list.innerHTML += `<div class="list-item"><span>${d.name || 'User'}</span><b>${Math.floor(d.gold)}</b></div>`;
            });
        },

        showAd(type) {
            // –î–ª—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ –∏–ª–∏ –±—ã—Ç—å —É–≤–µ—Ä–µ–Ω–Ω—ã–º, —á—Ç–æ Adsgram –Ω–µ –∑–∞–±–∞–Ω–∏–ª –¥–æ–º–µ–Ω
            if(typeof Adsgram === 'undefined') return alert("Ad Blocked");
            const ad = Adsgram.init({ blockId: "19895" });
            ad.show().then(() => {
                if(type === 'gold') this.data.gold += 500; else this.data.pwr += 5;
                this.render(); this.saveCloud();
            }).catch(() => {});
        },

        invite() {
            const link = `https://t.me/Locus_Gold_bot/app?startapp=${this.uid}`;
            this.tg.openTelegramLink(`https://t.me/share/url?url=${link}&text=Join my mining team!`);
        }
    };

    const UI = {
        nav(id, el) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('scr-' + id).classList.add('active');
            el.classList.add('active');
            if(id === 'top') Game.loadTop();
        }
    };

    window.onload = () => Game.init();
    </script>
</body>
</html>
