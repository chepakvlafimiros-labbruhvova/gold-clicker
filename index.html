<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Last War Prototype</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --neon: #22d3ee; --zombie: #4ade80; }
        body { margin: 0; background: var(--bg); color: #fff; font-family: sans-serif; overflow: hidden; }
        
        /* Экран базы */
        #base-screen { height: 100vh; display: flex; flex-direction: column; }
        .header { padding: 20px; background: var(--card); border-bottom: 2px solid #334155; display: flex; justify-content: space-around; }
        .res { text-align: center; }
        .res small { display: block; color: #94a3b8; font-size: 10px; }
        
        .map { flex: 1; position: relative; background: #111827; overflow-y: auto; padding: 20px; }
        .building { background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #334155; }
        .build-btn { background: var(--neon); color: #000; border: none; padding: 10px; border-radius: 8px; font-weight: bold; width: 100%; margin-top: 10px; }

        /* Экран миссии (Раннер) */
        #mission-screen { display: none; height: 100vh; position: relative; background: #050505; }
        #game-canvas { width: 100%; height: 100%; display: block; }
        .mission-ui { position: absolute; top: 20px; width: 100%; text-align: center; pointer-events: none; }
        .soldier-count { font-size: 32px; font-weight: 900; color: var(--neon); text-shadow: 0 0 10px rgba(34,211,238,0.5); }

        .start-mission { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #f87171; color: white; padding: 20px 40px; border-radius: 50px; font-size: 20px; font-weight: 900; border: none; box-shadow: 0 0 20px rgba(248,113,113,0.4); }
    </style>
</head>
<body>

    <div id="base-screen">
        <div class="header">
            <div class="res"><small>ЗОЛОТО</small><b id="res-gold">500</b></div>
            <div class="res"><small>АРМИЯ</small><b id="res-army">10</b></div>
            <div class="res"><small>УРОВЕНЬ</small><b id="res-lvl">1</b></div>
        </div>
        
        <div class="map">
            <div class="building">
                <h3>Штаб (Ур. <span id="hq-lvl">1</span>)</h3>
                <p>Увеличивает общий доход золота.</p>
                <button class="build-btn" onclick="Base.upgrade('hq')">Улучшить ($200)</button>
            </div>
            <div class="building">
                <h3>Казармы (Ур. <span id="br-lvl">1</span>)</h3>
                <p>Больше солдат в начале миссии.</p>
                <button class="build-btn" onclick="Base.upgrade('barracks')">Улучшить ($300)</button>
            </div>
        </div>

        <button class="start-mission" onclick="Runner.start()">В БОЙ!</button>
    </div>

    <div id="mission-screen">
        <div class="mission-ui">
            <div class="soldier-count" id="count-ui">10</div>
            <div style="color: #94a3b8">Двигай пальцем, чтобы управлять</div>
        </div>
        <canvas id="game-canvas"></canvas>
    </div>

    <script>
        // ЛОГИКА БАЗЫ
        const Base = {
            gold: 500, army: 10, hq: 1, barracks: 1,
            upgrade(type) {
                let cost = type === 'hq' ? 200 * this.hq : 300 * this.barracks;
                if(this.gold >= cost) {
                    this.gold -= cost;
                    this[type]++;
                    if(type === 'barracks') this.army += 5;
                    this.updateUI();
                }
            },
            updateUI() {
                document.getElementById('res-gold').innerText = Math.floor(this.gold);
                document.getElementById('res-army').innerText = this.army;
                document.getElementById('hq-lvl').innerText = this.hq;
                document.getElementById('br-lvl').innerText = this.barracks;
            }
        };

        // ЛОГИКА РАННЕРА (Last War Mechanic)
        const Runner = {
            active: false,
            canvas: document.getElementById('game-canvas'),
            ctx: null,
            count: 10,
            playerX: 0,
            objects: [],
            speed: 4,

            start() {
                document.getElementById('base-screen').style.display = 'none';
                document.getElementById('mission-screen').style.display = 'block';
                this.ctx = this.canvas.getContext('2d');
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
                this.count = Base.army;
                this.playerX = this.canvas.width / 2;
                this.objects = [];
                this.active = true;
                this.spawnLevel();
                this.loop();
            },

            spawnLevel() {
                for(let i = 1; i < 10; i++) {
                    // Создаем ворота
                    let isMult = Math.random() > 0.5;
                    this.objects.push({
                        y: -i * 400,
                        x: 0,
                        type: 'gate',
                        val: isMult ? 2 : 10,
                        mode: isMult ? 'mult' : 'add',
                        text: isMult ? 'x2' : '+10'
                    });
                    // Создаем зомби
                    this.objects.push({
                        y: -i * 400 - 200,
                        x: Math.random() * (this.canvas.width - 50),
                        type: 'zombie',
                        val: i * 5
                    });
                }
            },

            loop() {
                if(!this.active) return;
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Рисуем игрока
                this.ctx.fillStyle = '#22d3ee';
                this.ctx.beginPath();
                this.ctx.arc(this.playerX, this.canvas.height - 100, 20, 0, Math.PI*2);
                this.ctx.fill();

                // Обновляем объекты
                this.objects.forEach((obj, index) => {
                    obj.y += this.speed;

                    // Рисуем ворота
                    if(obj.type === 'gate') {
                        this.ctx.fillStyle = 'rgba(34,211,238,0.3)';
                        this.ctx.fillRect(0, obj.y, this.canvas.width, 60);
                        this.ctx.fillStyle = '#fff';
                        this.ctx.font = 'bold 30px Arial';
                        this.ctx.fillText(obj.text, this.canvas.width/2 - 20, obj.y + 40);
                    }

                    // Рисуем зомби
                    if(obj.type === 'zombie') {
                        this.ctx.fillStyle = '#4ade80';
                        this.ctx.fillRect(obj.x, obj.y, 40, 40);
                        this.ctx.fillStyle = '#fff';
                        this.ctx.font = '14px Arial';
                        this.ctx.fillText(obj.val, obj.x + 10, obj.y - 5);
                    }

                    // Коллизии
                    if(obj.y > this.canvas.height - 120 && obj.y < this.canvas.height - 80) {
                        if(obj.type === 'gate') {
                            if(obj.mode === 'mult') this.count *= obj.val;
                            else this.count += obj.val;
                            this.objects.splice(index, 1);
                        }
                        if(obj.type === 'zombie') {
                            this.count -= obj.val;
                            this.objects.splice(index, 1);
                        }
                    }
                });

                document.getElementById('count-ui').innerText = Math.floor(this.count);

                if(this.count <= 0) this.end(false);
                if(this.objects.length === 0) this.end(true);

                requestAnimationFrame(() => this.loop());
            },

            end(win) {
                this.active = false;
                alert(win ? "ПОБЕДА! +100 золота" : "ПОРАЖЕНИЕ!");
                if(win) Base.gold += 100;
                Base.updateUI();
                document.getElementById('base-screen').style.display = 'flex';
                document.getElementById('mission-screen').style.display = 'none';
            }
        };

        // Управление мышкой/тачем
        window.addEventListener('mousemove', (e) => Runner.playerX = e.clientX);
        window.addEventListener('touchmove', (e) => Runner.playerX = e.touches[0].clientX);

    </script>
</body>
</html>
