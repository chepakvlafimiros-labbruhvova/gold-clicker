<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Locus Gold Ultra</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>

    <style>
        :root {
            --accent: #ff9d00;
            --bg: #050505;
            --card: #121214;
            --text: #ffffff;
            --dim: #7a7a7e;
            --border: #222224;
            --glow: rgba(255, 157, 0, 0.2);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* --- OVERLAY: –°–û–ì–õ–ê–®–ï–ù–ò–ï --- */
        #tos-screen { 
            position: fixed; inset: 0; background: var(--bg); z-index: 9999; 
            display: none; flex-direction: column; padding: 30px 20px; 
        }
        .tos-container { 
            flex: 1; background: var(--card); border: 1px solid var(--border); border-radius: 24px; 
            padding: 20px; overflow-y: auto; margin-bottom: 20px;
        }
        .tos-container h2 { color: var(--accent); margin-bottom: 15px; font-size: 20px; text-align: center; }
        .tos-container h3 { font-size: 14px; margin: 15px 0 5px; color: #fff; text-transform: uppercase; }
        .tos-container p { font-size: 12px; line-height: 1.6; color: var(--dim); margin-bottom: 10px; text-align: justify; }
        
        .primary-btn { 
            background: var(--accent); color: #000; border: none; padding: 18px; 
            border-radius: 18px; font-weight: 900; font-size: 16px; cursor: pointer; width: 100%;
            transition: 0.2s;
        }
        .primary-btn:active { transform: scale(0.97); opacity: 0.9; }

        /* --- UI –≠–õ–ï–ú–ï–ù–¢–´ --- */
        .header { padding: 50px 20px 20px; text-align: center; background: radial-gradient(circle at top, var(--glow) 0%, transparent 70%); }
        .balance-box { font-size: 60px; font-weight: 900; letter-spacing: -2px; }
        .balance-box span { color: var(--accent); font-size: 24px; margin-left: 5px; }

        .stats-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 0 20px; margin-bottom: 20px; }
        .stat-card { background: var(--card); border: 1px solid var(--border); padding: 12px; border-radius: 16px; text-align: center; }
        .stat-card span { display: block; font-size: 10px; color: var(--dim); font-weight: 800; text-transform: uppercase; margin-bottom: 4px; }
        .stat-card b { font-size: 16px; color: #fff; }

        /* --- –ö–õ–ò–ö–ï–† --- */
        .viewport { flex: 1; position: relative; overflow: hidden; }
        .page { position: absolute; inset: 0; display: none; flex-direction: column; padding: 0 20px 20px; overflow-y: auto; }
        .page.active { display: flex; }

        .click-container { flex: 1; display: flex; align-items: center; justify-content: center; }
        .main-coin { 
            width: 250px; height: 250px; border-radius: 50%; 
            background: radial-gradient(circle, #ffb700 0%, #ff8000 100%); 
            border: 12px solid #1a1a1c; display: flex; align-items: center; justify-content: center;
            font-size: 90px; color: rgba(0,0,0,0.3); font-weight: 900;
            box-shadow: 0 0 50px var(--glow); transition: transform 0.05s;
        }
        .main-coin:active { transform: scale(0.9); }

        /* --- –ö–ù–û–ü–ö–ò –î–ï–ô–°–¢–í–ò–ô --- */
        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .action-item { 
            background: var(--card); border: 1px solid var(--border); padding: 15px; 
            border-radius: 20px; text-align: center; cursor: pointer;
        }
        .action-item b { display: block; font-size: 13px; margin-bottom: 2px; }
        .action-item span { font-size: 10px; color: var(--accent); font-weight: 800; }

        /* --- –°–ü–ò–°–ö–ò –ò –ö–ê–†–¢–û–ß–ö–ò --- */
        .list-item { 
            background: var(--card); padding: 16px; border-radius: 18px; margin-bottom: 10px; 
            display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border);
        }
        .status-tag { font-size: 10px; padding: 5px 12px; border-radius: 12px; font-weight: 900; }
        .status-tag.waiting { background: rgba(255, 157, 0, 0.1); color: var(--accent); }
        .status-tag.success { background: rgba(50, 215, 75, 0.1); color: #32d74b; }

        /* --- –ù–ê–í–ò–ì–ê–¶–ò–Ø --- */
        .navbar { height: 85px; background: #000; border-top: 1px solid var(--border); display: flex; padding-bottom: 20px; }
        .nav-link { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--dim); }
        .nav-link.active { color: var(--accent); }
        .nav-link i { font-size: 22px; margin-bottom: 4px; }
        .nav-link span { font-size: 10px; font-weight: 800; }

        .vfx-tap { position: absolute; color: var(--accent); font-weight: 900; font-size: 24px; pointer-events: none; animation: tapFly 0.6s forwards; }
        @keyframes tapFly { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-100px); } }
    </style>
</head>
<body>

    <div id="tos-screen">
        <div class="tos-container">
            <h2>Locus Gold: User Agreement</h2>
            <p>–í–µ—Ä—Å–∏—è: 2.1 (Ultra). –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –æ–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.</p>
            
            <h3>1. –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –≤–∞–ª—é—Ç–∞</h3>
            <p>Gold (G) ‚Äî —ç—Ç–æ –≤–Ω—É—Ç—Ä–∏–∏–≥—Ä–æ–≤—ã–µ –±–∞–ª–ª—ã, –Ω–µ –∏–º–µ—é—â–∏–µ –ø—Ä—è–º–æ–π —Å–≤—è–∑–∏ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏. –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ —è–≤–ª—è–µ—Ç—Å—è —Å–∏–º—É–ª—è—Ç–æ—Ä–æ–º –∏ –Ω–µ —Å–≤—è–∑–∞–Ω–∞ —Å Axlebolt Ltd.</p>
            
            <h3>2. –ú–µ—Ö–∞–Ω–∏–∫–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–π</h3>
            <p>–ë–æ–Ω—É—Å—ã –∑–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ (100 G) –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∫–ª–∞–º—ã –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É Adsgram. –ú—ã –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –Ω–∞–ª–∏—á–∏–µ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö —Ä–æ–ª–∏–∫–æ–≤ 24/7.</p>
            
            <h3>3. –ü—Ä–∞–≤–∏–ª–∞ –≤—ã–≤–æ–¥–∞</h3>
            <p>–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ ‚Äî 750 G. –í—ã–≤–æ–¥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –Ω–∞ ID Standoff 2. –°—Ä–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ ‚Äî –¥–æ 72 —á–∞—Å–æ–≤. –õ—é–±—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –≤–∑–ª–æ–º–∞ –≤–µ–¥—É—Ç –∫ –±–∞–Ω—É.</p>
            
            <h3>4. –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø–æ–ª–∏—Ç–∏–∫–∞</h3>
            <p>–ó–∞–ø—Ä–µ—â–µ–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –ø–æ —Å–≤–æ–µ–π —Å—Å—ã–ª–∫–µ. –ó–∞ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω–æ–≥–æ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∏–≥—Ä–æ–∫–∞ –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ 100 G –º–≥–Ω–æ–≤–µ–Ω–Ω–æ.</p>
            
            <h3>5. –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏</h3>
            <p>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞ —Å–æ–±–æ–π –ø—Ä–∞–≤–æ –∏–∑–º–µ–Ω—è—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —É–ª—É—á—à–µ–Ω–∏–π –∏ –∫—É—Ä—Å—ã –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–µ–∑ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.</p>
        </div>
        <button class="primary-btn" onclick="App.acceptTos()">–ü–†–ò–ù–Ø–¢–¨ –ò –í–û–ô–¢–ò</button>
    </div>

    <div class="header">
        <div class="balance-box"><span id="val-gold">0.000</span><span>G</span></div>
    </div>

    <div class="stats-row">
        <div class="stat-card"><span>–°–∏–ª–∞ –∫–ª–∏–∫–∞</span><b id="val-pwr">0.001</b></div>
        <div class="stat-card"><span>–î—Ä—É–∑—å—è (+100G)</span><b id="val-refs">0</b></div>
    </div>

    <div class="viewport">
        <div id="p-main" class="page active">
            <div class="click-container">
                <div id="coin-trigger" class="main-coin">G</div>
            </div>
            <div class="action-grid">
                <div class="action-item" onclick="App.showAd('gold')">üéÅ <b>–ë–û–ù–£–° +5.0 G</b> <span>–†–ï–ö–õ–ê–ú–ê</span></div>
                <div class="action-item" onclick="App.showAd('pwr')">‚ö° <b>–°–ò–õ–ê +0.005</b> <span>–†–ï–ö–õ–ê–ú–ê</span></div>
                <div class="action-item" onclick="App.buyPwrGold()" style="grid-column: span 2; border-color: var(--accent);">
                    üöÄ <b>–£–õ–£–ß–®–ò–¢–¨ –ö–õ–ò–ö –ó–ê 1.000 G</b> <span>UPGRADE +0.005</span>
                </div>
            </div>
        </div>

        <div id="p-refs" class="page">
            <div style="background: var(--card); padding: 20px; border-radius: 20px; text-align: center; margin-bottom: 20px;">
                <p style="color: var(--dim); font-size: 13px; margin-bottom: 15px;">–ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–≥–∞ –∏ –ø–æ–ª—É—á–∏ 100 G –Ω–∞ –±–∞–ª–∞–Ω—Å!</p>
                <button class="primary-btn" onclick="App.copyRef()">–°–ö–û–ü–ò–†–û–í–ê–¢–¨ –°–°–´–õ–ö–£</button>
            </div>
            <div id="ref-list-container"></div>
        </div>

        <div id="p-out" class="page">
            <div style="margin-bottom: 25px;">
                <button id="btn-withdraw-main" class="primary-btn" style="background: #222; color: #555;" disabled>–û–§–û–†–ú–ò–¢–¨ –í–´–í–û–î (750 G)</button>
            </div>
            <p style="font-size: 11px; color: var(--dim); text-transform: uppercase; margin-bottom: 10px;">–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</p>
            <div id="history-list-container"></div>
        </div>
    </div>

    <nav class="navbar">
        <div class="nav-link active" onclick="App.nav('main', this)"><i>‚õèÔ∏è</i><span>–ò–ì–†–ê</span></div>
        <div class="nav-link" onclick="App.nav('refs', this)"><i>üë•</i><span>–î–†–£–ó–¨–Ø</span></div>
        <div class="nav-link" onclick="App.nav('out', this)"><i>üè¶</i><span>–í–´–í–û–î</span></div>
    </nav>

    <script>
    const App = {
        db: null, tg: window.Telegram.WebApp, uid: null,
        gold: 0, pwr: 0.001, journal: 0,
        
        async init() {
            this.tg.expand();
            this.uid = this.tg.initDataUnsafe?.user?.id?.toString() || "WEB_PREVIEW";
            
            const cfg = {
                apiKey: "AIzaSyCoa29KS-sin6hoRz0ZbE4f3ki0tZLwkKI",
                authDomain: "gold-clicker-5d882.firebaseapp.com",
                projectId: "gold-clicker-5d882",
                appId: "1:83489312782:web:ee5b7bdc390e53e7dd6c5f"
            };
            
            firebase.initializeApp(cfg);
            this.db = firebase.firestore();

            const doc = await this.db.collection('players').doc(this.uid).get();
            
            if(!doc.exists) {
                // –ü–ï–†–í–´–ô –ó–ê–ü–£–°–ö
                document.getElementById('tos-screen').style.display = 'flex';
            } else {
                const data = doc.data();
                if(!data.acceptedTos) {
                    document.getElementById('tos-screen').style.display = 'flex';
                }
                this.gold = data.gold || 0;
                this.pwr = data.pwr || 0.001;
                this.render();
            }

            setInterval(() => this.sync(), 3000);
            document.getElementById('coin-trigger').onclick = (e) => this.tap(e);
        },

        async acceptTos() {
            document.getElementById('tos-screen').style.display = 'none';
            await this.db.collection('players').doc(this.uid).set({
                gold: 0, pwr: 0.001, acceptedTos: true, 
                name: this.tg.initDataUnsafe?.user?.first_name || "Unknown"
            }, {merge: true});
            this.handleReferral();
            this.render();
        },

        async handleReferral() {
            const startParam = this.tg.initDataUnsafe?.start_param;
            if(startParam && startParam !== this.uid) {
                // –ù–∞—á–∏—Å–ª—è–µ–º –ø—Ä–∏–≥–ª–∞—Å–∏–≤—à–µ–º—É 100 G
                await this.db.collection('players').doc(startParam).update({
                    gold: firebase.firestore.FieldValue.increment(100)
                });
                // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –¥—Ä—É–≥–∞ –≤ —Å–ø–∏—Å–æ–∫
                await this.db.collection('players').doc(startParam).collection('referrals').doc(this.uid).set({
                    name: this.tg.initDataUnsafe?.user?.first_name || "–î—Ä—É–≥",
                    date: new Date().toLocaleDateString()
                });
            }
        },

        tap(e) {
            this.gold += this.pwr; this.journal += this.pwr;
            this.render();
            this.vfx(e.clientX, e.clientY);
            if(this.tg.HapticFeedback) this.tg.HapticFeedback.impactOccurred('light');
        },

        async sync() {
            if(this.journal <= 0) return;
            const toAdd = this.journal;
            await this.db.collection('players').doc(this.uid).update({
                gold: firebase.firestore.FieldValue.increment(toAdd),
                pwr: this.pwr
            });
            this.journal -= toAdd;
        },

        async buyPwrGold() {
            if(this.gold < 1) return this.tg.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ Gold!");
            this.gold -= 1; this.pwr += 0.005;
            await this.db.collection('players').doc(this.uid).update({
                gold: firebase.firestore.FieldValue.increment(-1),
                pwr: firebase.firestore.FieldValue.increment(0.005)
            });
            this.render();
            this.tg.showAlert("–°–∏–ª–∞ –∫–ª–∏–∫–∞ —É–≤–µ–ª–∏—á–µ–Ω–∞!");
        },

        showAd(type) {
            this.tg.showConfirm("–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∏–¥–µ–æ –∏ –ø–æ–ª—É—á–∏—Ç—å –±–æ–Ω—É—Å?", (ok) => {
                if(ok) {
                    const Ad = window.Adsgram.init({ blockId: "8213" });
                    Ad.show().then(() => {
                        if(type === 'gold') this.gold += 5;
                        else this.pwr += 0.005;
                        this.sync(); this.render();
                    }).catch(() => this.tg.showAlert("–†–µ–∫–ª–∞–º–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞"));
                }
            });
        },

        render() {
            document.getElementById('val-gold').innerText = this.gold.toFixed(3);
            document.getElementById('val-pwr').innerText = this.pwr.toFixed(3);
            
            const btn = document.getElementById('btn-withdraw-main');
            if(this.gold >= 750) {
                btn.style.background = "var(--accent)"; btn.style.color = "#000";
                btn.disabled = false; btn.onclick = () => this.withdraw();
            } else {
                btn.style.background = "#222"; btn.style.color = "#555";
                btn.disabled = true;
            }
        },

        async withdraw() {
            const sid = prompt("–í–≤–µ–¥–∏—Ç–µ ID Standoff 2 (—Ü–∏—Ñ—Ä—ã):");
            if(!sid || sid.length < 7) return this.tg.showAlert("ID —É–∫–∞–∑–∞–Ω –Ω–µ–≤–µ—Ä–Ω–æ");
            
            const req = { 
                sid, amount: Math.floor(this.gold), status: '–û–∂–∏–¥–∞–Ω–∏–µ', 
                date: new Date().toLocaleDateString(), uid: this.uid 
            };
            
            await this.db.collection('withdrawals').add(req);
            await this.db.collection('players').doc(this.uid).collection('history').add(req);
            
            this.gold = 0;
            await this.db.collection('players').doc(this.uid).update({ gold: 0 });
            this.render();
            this.loadHistory();
            this.tg.showAlert("–ó–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞ –≤ –æ–±—Ä–∞–±–æ—Ç–∫—É!");
        },

        async loadRefs() {
            const container = document.getElementById('ref-list-container');
            const snap = await this.db.collection('players').doc(this.uid).collection('referrals').get();
            container.innerHTML = snap.empty ? '<p style="text-align:center;color:#444;margin-top:20px;">–î—Ä—É–∑–µ–π –ø–æ–∫–∞ –Ω–µ—Ç</p>' : '';
            document.getElementById('val-refs').innerText = snap.size;
            snap.forEach(d => {
                container.innerHTML += `<div class="list-item"><b>${d.data().name}</b><span class="status-tag success">+100 G</span></div>`;
            });
        },

        async loadHistory() {
            const container = document.getElementById('history-list-container');
            const snap = await this.db.collection('players').doc(this.uid).collection('history').orderBy('date','desc').get();
            container.innerHTML = snap.empty ? '<p style="text-align:center;color:#444;margin-top:20px;">–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –Ω–µ—Ç</p>' : '';
            snap.forEach(doc => {
                const d = doc.data();
                const isWait = d.status === '–û–∂–∏–¥–∞–Ω–∏–µ';
                container.innerHTML += `
                    <div class="list-item">
                        <div><b>${d.amount} G</b><br><small style="color:var(--dim)">ID: ${d.sid}</small></div>
                        <span class="status-tag ${isWait ? 'waiting' : 'success'}">${d.status}</span>
                    </div>`;
            });
        },

        nav(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            document.getElementById('p-'+id).classList.add('active'); el.classList.add('active');
            if(id === 'refs') this.loadRefs();
            if(id === 'out') this.loadHistory();
        },
        
        copyRef() {
            const link = `https://t.me/Locus_Gold_bot/Locus_Gold?startapp=${this.uid}`;
            navigator.clipboard.writeText(link);
            this.tg.showAlert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞! –û—Ç–ø—Ä–∞–≤—å –µ—ë –¥—Ä—É–≥—É.");
        },

        vfx(x, y) {
            const div = document.createElement('div');
            div.className = 'vfx-tap';
            div.innerText = `+${this.pwr.toFixed(3)}`;
            div.style.left = x + 'px'; div.style.top = y + 'px';
            document.body.appendChild(div);
            setTimeout(() => div.remove(), 600);
        }
    };
    window.onload = () => App.init();
    </script>
</body>
</html>
