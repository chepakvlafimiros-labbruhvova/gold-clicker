<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Locus Gold Elite</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>

    <style>
        :root {
            --bg: #000000;
            --surface: #111111;
            --accent: #ff9d00;
            --text-dim: #8e8e93;
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: var(--bg); color: #fff; height: 100vh; overflow: hidden; 
            position: fixed; width: 100%; display: flex; flex-direction: column;
        }

        /* --- –ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù (–§–ò–ö–°–ò–†–û–í–ê–ù–ù–ê–Ø –í–ï–†–°–¢–ö–ê) --- */
        .app-container {
            position: relative; flex: 1; display: flex; flex-direction: column;
            padding: calc(var(--safe-top) + 20px) 20px 0;
        }

        .header-stats {
            text-align: center; margin-bottom: 30px;
        }

        .gold-display { font-size: 48px; font-weight: 900; color: var(--accent); }
        
        /* –°–ï–¢–ö–ê –°–¢–ê–¢–ò–°–¢–ò–ö–ò (–í–ï–†–•–ù–ò–ï –ö–ù–û–ü–ö–ò) */
        .stats-grid { 
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;
        }
        .stat-box { 
            background: #18181b; border-radius: 16px; padding: 15px; text-align: center;
            border: 1px solid #27272a;
        }
        .stat-box small { display: block; color: var(--text-dim); font-size: 10px; text-transform: uppercase; margin-bottom: 5px; font-weight: 700; }
        .stat-box b { font-size: 18px; }

        /* –ó–û–ù–ê –ö–õ–ò–ö–ï–†–ê (–¶–ï–ù–¢–†) */
        .clicker-area {
            flex: 1; display: flex; align-items: center; justify-content: center;
        }
        .coin-btn {
            width: 220px; height: 220px; border-radius: 50%;
            background: radial-gradient(circle, #ffb700 0%, #ff8000 100%);
            border: 10px solid #1a1a1c; box-shadow: 0 0 50px rgba(255, 157, 0, 0.3);
            display: flex; align-items: center; justify-content: center;
            font-size: 90px; color: rgba(0,0,0,0.15); font-weight: 900;
            transition: transform 0.05s; cursor: pointer;
        }
        .coin-btn:active { transform: scale(0.92); }

        /* –ù–ò–ñ–ù–ò–ï –ö–ù–û–ü–ö–ò –î–ï–ô–°–¢–í–ò–ô */
        .actions-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px;
        }
        .action-btn {
            background: #18181b; border: 1px solid #27272a; border-radius: 20px;
            padding: 18px 10px; text-align: center;
        }
        .action-btn i { display: block; font-style: normal; font-size: 20px; margin-bottom: 5px; }
        .action-btn b { font-size: 13px; display: block; }
        .action-btn span { font-size: 9px; color: var(--accent); font-weight: 800; text-transform: uppercase; }

        .upgrade-btn {
            grid-column: span 2; background: #18181b; border: 1px solid var(--accent);
            border-radius: 20px; padding: 15px; text-align: center; margin-bottom: 10px;
        }

        /* --- –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨–°–ö–û–ï –°–û–ì–õ–ê–®–ï–ù–ò–ï (–°–û–•–†–ê–ù–ï–ù–û) --- */
        #tos-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 9999;
            display: none; align-items: center; justify-content: center; padding: 20px;
        }
        .tos-modal {
            background: #1c1c1e; width: 100%; max-width: 320px; border-radius: 24px;
            padding: 25px; text-align: center; border: 1px solid #2c2c2e;
        }
        .tos-btn-main {
            background: linear-gradient(135deg, #ff9d00, #e68a00); color: #000;
            padding: 18px; border-radius: 15px; font-weight: 800; width: 100%; border: none; margin-bottom: 12px;
        }
        .tos-btn-agree { background: #fff; color: #000; padding: 15px; border-radius: 12px; width: 100%; border: none; font-weight: 700; }

        /* --- –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ (–ü–û–î–ù–Ø–¢–û –ò –ó–ê–ö–†–ï–ü–õ–ï–ù–û) --- */
        .nav-bar {
            height: calc(70px + var(--safe-bottom)); background: #0a0a0b;
            border-top: 1px solid #1c1c1e; display: flex; 
            padding-bottom: var(--safe-bottom); z-index: 1000;
        }
        .nav-item {
            flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: var(--text-dim); text-decoration: none; border: none; background: none;
        }
        .nav-item.active { color: var(--accent); }
        .nav-item span { font-size: 10px; font-weight: 800; margin-top: 4px; text-transform: uppercase; }

        /* –í–°–ü–õ–´–í–ê–Æ–©–ò–ï –¶–ò–§–†–´ */
        .float-text { position: absolute; color: var(--accent); font-weight: 900; pointer-events: none; animation: floatUp 0.7s forwards; }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-100px); } }
    </style>
</head>
<body>

    <div id="tos-overlay">
        <div class="tos-modal">
            <div style="font-size: 40px; margin-bottom: 15px;">üìú</div>
            <button class="tos-btn-main" onclick="UI.showFullTos()">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ</button>
            <button class="tos-btn-agree" onclick="Core.accept()">–°–û–ì–õ–ê–°–ï–ù</button>
        </div>
    </div>

    <div id="full-tos" style="display:none; position:fixed; inset:0; background:#000; z-index:10000; padding:40px 25px; overflow-y:auto;">
        <h2 style="color:var(--accent)">Locus Gold: User Agreement</h2>
        <p style="margin:20px 0; line-height:1.6; color:#ccc; font-size:14px;">
            1. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —è–≤–ª—è–µ—Ç—Å—è —Å–∏–º—É–ª—è—Ç–æ—Ä–æ–º. –í—Å—è –≤–∞–ª—é—Ç–∞ (Gold) –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞.<br><br>
            2. –í—ã–≤–æ–¥ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 72 —á–∞—Å–æ–≤ –Ω–∞ ID Standoff 2 (8-9 —Ü–∏—Ñ—Ä).<br><br>
            3. –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞: 100 G –∑–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –¥—Ä—É–≥–∞.
        </p>
        <button class="tos-btn-main" onclick="UI.hideFullTos()">–í–ï–†–ù–£–¢–¨–°–Ø</button>
    </div>

    <div class="app-container" id="view-mining">
        <div class="header-stats">
            <div class="gold-display"><span id="u-gold">0.000</span> G</div>
            <div class="stats-grid">
                <div class="stat-box"><small>–°–∏–ª–∞ –∫–ª–∏–∫–∞</small><b id="u-pwr">0.001</b></div>
                <div class="stat-box"><small>–î—Ä—É–∑—å—è (+100G)</small><b id="u-refs">0</b></div>
            </div>
        </div>

        <div class="clicker-area">
            <div class="coin-btn" id="coin">G</div>
        </div>

        <div class="actions-grid">
            <div class="action-btn" onclick="Core.ad('gold')"><i>üéÅ</i><b>–ë–û–ù–£–° +5.0 G</b><span>ADSGRAM</span></div>
            <div class="action-btn" onclick="Core.ad('pwr')"><i>‚ö°</i><b>–°–ò–õ–ê +0.005</b><span>WATCH VIDEO</span></div>
            <div class="upgrade-btn" onclick="Core.upgrade()">
                üöÄ <b>–£–õ–£–ß–®–ò–¢–¨ –ö–õ–ò–ö –ó–ê 1.000 G</b><br>
                <span style="font-size:10px">Upgrade: +0.005 Strength</span>
            </div>
        </div>
    </div>

    <div class="app-container" id="view-wallet" style="display:none">
        <h2 style="text-align:center; margin-bottom:20px;">–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤</h2>
        <div class="stat-box" style="margin-bottom:20px">
            <p style="color:var(--text-dim); font-size:12px">–ú–∏–Ω–∏–º—É–º: 750 G</p>
            <button id="wd-btn" class="tos-btn-main" style="margin-top:10px; opacity:0.5" disabled>–û–§–û–†–ú–ò–¢–¨ –í–´–í–û–î</button>
        </div>
        <div id="history-list"></div>
    </div>

    <nav class="nav-bar">
        <button class="nav-item active" onclick="UI.nav('mining', this)"><i>‚õèÔ∏è</i><span>–ú–∞–π–Ω–∏–Ω–≥</span></button>
        <button class="nav-item" onclick="UI.nav('wallet', this)"><i>üè¶</i><span>–í—ã–≤–æ–¥</span></button>
    </nav>

    <script>
    const Core = {
        db: null, tg: window.Telegram.WebApp, uid: null,
        gold: 0, pwr: 0.001, 
        adId: "19895", // –û–ë–ù–û–í–õ–ï–ù–ù–´–ô ID

        async init() {
            this.tg.expand();
            this.uid = this.tg.initDataUnsafe?.user?.id?.toString() || "DEV_MODE";
            
            firebase.initializeApp({
                apiKey: "AIzaSyCoa29KS-sin6hoRz0ZbE4f3ki0tZLwkKI",
                projectId: "gold-clicker-5d882",
                appId: "1:83489312782:web:ee5b7bdc390e53e7dd6c5f"
            });
            this.db = firebase.firestore();

            const doc = await this.db.collection('players').doc(this.uid).get();
            if(!doc.exists || !doc.data().acceptedTos) {
                document.getElementById('tos-overlay').style.display = 'flex';
            } else {
                this.gold = doc.data().gold || 0;
                this.pwr = doc.data().pwr || 0.001;
                this.render();
            }

            document.getElementById('coin').onclick = (e) => this.tap(e);
        },

        async accept() {
            document.getElementById('tos-overlay').style.display = 'none';
            await this.db.collection('players').doc(this.uid).set({
                gold: 0, pwr: 0.001, acceptedTos: true,
                name: this.tg.initDataUnsafe?.user?.first_name || "–ò–≥—Ä–æ–∫"
            }, {merge: true});
            this.render();
        },

        tap(e) {
            this.gold += this.pwr;
            this.render();
            UI.spawnText(e.clientX, e.clientY, `+${this.pwr.toFixed(3)}`);
            if(this.tg.HapticFeedback) this.tg.HapticFeedback.impactOccurred('light');
        },

        ad(type) {
            const ad = window.Adsgram.init({ blockId: this.adId });
            ad.show().then(() => {
                if(type === 'gold') this.gold += 5; else this.pwr += 0.005;
                this.db.collection('players').doc(this.uid).update({ gold: this.gold, pwr: this.pwr });
                this.render();
            }).catch(() => this.tg.showAlert("–†–µ–∫–ª–∞–º–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞"));
        },

        render() {
            document.getElementById('u-gold').innerText = this.gold.toFixed(3);
            document.getElementById('u-pwr').innerText = this.pwr.toFixed(3);
            
            const btn = document.getElementById('wd-btn');
            if(this.gold >= 750) {
                btn.disabled = false; btn.style.opacity = "1";
                btn.onclick = () => this.withdraw();
            }
        },

        async withdraw() {
            const sid = prompt("–í–≤–µ–¥–∏—Ç–µ ID Standoff 2 (8-9 —Ü–∏—Ñ—Ä):");
            if(!sid || sid.length < 8) return;
            
            const amount = Math.floor(this.gold);
            await this.db.collection('withdrawals').add({ uid: this.uid, sid, amount, status: '–û–∂–∏–¥–∞–Ω–∏–µ' });
            this.gold = 0;
            await this.db.collection('players').doc(this.uid).update({ gold: 0 });
            this.render();
            this.tg.showAlert("–ó–∞—è–≤–∫–∞ –ø—Ä–∏–Ω—è—Ç–∞!");
        }
    };

    const UI = {
        nav(id, el) {
            document.querySelectorAll('.app-container').forEach(v => v.style.display = 'none');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('view-' + id).style.display = 'flex';
            el.classList.add('active');
        },
        showFullTos() { document.getElementById('full-tos').style.display = 'block'; },
        hideFullTos() { document.getElementById('full-tos').style.display = 'none'; },
        spawnText(x, y, txt) {
            const el = document.createElement('div');
            el.className = 'float-text'; el.innerText = txt;
            el.style.left = x + 'px'; el.style.top = y + 'px';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 700);
        }
    };

    window.onload = () => Core.init();
    </script>
</body>
</html>
