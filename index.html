<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Path to Neon: Syndicate</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        :root {
            --gold: #ffcc00;
            --neon: #00f2ff;
            --danger: #ff3b30;
            --bg: #0a0a0c;
            --surface: #16161a;
            --border: #2c2c34;
            --text-dim: #8e8e93;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: #fff; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* HUD - ВЕРХНЯЯ ПАНЕЛЬ СТАТУСА */
        .hud {
            padding: 15px 20px;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .stat-item { font-size: 12px; }
        .stat-item i { color: var(--neon); margin-right: 5px; }
        .stat-val { font-weight: 800; display: block; }

        /* PROGRESS BARS */
        .bar-container { width: 100%; height: 6px; background: #000; border-radius: 3px; margin-top: 5px; overflow: hidden; }
        .bar-fill { height: 100%; transition: width 0.3s; }
        .hp-fill { background: var(--danger); }
        .en-fill { background: var(--neon); }

        /* MAIN CONTENT */
        .viewport { flex: 1; overflow-y: auto; padding: 20px; }
        .screen { display: none; }
        .screen.active { display: block; }

        /* CARDS & ACTIONS */
        .card {
            background: var(--surface);
            border-radius: 16px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid var(--border);
        }

        .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        
        .btn {
            background: #23232a;
            border: 1px solid var(--border);
            padding: 12px;
            border-radius: 12px;
            color: #fff;
            text-align: center;
            cursor: pointer;
            transition: 0.2s;
        }

        .btn:active { transform: scale(0.95); background: #2c2c34; }
        .btn.primary { border-color: var(--neon); color: var(--neon); }
        .btn small { display: block; font-size: 9px; opacity: 0.6; margin-top: 4px; }

        /* NAVIGATION */
        .nav {
            background: var(--surface);
            border-top: 1px solid var(--border);
            display: flex;
            padding-bottom: env(safe-area-inset-bottom);
        }

        .nav-item {
            flex: 1; padding: 15px 5px; text-align: center;
            color: var(--text-dim); font-size: 10px; text-transform: uppercase;
        }

        .nav-item.active { color: var(--neon); }
        .nav-item i { font-size: 18px; margin-bottom: 5px; display: block; }

        /* LOGS */
        #game-logs {
            height: 100px; background: #000; padding: 10px;
            font-family: monospace; font-size: 10px; color: #0f0;
            overflow-y: auto; border-top: 1px solid var(--border);
        }
    </style>
</head>
<body>

    <div class="hud">
        <div class="stat-item">
            <i class="fas fa-wallet"></i><small>CASH</small>
            <span class="stat-val" id="val-cash">$0</span>
        </div>
        <div class="stat-item">
            <i class="fas fa-heart"></i><small>HEALTH</small>
            <div class="bar-container"><div id="hp-bar" class="bar-fill hp-fill" style="width: 100%"></div></div>
        </div>
        <div class="stat-item">
            <i class="fas fa-bolt"></i><small>ENERGY</small>
            <div class="bar-container"><div id="en-bar" class="bar-fill en-fill" style="width: 100%"></div></div>
        </div>
    </div>

    <div class="viewport">
        <div id="scr-street" class="screen active">
            <div class="card">
                <h3>Улицы Готэм-Сити</h3>
                <p style="color: var(--text-dim); font-size: 13px; margin: 10px 0;">Вы начинаете с низов. Соберите бутылки или попробуйте найти еду.</p>
                <div class="action-grid">
                    <div class="btn" onclick="Game.doAction('search_trash')">
                        <b>Поиск в мусоре</b>
                        <small>-5 Energy | +$1-3</small>
                    </div>
                    <div class="btn" onclick="Game.doAction('beg')">
                        <b>Попрошайничать</b>
                        <small>-10 Energy | +$0-10</small>
                    </div>
                </div>
            </div>
            
            <div class="card" id="sleep-card">
                <h3>Ночлег</h3>
                <div class="btn primary" onclick="Game.doAction('sleep')">
                    <b>Спать на коробке</b>
                    <small>Восстановить Энергию</small>
                </div>
            </div>
        </div>

        <div id="scr-work" class="screen">
            <div class="card">
                <h3>Центр Занятости</h3>
                <div id="job-list">
                    </div>
            </div>
        </div>

        <div id="scr-biz" class="screen">
            <div class="card">
                <h3>Мои Предприятия</h3>
                <div id="biz-list">
                    <p style="text-align:center; color:var(--text-dim)">У вас пока нет бизнеса. Накопите $5,000 для первой кофейни.</p>
                </div>
            </div>
        </div>
    </div>

    <div id="game-logs"></div>

    <nav class="nav">
        <div class="nav-item active" onclick="UI.nav('street', this)"><i class="fas fa-home"></i>Улица</div>
        <div class="nav-item" onclick="UI.nav('work', this)"><i class="fas fa-briefcase"></i>Работа</div>
        <div class="nav-item" onclick="UI.nav('biz', this)"><i class="fas fa-city"></i>Бизнес</div>
        <div class="nav-item" onclick="Game.showAd()"><i class="fas fa-ad" style="color: var(--gold)"></i>Бонус</div>
    </nav>

    <script>
        /**
         * GLOBAL GAME ENGINE: PATH TO NEON
         * Modules: Character, Economy, World, Events
         */

        const Game = {
            player: {
                cash: 0,
                hp: 100,
                energy: 100,
                intellect: 1,
                karma: 0,
                lvl: 1,
                exp: 0,
                inventory: []
            },

            // Система работ (от бомжа до CEO)
            jobs: [
                { id: 'cleaner', name: 'Уборщик', pay: 15, req: 0, en: 20 },
                { id: 'courier', name: 'Курьер', pay: 45, req: 2, en: 30 },
                { id: 'coder', name: 'Junior Dev', pay: 150, req: 10, en: 40 }
            ],

            init() {
                this.tg = window.Telegram.WebApp;
                this.tg.expand();
                this.load();
                this.updateUI();
                this.startTick();
                this.log("Система инициализирована. Добро пожаловать в Неон-Сити.");
            },

            // Главная фишка: Динамическое выполнение действий
            doAction(type) {
                if(this.player.energy < 10 && type !== 'sleep') {
                    return this.log("Слишком устал... Нужен отдых.");
                }

                switch(type) {
                    case 'search_trash':
                        let found = Math.floor(Math.random() * 4);
                        this.player.cash += found;
                        this.player.energy -= 5;
                        this.player.exp += 1;
                        this.log(`Найдено в мусоре: $${found}`);
                        break;
                    case 'beg':
                        let beg = Math.random() > 0.5 ? Math.floor(Math.random() * 11) : 0;
                        this.player.cash += beg;
                        this.player.energy -= 10;
                        this.log(beg > 0 ? `Прохожий дал вам $${beg}` : "Вас проигнорировали.");
                        break;
                    case 'sleep':
                        this.player.energy = 100;
                        this.player.hp = Math.min(100, this.player.hp + 10);
                        this.log("Вы поспали. Энергия восстановлена.");
                        break;
                }
                this.updateUI();
            },

            startTick() {
                // Пассивное выгорание и восстановление
                setInterval(() => {
                    if(this.player.hp <= 0) this.gameOver();
                    this.updateUI();
                }, 5000);
            },

            updateUI() {
                document.getElementById('val-cash').innerText = `$${Math.floor(this.player.cash)}`;
                document.getElementById('hp-bar').style.width = this.player.hp + '%';
                document.getElementById('en-bar').style.width = this.player.energy + '%';
                
                // Рендер работ в зависимости от уровня
                const jobList = document.getElementById('job-list');
                jobList.innerHTML = '';
                this.jobs.forEach(j => {
                    if(this.player.lvl >= j.req) {
                        jobList.innerHTML += `
                            <div class="btn" style="margin-bottom:10px" onclick="Game.work('${j.id}')">
                                <b>${j.name}</b>
                                <small>Зарплата: $${j.pay} | Энергия: -${j.en}</small>
                            </div>
                        `;
                    }
                });
            },

            work(id) {
                const job = this.jobs.find(j => j.id === id);
                if(this.player.energy >= job.en) {
                    this.player.cash += job.pay;
                    this.player.energy -= job.en;
                    this.player.exp += 5;
                    this.log(`Вы отработали смену: +$${job.pay}`);
                    this.updateUI();
                } else {
                    this.log("Недостаточно энергии для работы.");
                }
            },

            showAd() {
                // Реклама дает "Набор выживания"
                const ad = Adsgram.init({ blockId: "19895" });
                ad.show().then(() => {
                    this.player.cash += 100;
                    this.player.energy = 100;
                    this.log("Спонсорская помощь: +$100 и Энергия");
                    this.updateUI();
                });
            },

            log(msg) {
                const l = document.getElementById('game-logs');
                l.innerHTML = `> ${msg}<br>` + l.innerHTML;
            },

            save() { localStorage.setItem('neon_save', JSON.stringify(this.player)); },
            load() {
                const s = localStorage.getItem('neon_save');
                if(s) this.player = JSON.parse(s);
            }
        };

        const UI = {
            nav(id, el) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                document.getElementById('scr-' + id).classList.add('active');
                el.classList.add('active');
            }
        };

        window.onload = () => Game.init();
    </script>
</body>
</html>
